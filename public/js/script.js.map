{"version":3,"sources":["script.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js","sourcesContent":["//\n// Runtime\n//\n\nvar timeOut;\nvar allmarkers = [];\nvar map;\nvar openWindow;  \nvar activeMarker;\nvar directionsDisplay;\nvar directionsService; \nvar iconListener;\nvar altRoutes = 0;\nvar curRoute = 0;\nvar GET = {};\nvar activeRouteInputElement = \"\";\nvar locationCircle = null;\nvar locationIcon = null;\nvar connectors = [];\nvar providerreq = {};\nproviderreq.providers = [];\nvar openRssWindow;\nvar c = { };\nvar device = 'desktop';\nvar route = {\n\tstart:\"\",\n\tend:\"\",\n\tpath: [],\n\tconsumption:{\n\t\ttotal:{\n\t\t\tbaseline:0,\n\t\t\tadjusted:0\n\t\t},\n\t\twaypoints:[]\n\t},\n\tclear: function(){\n\t\tthis.start = \"\";\n\t\tthis.end = \"\";\n\t\tthis.path = [];\n\t\tthis.consumption = {\n\t\t\ttotal:{\n\t\t\t\tbaseline:0,\n\t\t\t\tadjusted:0\n\t\t\t},\n\t\t\twaypoints:[]\n\t\t};\n\t\tthis.waypoints=[];\n\t}\n};\nroute.waypoints = [];\nc.targetChargers = [];\nvar firstRun = true;\nvar heatmeupopen = false;\nvar showingElevationInfo = false;\nvar showingRouteSettings = false;\nvar elevation;\nvar chart;\nvar elevResults = [];\nvar elevData;\nvar altInfoWindow;\nvar geocoder;\n\n  \n\nif(typeof(Storage) !== \"undefined\") {\n    var storagePossible = true;\n} else {\n    var storagePossible = false;\n}\n\n\n//\n// Display functions\n//\n\nvar userController = function(){\n\tvar lock;\n\tvar auth0;\n\tvar loggedIn = false;\n\n\tfunction getProfile(idtoken){\n\t\tlock.getProfile(idtoken,function(error,profile){\n\t\t\tif (error) {\n\t\t\t\tlogout();\n\t\t\t\tlogin();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprovidersController.update(true);\n\t\t\tloggedIn = true;\n\t\t\tlocalStorage.id_token = idtoken;\n\t\t\tlocalStorage.userProfile = JSON.stringify(profile);\n\t\t\tprocessProfile(profile);\n\t\t\trenewToken(idtoken);\t\n\t\t});\n\t}\n\n\tfunction processProfile(profile){\n\t\t//determine user's name\n\t\tif (profile.user_metadata.firstName) {\n\t\t\tvar name = profile.user_metadata.firstName + \" \" + profile.user_metadata.lastName\n\t\t} else {\n\t\t\tvar name = profile.name;\n\t\t}\n\t\t$(\".username\").html(name);\n\t\t$(\".logout\").html(\"Logout\");\n\n\t\tif (profile.picture.indexOf(\"cdn.auth0.com\") == -1) {\n\t\t\t$(\".menu-icon-container\").html('<img class=\"avatar\" src=\"'+profile.picture+'\"></img>')\n\t\t\t\t\t\t\t\t\t .addClass(\"profile-picture\");\n\t\t}\n\t\t//TODO twitter!\n\t\tif (!profile.email_verified) {\n\t\t\t$(\".username\").html(name + \" (provisional)\");\n\t\t\t$(\".username\").css({color:\"red\"});\n\t\t\tswal({\n\t\t\t\ttitle:\"Welcome!\",\n\t\t\t\ttext:\"Registration's complete. To unlock full functionality please verify your email address by following the link in the registration email.\",\n\t\t\t\ttype: \"success\",\n\t\t\t\tshowConfirmButton: true,\n\t\t\t\tconfirmButtonText: \"\"\n\t\t\t});\n\t\t} else {\n\t\t\t$(\".username\").html(name);\n\t\t}\n\n\t\tupdateUrl();\n\t}\n\n\tfunction logout(){\n\t\t\n\t\tlocalStorage.id_token = \"\";\n\t\tlocalStorage.userProfile = \"\";\n\t\t$(\".username\").html(\"Guest\");\n\t\t$(\".logout\").html(\"Login\");\n\n\t\t$(\".menu-icon-container\").html('<i class=\"fa fa-car menu-icon\"></i>')\n\t\t\t\t\t\t\t\t .removeClass(\"profile-picture\");\n\t\tloggedIn = false;\t\n\t}\n\n\tfunction login(){\n\t\tlock.show();\n\t}\n\n\tfunction renewToken(id_token){\n\t\tauth0.renewIdToken(id_token, function (err, delegationResult) {\n\t\t\tif (err){\n\t\t\t\treturn;\n\t\t\t}\n  \t\t\tlocalStorage.id_token = delegationResult.id_token;\n\t\t});\n\t}\n\tvar imageUrl = window.location.protocol + \"//\" + window.location.hostname + \"/img/Icon-App-60x60@3x.png\";\n\treturn {\n\t\tinit: function(){\n\t\t\tlock = new Auth0Lock('2ZONj7AJBZPWqTAb1UrhWq8d4qZj7xwN', 'evhighwaystatus.eu.auth0.com',{\n\t\t\t\ttheme: {\n\t\t\t\t\tlogo: imageUrl,\n\t\t\t\t\tprimaryColor: 'white'\n\t\t\t\t},\n\t\t\t\t//container: 'page',\n\t\t\t\tlanguageDictionary: {\n\t\t\t\t\ttitle: \"Welcome!\"\n\t\t\t\t},\n\t\t\t\tclosable: true,\n\t\t\t\tauth: {\n\t\t\t\t\tredirect: true,\n\t\t\t\t\tresponseType: 'token'\n\t\t\t\t},\n\t\t\t\tadditionalSignUpFields: [{\n\t\t\t\t\tname: \"firstName\",\n\t\t\t\t\tplaceholder: \"First name\",\n\t\t\t\t\tvalidator: function(name){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tvalid: name.length > 1,\n\t\t\t\t\t\t\thint: \"Please enter your first name\"\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\ticon: \"https://evhighwaystatus.co.uk/img/user-shape.png\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"lastName\",\n\t\t\t\t\tplaceholder: \"Last name\",\n\t\t\t\t\tvalidator: function(name){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tvalid: name.length > 1,\n\t\t\t\t\t\t\thint: \"Please enter your last name\"\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\ticon: \"https://evhighwaystatus.co.uk/img/user-shape.png\"\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tlock.on(\"authenticated\",function(authResult){\n\t\t\t\tgetProfile(authResult.idToken);\t\n\t\t\t\t\t\t\t\t\n\t\t\t});\n\n\t\t\tlock.on(\"authorization_error\", function(error) {\n\t\t\t\tlogout();\n\t\t\t});\n\n\t\t\tauth0 = new Auth0({\n\t\t\t    domain:       'evhighwaystatus.eu.auth0.com',\n\t\t\t    clientID:     '2ZONj7AJBZPWqTAb1UrhWq8d4qZj7xwN',\n\t\t\t    callbackURL:  'https://evhighwaystatus.co.uk',\n\t\t\t    responseType: 'token'\n\t\t\t});\n\n\t\t\tif (urlParamsController.hashParams()[\"id_token\"]) {\n\t\t\t\t//authenticated event should handle this\n\t\t\t} else if (localStorage.id_token &&\n\t\t\t\t\t   localStorage.id_token.length > 10) {\n\t\t\t\tgetProfile(localStorage.id_token);\n\t\t\t} else {\n\t\t\t\t\n\t\t\t}\n\n\t\t},\n\t\ttoggleLoginStatus: function(){\n\t\t\tif (localStorage.id_token) {\n\t\t\t\tvar profile = JSON.parse(localStorage.userProfile);\t\n\t\t\t\tlogout();\n\t\t\t\twindow.location.assign(\"https://evhighwaystatus.eu.auth0.com/v2/logout?returnTo=https://evhighwaystatus.co.uk&client_id=\"+profile.clientID);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tlogin();\n\t\t\t}\n\t\t},\n\t\tisLoggedIn: function(){\n\t\t\treturn loggedIn;\n\t\t}\n\n\t};\n}();\n\nvar testAuthHeaders = function(){\n\treturn {\n\t\tgo: function(){\n\t\t\t$.ajax({\n\t\t\t\turl: \"https://evhighwaystatus.co.uk/php/secured/authentication.php\",\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tcrossDomain: true,\n\t\t\t\tbeforeSend: function(xhr) {\n\t\t\t\t\txhr.setRequestHeader(\"X-Authorization\", 'Bearer '+localStorage.id_token);\n\t\t\t\t}\t\t\n\t\t\t}).done(function(a,b,c){\n\t\t\t\tvar car = a;\n\t\t\t}).always(function(d,e,f){\n\t\t\t\tvar car = d;\n\t\t\t});\n\t\t}\n\t};\n}();\n\nvar switchRoute = function() {\n\t\n\treturn function(){\n\t\tvar currentRoute = [];\n\n\t\t$(\".routeinput\").each(function(){\n\t\t\tcurrentRoute.push(this.value);\n\t\t});\n\n\t\tcurrentRoute.reverse();\n\n\t\t$(\".routeinput\").each(function(index){\n\t\t\tthis.value = currentRoute[index];\n\t\t});\n\t\t\n\t\tcalcRoute();\n\t};\n}();\n\nvar navMenu = function(){\n\n\tvar dropdwnVisible;\n\n\treturn {\n\t\tinitMobile: function(){\n\t\t\tvar e = document.getElementsByClassName(\"dropbtn\");\n\t\t\tfor (var i = 0; i < e.length; i++) {\n\t\t\t\te[i].addEventListener(\"mousedown\",navMenu.showDropdown);\n\t\t\t\t//e[i].addEventListener(\"mouseleave\",navMenu.showDropdown);\n\n\t\t\t};\n\n\t\t\tvar e = document.getElementsByClassName(\"dropdown-content\");\n\t\t\tfor (var i = 0; i < e.length; i++) {\n\t\t\t\t//e[i].addEventListener(\"mouseover\",navMenu.showDropdown);\n\t\t\t\t//e[i].addEventListener(\"mouseleave\",navMenu.showDropdown);\n\t\t\t\t\n\t\t\t};\n\n\t\t},\n\t\tinitDesktop: function(){\n\n\t\t},\n\t\tshowDropdown: function(event){\n\t\t\tvar b = document.getElementsByClassName(\"dropbtn\");\n\t\t\tvar e = document.getElementsByClassName(\"dropdown-content\");\n\n\t\t\tfor (var i = 0; i < e.length; i++) {\n\t\t\t\tif (b[i] === event.srcElement){\n\t\t\t\t\tif (dropdwnVisible == i){\n\t\t\t\t\t\te[i].style.display = \"none\";\n\t\t\t\t\t\tdropdwnVisible = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\te[i].style.display = \"block\";\n\t\t\t\t\t\tdropdwnVisible = i;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\te[i].style.display = \"none\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\t\thideDropdowns: function(){\n\t\t\tvar e = document.getElementsByClassName(\"dropdown-content\");\n\t\t\tfor (var i = 0; i < e.length; i++) {\n\t\t\t\te[i].style.display = \"none\";\n\t\t\t\te[i].style.display = \"\";\n\t\t\t}\n\t\t\tdropdwnVisible = null;\n\t\t}\t\t\n\t};\n}();\n\nfunction routeData(){\n\tif (showingRouteSettings){\n\t\tdocument.getElementById(\"vehicle-energy-data\").style.top = \"-550px\";\n\t\tshowingRouteSettings = false;\n\t} else {\n\t\tdocument.getElementById(\"vehicle-energy-data\").style.top = \"50px\";\n\t\tshowingRouteSettings = true;\n\t}\n}\n\nfunction tweetLinkInfoWindow(lat,lng){\n\tfor (var i = 0; i < allmarkers.length; i++) {\n\t\tif (allmarkers[i].info.lat == parseFloat(lat) && allmarkers[i].info.lng == parseFloat(lng)){\n\t\t\tactiveMarker = allmarkers[i];\n\t\t\tactiveMarker.showInfoWindow();\n\n\t\t}\n\t\t\n\t};\n}\n\nfunction toggleElevation(){\n\tif (showingElevationInfo){\n\t\tdocument.getElementById(\"waypoints-elevation\").style.display = \"none\";\n\t\tshowingElevationInfo = false;\n\t} else {\n\t\tdocument.getElementById(\"waypoints-elevation\").style.display = \"block\";\n\t\tshowingElevationInfo = true;\n\t}\n\t\n}\n\nvar toggleWaypoints = function(){\n\tvar waypointsActive = true;\n\tvar offset = 0;\n\t\n\n\treturn {\n\t\tisActive: function(){\n\t\t\treturn waypointsActive;\n\t\t},\n\t\ttoggle: function(){\n\t\t\twaypointsActive = !waypointsActive;\n\t\t\tnavMenu.hideDropdowns();\n\n\t\t\toffset = $(\"#route-overview\").width() + Number($(\"#route-overview\").css(\"margin-left\").replace(\"px\", \"\")) + $(\".myroute-tab\").width() ;\n\n\n\n\n\t\t\tif (waypointsActive){\n\t\t\t\t//hide menu\n\t\t\t\t$(\"#route-overview\").css({left: offset * -1});\n\t\t\t\t//$(\"#route-overview\").css({left: \"auto\", right: \"100%\"});\n\t\t\t\t$(\".tab-triangle\").removeClass(\"fa-chevron-left\").addClass(\"fa-chevron-right\")\n\n\t\t\t\tif (document.getElementById(\"routestart\").value == \"\"){\n\t\t\t\t\troute.start = \"Not yet added.\";\n\t\t\t\t} else {\n\t\t\t\t\troute.start = document.getElementById(\"routestart\").value;\n\t\t\t\t}\n\n\t\t\t\tif (document.getElementById(\"routeend\").value == \"\"){\n\t\t\t\t\troute.end = \"Not yet added.\";\n\t\t\t\t} else {\n\t\t\t\t\troute.end = document.getElementById(\"routeend\").value;\n\t\t\t\t}\n\t\t\t\n\t\t\t//updateWaypointTable();\n\n\t\t\t} else {\n\t\t\t\t//show the menu\n\t\t\t\t$(\"#route-overview\").css({left: 0});\n\t\t\t\t//$(\"#route-overview\").css({left: 0, right: \"auto\"});\n\t\t\t\t$(\".tab-triangle\").removeClass(\"fa-chevron-right\").addClass(\"fa-chevron-left\")\n\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t};\n}();\n\nfunction setConnectorCheckmark(number){\n\tvar checkmarks = document.getElementsByClassName(\"checkmark_con\");\n\n\tfor (var i = 0; i < checkmarks.length; i++) {\n\t\tif (i == number){\n\t\t\tcheckmarks[i].style.visibility = \"visible\";\n\t\t} else {\n\t\t\tcheckmarks[i].style.visibility = \"hidden\";\n\t\t}\n\t}  \n} \n\nfunction heatMeUp(){\n\n\tif (heatmeupopen){\n\t\tdocument.getElementsByClassName(\"carwings-login\")[0].style.top = \"-550px\";\n\t\tdocument.getElementById(\"loading\").style.display = \"none\";\n\t\theatmeupopen = false;\n\t\tnavMenu.hideDropdowns();\n\t} else {\n\t\tdocument.getElementsByClassName(\"carwings-login\")[0].style.top = \"50px\";\n\t\theatmeupopen = true;\n\t\tnavMenu.hideDropdowns();\n\t}\n\n}\n\nfunction toggleBubble(display){ \n\tif (display)\n\t\tdocument.getElementsByClassName(\"bubble\")[0].style.display = \"inline-block\";\n\telse {\n\t\tdocument.getElementsByClassName(\"bubble\")[0].style.display = \"none\";\n\t}\n} \n\nvar routeInputs = function(){\n\tvar visible = false;\n\n\treturn {\n\t\tshow: function(){\n\t\t\tif (!visible){\n\t\t\t\t// document.getElementById(\"route\").style.display = \"inline-block\";\n\t\t\t\tdocument.getElementById(\"clear-route\").style.display = \"block\";\n\t\t\t\tdocument.getElementById(\"route-overview\").style.display = \"block\";\n\t\t\t\tnavMenu.hideDropdowns();\n\t\t\t\tvisible = true;\n\t\t\t}\n\t\t},\n\t\thide: function(){\n\t\t\t// document.getElementById(\"route\").style.display = \"none\";\n\t\t\tdocument.getElementById(\"clear-route\").style.display = \"none\";\n\t\t\tdocument.getElementById(\"route-overview\").style.display = \"none\";\n\t\t\tvisible = false;\n\t\t},\n\t\tisActive: function(){\n\t\t\treturn visible;\n\t\t}\n\t};\n\t\n}();\n\nfunction closeNavMenus(){\n\tvar menus = document.getElementsByClassName(\"dropdown-content\");\n\tfor (var i = 0; i < menus.length; i++) {\n\t\tmenus[i].style.display = \"none\";\n\t\tmenus[i].style.display = \"\";\n\t}\n}\n\n//document ready\n\nvar isCordovaApp;\n\nif (document.URL.indexOf('localhost') > -1) {\n\tisCordovaApp = true;\n} else {\n\tisCordovaApp = document.URL.indexOf('http://') === -1 && document.URL.indexOf('https://') === -1;\n}\n\nif (isCordovaApp) {\n\tdocument.addEventListener('deviceready', function(){\n\t\tinitialise();\n\t}, false);\n} else {\n\t$(document).ready(initialise);\n}\n\nfunction initFacebook(){\n\twindow.fbAsyncInit = function() {\n    FB.init({\n      appId      : '260883924295945',\n      xfbml      : true,\n      version    : 'v2.7'\n    });\n  };\n\n  (function(d, s, id){\n     var js, fjs = d.getElementsByTagName(s)[0];\n     if (d.getElementById(id)) {return;}\n     js = d.createElement(s); js.id = id;\n     js.src = \"//connect.facebook.net/en_US/sdk.js\";\n     fjs.parentNode.insertBefore(js, fjs);\n   }(document, 'script', 'facebook-jssdk'));\n}\n\nfunction initialise(){\n\n\turlParamsController.fetch();\n\n\t\n\tif (isCordovaApp) {\n\t\t$(\"#menu\").addClass(\"cordova-app\");\n\t}\n\t\n\t$(document).on(\"markersAdded\",function(){\n\t\tmapMask.hide();\n\t\tdocument.getElementById(\"icons\").style.visibility = \"visible\";\n\t\tdocument.getElementById(\"updated\").style.visibility = \"visible\";\n\n\t});\n\n\t$(document).on(\"mapFirstInit\",function(){\n\t\tsetTimeout(userController.init,1000);\n\t\tprovidersController.update(true);\n\t});\n\n\tinitFacebook();\n\t\n\t//GET for certificate issue in IE and Chrome.\n\tinitalGetRequest();\n\t\n\tdocument.addEventListener('resume', function() {\n\t\tsetTimeout(providersController.update,50);\n\t}, false);\n\n\tsetUp();\n\t\n\tvehicleController.init();\n\n\t$(\"#menu\").mmenu({\n\t\t\"extensions\": [\n            \"pageshadow\"\n         ]\n\t}, {\n         // configuration\n         offCanvas: {\n            pageSelector: \"#page\"\n         }\n     });\n\n\tif (isCordovaApp) {\n\t\tnew FastClick(document.body, {\n \t\t\texcludeNode: '^pac-'\n\t\t});\n\t}\n\n\tvar API = $(\"#menu\").data( \"mmenu\" );\n\n\t$(\".hamburger\").click(function(){\n\t\tif ($(\"#menu\").hasClass(\"mm-opened\")) {\n\t\t\tAPI.close();\n\t\t} else {\n\t\t\tAPI.open();\n\t\t}\n\t\t\n\t\t$(this).blur();\n\t\t\n\t});\n\n\tAPI.bind(\"opening\",function(){\n\t\t$(\".hamburger\").addClass(\"is-active\");\n\t});\n\n\tAPI.bind(\"closing\",function(){\n\t\t$(\".hamburger\").removeClass(\"is-active\");\n\t\tsetupWizard.stopProgress();\n\t});\n\n\t\t\n\tif (isCordovaApp) {\n\t\t$(\".hamburger\").addClass(\"cordova-app\");\n\t\tnavigator.splashscreen.hide();\n\t}\n\t$(\".hamburger\").css({\"top\": 0});\n\n\t\n\t$(\"#routeplanner\").click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\t//$(\"#route-overview\").show();\n\t\t\ttoggleWaypoints.toggle();\n\t\t},410);\n\t});\n\n\t$('#route-settings').click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\t$(\"#vehicle-energy-data\").show();\n\t\t},410);\n\t});\n\n\t$('#wizard').click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\tAPI.openPanel($(\"#mm-0\"))\n\t\t\tsetupWizard.firstVisit();\t\n\t\t},410);\n\t});\n\n\t$(\"#heatmyleaf\").click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\t$(\".carwings-login\").show();\n\t\t},410);\n\t})\n\n\t$(\"#about\").click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\t$(\"#about-menu\").show();\n\t\t},410);\t\t\n\t});\n\n\t$(\"#showlocation\").click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\tlocationController.toggleWatch(true);\n\t\t\t//getCurrentLocation();\n\t\t},410);\n\t});\n\n\t$(\".models span\").click(function(e){\n\t\t$(\".models span > i\").fadeTo(50,0);\n\t\t$(this).children(\"i\").fadeTo(50,1);\n\t\t//API.openPanel($(\"#mm-2\"));\n\n\t\t//which manufacturer was clicked\n\t\tvar manufacturer = Number($(this).attr(\"value\"));\n\n\t\t//which model was clicked\n\t\tvar models = $($(this).parents(\".models\"))\n\t\t\t\t\t\t\t  .find(\"span\");\n\n\t\tvar model = $(models).index(this);\n\n\t\tvehicleController.setVehicle(manufacturer,model);\n\t\t\t\t\t\t\n\t\tsetupWizard.stopProgress();\n\t\t\t\t\n\t});\n\n\t$(\".connectors span\").click(function(e){\n\t\tconnectorsController.update(Number($(this).attr(\"data-value\")));\n\t});\n\n\t$(\".networks span\").click(function(e){\n\t\t$(this).toggleClass(\"network-selected\");\n\t\tprovidersController.update();\n\t\t//providersController.update($(this).attr(\"data-value\"));\n\t});\n\n\tsetupWizard.setAPI(API);\n\n\t$(\".vehicle-data-row\").blur(function(){\n\t\tvehicleDataController.update();\n\t});\t\n\n\t$(\".logout\").click(function(){\n\t\tAPI.close();\n\t\tsetTimeout(function(){\n\t\t\tuserController.toggleLoginStatus();\n\t\t},410);\t\n\t})\n\n\tInitialiseMap();\n\n};\n\nvar networkStatusController = function() {\n\tvar networkIsOnline = false;\n\treturn {\n\t\tonlineEvent: function(){\n\t\t\tnetworkIsOnline = true;\n\t\t\tnetworkFailure.hide();\n\t\t},\n\t\tofflineEvent: function(){\n\t\t\tnetworkIsOnline = false;\n\t\t\tnetworkFailure.show();\n\t\t},\n\t\tisOnline: function(){\n\t\t\treturn networkIsOnline;\n\t\t}\n\t};\n}();\n\nfunction setUp(){\n\n\tif (device === \"portable\"){\n\t\tnavMenu.initMobile();\t\n\t}\n\n\t$(window).on(\"online\",function(){\n\t\tnetworkStatusController.onlineEvent();\n\t});\n\t$(window).on(\"offline\",function(){\n\t\tnetworkStatusController.offlineEvent();\n\t});\n\n\tvehicleDataController.init();\n\t\n\n\tdocument.getElementById(\"routestart\").addEventListener(\"focus\",function() {\n\t\tactiveRouteInputElement = \"start\";\n\t});\n\tdocument.getElementById(\"routestart\").addEventListener(\"blur\",function() {\n\t\tsetTimeout(function(){\n\t\t\tif (activeRouteInputElement != \"end\"){\n\t\t\t\tactiveRouteInputElement = \"\";\n\t\t\t}\n\t\t\tif (document.getElementById(\"routestart\").value == \"\"){\n\t\t\t\troute.start = \"Not yet added.\";\n\t\t\t} else {\n\t\t\t\troute.start = document.getElementById(\"routestart\").value;\n\t\t\t}\n\t\t\t//updateWaypointTable();\n\t\t},100);\n\t\t\n\t});\n\t\tdocument.getElementById(\"routeend\").addEventListener(\"focus\",function() {\n\t\tactiveRouteInputElement = \"end\";\n\t});\n\t// document.getElementById(\"routeend\").addEventListener(\"blur\",function() {\n\t// \ttimeOut = setTimeout(function(){\n\t// \t\tif (activeRouteInputElement !== \"start\"){\n\t// \t\t\tactiveRouteInputElement = \"\";\n\t// \t\t}\n\t// \t\tif (document.getElementById(\"routeend\").value == \"\"){\n\t// \t\t\troute.end = \"Not yet added.\";\n\t// \t\t} else {\n\t// \t\t\troute.end = document.getElementById(\"routeend\").value;\n\t// \t\t\tif (document.getElementById(\"routestart\").value !== \"\"){\n\t// \t\t\t\tcalcRoute();\n\t// \t\t\t}\n\t// \t\t}\n\n\t// \t\t//updateWaypointTable();\n\t// \t},250);\n\t\n\t// });\n\n\tif (urlParamsController.getParams()['src'] == \"evhw\"){\n\t\tconnectorsController.update(1);\n\t\tconnectorsController.update(2);\n\t\tconnectorsController.update(3);\n\t\tconnectorsController.update(4);\n\t\tconnectorsController.update(7);\n\t} else {\n\t\tconnectorsController.update(\"\",true);\n\t}\n\t\n\tif (connectors == \"none\" || localStorage.newIntro === undefined){ \n\t\t//We don't have a stored connector, so display message.\n\t\tlocalStorage.newIntro = true;\n\t\tsetupWizard.firstVisit();\n\t} else {\n\t\t//We have a stored connector, so check whether the cookie message has been seen.\n\t\tif (getCookie(\"beer\") == \"\" && !isCordovaApp) { //Have they seen the beer message alert?\n\t\t\tswal({\n\t\t\t\ttitle:\"Just a quick one..\",\n\t\t\t\ttext:\"You can now buy me a beer from the <b>Support</b> menu if you find this site useful :) <br><br>(This'll close in a second)\",\n\t\t\t\thtml:true,\n\t\t\t\ttype: \"info\",\n\t\t\t\ttimer: 6000\n\t\t\t});\n\n\t\t\taddCookie(\"beer\",\"true\",365);//update cookie so we don't display it again.\n\t\t}\t\t\n\t}\n\n\t\n\n\t//add our event listeners\n\n\t$(\"#about-menu h3\").click(function(e){\n\t\tif (this == e.target){\n\t\t\t$(\"#about-menu .menu-cont\").eq($(\"#about-menu h3\").index(this)).slideToggle();\n\t\t\t$(\"#about-menu .expand-v\").eq($(\"#about-menu h3\").index(this)).fadeToggle();\t\t\t \n\t\t}\n\t});\n\n\t$('.popup-window>i').click(function(e){\n\t\t$(e.target.parentNode).hide();\n\t});\n\n\t$('.w3-modal .w3-closebtn').click(function(e){\n\t\t$(e.target).parents(\".w3-modal\").hide();\n\t\t$(\"#loading\").hide();\n\t\t$(\"#carwings-submit\").prop(\"disabled\",false);\n\t\t$(\"#carwings-submit\").css({\"opacity\":1});\n\t});\n\n\t$(\".myroute-title\").click(function(){\n\t\t$(\".directions-display-cont\").slideToggle();\n\t\t$(\".myroute-title > .expand-v\").fadeToggle();\n\t});\n\n\t$(\".myroute-tab\").click(function(){\n\t\ttoggleWaypoints.toggle();\n\t});\n\t\n\t$(\"#route-overview\").css(\"left\", ($(\"#route-overview\").width() + Number($(\"#route-overview\").css(\"margin-left\").replace(\"px\", \"\")) + $(\".myroute-tab\").width()) * -1).show();\n\n\t$(window).on(\"orientationchange resize\", function() {\n\t\tif (toggleWaypoints.isActive()){\n\t\t\t$(\"#route-overview\").css(\"left\", ($(\"#route-overview\").width() + Number($(\"#route-overview\").css(\"margin-left\").replace(\"px\", \"\")) + $(\".myroute-tab\").width()) * -1);\n\t\t}\n\t});\n\n\t$('.about img').click(function(){\n\t\t$(\".menu-cont\").hide();\n\t\t$('.about').hide();\n\t\t$(\".about .expand-v\").show();\n\n\t});\n\n\t$(\".mobile-triangle-cont\").click(function(){\n\t\ttoggleWaypoints.toggle();\n\t});\n\n\t$(\"#planner-close\").click(function(){\n\t\ttoggleWaypoints.toggle();\n\t});\n\n\telementEventBinder.routeInputClear($(\".route-input-clear\"));\n\telementEventBinder.routeInputs($(\".routeinput\"));\n\n\t$(\".icon-link\").prop(\"target\",\"_blank\").prop(\"href\",function(index){\n\t\tif (index == 0) {return;}\n\t\tif (index == 1){\n\t\t\treturn \"https://www.facebook.com/EVHighwayStatus/\";\n\t\t} else if (index == 2) {\n\t\t\treturn \"https://twitter.com/EVHighwayMap\";\n\t\t} else {\n\t\t\treturn \"https://plus.google.com/communities/108139006036148477833\";\n\t\t}\n\t});\t\n\n\t$(\".location-arrow\").click(function(index){\n\t\tlocationController.toggleWatch(true);\n\t});\n\n\t$(\".vehicle-data-row\").blur(function(){\n\t\tvehicleDataController.update();\n\t});\n\n\t$(\".temperature-value\").blur(function(){\n\t\tvehicleDataController.update();\n\t});\n\n\t$(\".vehicle-unit\").click(function(){\n\t\tif (this.checked){\n\t\t\tvehicleDataController.setUnit(parseFloat(this.value));\n\t\t}\n\t});\n\n\n\t$(\".route-overview-title\").click(function(){\n\t\tvar amountToScroll = $(\"#route-cont\").scrollTop();\n\t\tvar i = 0;\n\t\twhile (amountToScroll > 0) {\n\t\t\tsetTimeout(scroll,i,amountToScroll - 1);\n\t\t\t//$(\"#route-cont\").scrollTop(amountToScroll - 1);\n\t\t\t//amountToScroll = $(\"#route-cont\").scrollTop();\n\t\t\tamountToScroll--;\n\t\t\tamountToScroll--;\n\t\t\ti++;\n\t\t}\n\t\t\n\t});\n\n\tfunction scroll(amount) {\n\t\t$(\"#route-cont\").scrollTop(amount);\n\t}\n\n\t$(\"#reset-vehicle-data\").click(function(){\n\t\tvehicleDataController.reset();\n\t});\n}\n\nvar elementEventBinder = function(){\n\treturn {\n\t\trouteInputs: function(elements) {\n\t\t\t$(elements).blur(function(){\n\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tvar readyToCalc = true;\n\t\t\t\t\t$(\".routeinput\").each(function(){\n\t\t\t\t\t\tif (!this.value) {\n\t\t\t\t\t\t\treadyToCalc = false;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (readyToCalc) {\n\t\t\t\t\t\tcalcRoute();\n\t\t\t\t\t}\n\t\t\t\t},100);\n\t\t\t});\n\t\t\n\t\t},\n\t\trouteInputClear: function(elements) {\n\t\t\t$(elements).click(function(){\n\t\t\t\t$(\".routeinput\").eq($(\".route-input-clear\").index(this)).val(\"\");\n\t\t\t});\n\t\t}\n\t};\n}();\n\nvar setupWizard = function(){\n\tvar inProgress = false;\n\tvar choosingNetworks = false;\n\tvar choosingVehicle = false;\n\tvar choosingConnector = false;\n\tvar API;\n\treturn {\n\t\tfirstVisit: function(){\n\t\t\tinProgress = true;\n\t\t\tswal({\n\t\t\t\ttitle:\"Welcome!\",\n\t\t\t\ttext:\"A warm welcome to you - this is our Setup Wizard. Would you like help setting up a few parameters?\",\n\t\t\t\ttype: \"info\",\n\t\t\t\tshowConfirmButton: true,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: false,\n\t\t\t\tcloseOnCancel: false,\n\t\t\t\tconfirmButtonText: \"Sure!\",\n\t\t\t\tcancelButtonText: \"Skip\"\n\t\t\t}, function(isConfirm){\n\t\t\t\tif (isConfirm){\n\t\t\t\t\tswal({\n\t\t\t\t\t\ttitle:\"Setup\",\n\t\t\t\t\t\ttext:\"To allow us to set the right EV connector and battery capacity for route planning purposes, please select your vehicle.\",\n\t\t\t\t\t\ttype: \"info\",\n\t\t\t\t\t\tshowCancelButton: true,\n\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\tcloseOnCancel: false,\n\t\t\t\t\t\tconfirmButtonText: \"Choose\",\n\t\t\t\t\t\tcancelButtonText: \"Skip\"\n\t\t\t\t\t}, function (isConfirm){\n\t\t\t\t\t\tif (isConfirm){\n\t\t\t\t\t\t\tAPI.open();\n\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\tAPI.openPanel($(\"#mm-3\"));\n\t\t\t\t\t\t\t},500);\n\t\t\t\t\t\t\tchoosingVehicle = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinProgress = false;\n\t\t\t\t\t\t\tswal({\n\t\t\t\t\t\t\t\ttitle:\"Enjoy..\",\n\t\t\t\t\t\t\t\ttext:\"No problem - you can find all our settings in our menu which is accessed via the 'burger' icon in the corner. \",\n\t\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\t\t\t\tconfirmButtonText: \"Okay\"\n\t\t\t\t\t\t\t},function(){\n\t\t\t\t\t\t\t\tswal.close();\n\t\t\t\t\t\t\t\tif (getCookie(\"cookies\") === \"\" && !isCordovaApp){\n\t\t\t\t\t\t\t\t\tcookieMessage();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$(document).trigger(\"showAlerts\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tinProgress = false;\n\t\t\t\t\tswal({\n\t\t\t\t\t\ttitle:\"Enjoy..\",\n\t\t\t\t\t\ttext:\"No problem - you can find all our settings in our menu which is accessed via the 'burger' icon in the corner. \",\n\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\tconfirmButtonText: \"Okay\"\n\t\t\t\t\t},function(){\n\t\t\t\t\t\tswal.close();\n\t\t\t\t\t\tif (getCookie(\"cookies\") === \"\" && !isCordovaApp){\n\t\t\t\t\t\t\tcookieMessage();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$(document).trigger(\"showAlerts\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t\t\t\n\t\t},\n\t\tpostVehicleSelection: function(vehicle){\n\t\t\tif (choosingVehicle){\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tAPI.close();\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tAPI.openPanel($(\"#mm-0\"));\n\t\t\t\t\t},500);\n\t\t\t\t},250);\n\n\t\t\t\tchoosingVehicle = false;\n\t\t\t\t\n\t\t\t\tvar vehicle = vehicleController.getVehicle();\n\n\t\t\t\t//Did the user choose a valid vehicle? \n\n\t\t\t\tif (vehicle.manufacturer !== \"Other\") {\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tswal({\n\t\t\t\t\t\t\ttitle:\"Setup\",\n\t\t\t\t\t\t\ttext:\"Okay, we've set your vehicle to the \" + vehicle.manufacturer + \" \" + vehicle.model.modelName + \".\\n\\nThe \" + vehicle.model.modelName + \"'s primary connector is the \" + getConnectorName(vehicle.model.connectors[0]) + \" connector. Would you like the map to only display locations with this connector?\\n\\n(You can change this at any time)\" , \n\t\t\t\t\t\t\ttype: \"info\",\n\t\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\t\tshowCancelButton: true,\n\t\t\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\t\t\tcloseOnCancel: false,\n\t\t\t\t\t\t\tconfirmButtonText: \"Yes please\",\n\t\t\t\t\t\t\tcancelButtonText: \"Skip\"\n\t\t\t\t\t\t}, function (isConfirm) {\n\t\t\t\t\t\t\tif (isConfirm){\n\t\t\t\t\t\t\t\tconnectorsController.clear();\n\t\t\t\t\t\t\t\tconnectorsController.update(vehicle.model.connectors[0]);\n\t\t\t\t\t\t\t\t//userGreeting.setupComplete();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetupWizard.networkSelection();\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t},750);\t\n\n\t\t\t\t} else {\n\t\t\t\t\t//User chose \"other\" vehicle\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tswal({\n\t\t\t\t\t\t\ttitle:\"Setup\",\n\t\t\t\t\t\t\ttext:\"Looks like we don't list your vehicle yet, sorry about that.<br><br>Please specify the battery capacity (kWh, usable) to use for route planning:\" , \n\t\t\t\t\t\t\ttype: \"input\",\n\t\t\t\t\t\t\tinputPlaceholder: \"for example: \\\"21.5\\\"\",\n\t\t\t\t\t\t\thtml: true,\n\t\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\t\tshowCancelButton: false,\n\t\t\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\t\t\tcloseOnCancel: false,\n\t\t\t\t\t\t\tconfirmButtonText: \"Confirm\",\n\t\t\t\t\t\t\t//cancelButtonText: \"Skip\"\n\t\t\t\t\t\t}, function (inputValue) {\n\t\t\t\t\t\t\tif (inputValue === \"\" || !(Number(inputValue) <= 100 && Number(inputValue) >= 1) ) {\n\t\t\t\t\t\t\t\tswal.showInputError(\"Please enter a value between 1 and 100\");\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tchargeSuggestionController.setCapacity(Number(inputValue)*1000);\n\t\t\t\t\t\t\tswal({\n\t\t\t\t\t\t\t\ttitle:\"Setup\",\n\t\t\t\t\t\t\t\ttext:\"Great! We've updated the planner to <b>\"+Number(inputValue).toFixed(2)+\"</b> kWh.<br><br>Next, please choose your vehicle's connector(s), just close the menu when you're done to continue.\" , \n\t\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\t\thtml: true,\n\t\t\t\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t\t\t\tshowCancelButton: false,\n\t\t\t\t\t\t\t\tcloseOnConfirm: true,\n\t\t\t\t\t\t\t\tcloseOnCancel: false,\n\t\t\t\t\t\t\t\tconfirmButtonText: \"Choose\",\n\t\t\t\t\t\t\t\t//cancelButtonText: \"Skip\"\n\t\t\t\t\t\t\t}, function (isConfirm) {\n\t\t\t\t\t\t\t\tAPI.open();\n\t\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\t\tAPI.openPanel($(\"#mm-2\"));\n\t\t\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\t\t\tAPI.openPanel($(\"#mm-11\"));\n\t\t\t\t\t\t\t\t\t},500);\n\t\t\t\t\t\t\t\t},500);\n\t\t\t\t\t\t\t\tchoosingConnector = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t},750);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tnetworkSelection: function(){\n\t\t\tvar networkCount = $(\".networks li\").length;\n\t\t\tswal({\n\t\t\t\ttitle:\"Setup\",\n\t\t\t\ttext:\"Next up we have the network selection. We currently show rapid status data for \" + networkCount + \" providers in the UK.\\n\\nDo you want to show all of them, or choose a specific set?\" , \n\t\t\t\ttype: \"info\",\n\t\t\t\tshowConfirmButton: true,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: false,\n\t\t\t\tcloseOnCancel: true,\n\t\t\t\tconfirmButtonText: \"All\",\n\t\t\t\tcancelButtonText: \"Choose now\"\n\t\t\t}, function (isConfirm) {\n\t\t\t\tif (isConfirm){\n\t\t\t\t\tprovidersController.selectAll();\n\t\t\t\t\tsetupWizard.setupComplete();\n\t\t\t\t\tinProgress = false;\n\t\t\t\t} else {\n\t\t\t\t\tchoosingNetworks = true;\n\t\t\t\t\tAPI.open();\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tAPI.openPanel($(\"#mm-2\"));\n\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\tAPI.openPanel($(\"#mm-10\"));\n\t\t\t\t\t\t},500);\n\t\t\t\t\t},500);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\t\t\t\t\t\n\t\t},\n\t\tpostNetworkSelection: function(){\n\t\t\tsetTimeout(function(){\n\t\t\t\tAPI.openPanel($(\"#mm-0\"));\n\t\t\t\tsetupWizard.setupComplete();\n\t\t\t},500);\n\t\t\t\n\t\t\tinProgress = false;\n\t\t\tchoosingNetworks = false;\n\t\t},\n\t\tpostConnectorSelection: function(){\n\t\t\tchoosingConnector = false;\n\t\t\tAPI.closeAllPanels();\n\t\t\tvar connectorNamesArray = connectorsController.getNameArray();\n\t\t\tvar listString = \"<ul>\";\n\t\t\tconnectorNamesArray.forEach(function(value){\n\t\t\t\tlistString += \"<li>\"+value+\"</li>\";\n\t\t\t});\n\t\t\tlistString += \"</ul>\";\n\n\t\t\tsetTimeout(function(){\n\t\t\t\tswal({\n\t\t\t\t\ttitle:\"Setup\",\n\t\t\t\t\ttext:\"Okay, we've set the connector(s) to:<br>\"+listString, \n\t\t\t\t\ttype: \"info\",\n\t\t\t\t\thtml:true,\n\t\t\t\t\tshowConfirmButton: true,\n\t\t\t\t\t//showCancelButton: true,\n\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\t//closeOnCancel: true,\n\t\t\t\t\tconfirmButtonText: \"Next\",\n\t\t\t\t\t//cancelButtonText: \"I'll choose later\"\n\t\t\t\t}, function(){\n\t\t\t\t\tsetupWizard.networkSelection();\n\t\t\t\t});\t\n\t\t\t},500);\n\n\t\t\t\n\t\t},\n\t\tsetupComplete: function(){\n\t\t\tswal({\n\t\t\t\ttitle:\"Complete\",\n\t\t\t\ttext:\"You're all set.\\n\\nGo explore and enjoy our site. We hope you enjoy your stay. If you need any assistance, feel free to get in touch via the 'Support' link in the menu.\" , \n\t\t\t\ttype: \"success\",\n\t\t\t\tshowConfirmButton: true,\n\t\t\t\t//showCancelButton: true,\n\t\t\t\tcloseOnConfirm: true,\n\t\t\t\t//closeOnCancel: true,\n\t\t\t\tconfirmButtonText: \"Let's go!\",\n\t\t\t\t//cancelButtonText: \"I'll choose later\"\n\t\t\t},function(){\n\t\t\t\tif (getCookie(\"cookies\") === \"\" && !isCordovaApp){\n\t\t\t\t\tcookieMessage();\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t$(document).trigger(\"showAlerts\");  \n\t\t\t});\n\t\t\t\n\t\t},\n\t\tsetAPI: function(link){\n\t\t\tAPI = link;\n\t\t},\n\t\tstopProgress: function(){\n\t\t\tif (inProgress){\n\t\t\t\tif (choosingNetworks) {\n\t\t\t\t\tsetupWizard.postNetworkSelection();\n\t\t\t\t} else if (choosingVehicle) {\n\t\t\t\t\tsetupWizard.postVehicleSelection();\n\t\t\t\t} else if (choosingConnector) {\n\t\t\t\t\tsetupWizard.postConnectorSelection();\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}();\n\nfunction processRouteDirect() {\n  \tvar start = document.getElementById(\"routestart\").value;\n  \tvar end = document.getElementById(\"routeend\").value;\n\n  \tif ((start != \"\") && (end != \"\")){\n  \t\tcalcRoute();\n  \t}\n}\n\nfunction setConnectorFromCookie(override) {\n\t\n\tif (override === undefined){\n\t\tvar connector = getConnectorFromCookie();\n\t} else {\n\t\tvar connector = override;\n\t}\n\t\n\tif (connector != false) {\n\t\tshowMarkers(connector);\n\t\t\n\t} else {\n\t\treturn false;\n\t} \n}\n\nfunction getConnectorFromCookie(override) {\n\n\tif (override === undefined){\n\t\tvar connector = getCookie(\"connector\");\t\n\t} else {\n\t\tvar connector = override;\n\t}\n\n\tif (connector == \"CCS\") {\n\t\tsetConnectorCheckmark(0);\n\t\treturn \"CCS\";\n\t} else if (connector == \"CHAdeMO\" || connector == \"CHAdeMO AC\") {\n\t\tsetConnectorCheckmark(1);\n\t\treturn \"CHAdeMO\";\n\t} else if (connector == \"AC\") {\n\t\tsetConnectorCheckmark(2);\n\t\treturn \"AC\";\n\t} else if (connector == \"AC Medium\") {\n\t\tsetConnectorCheckmark(2);\n\t\treturn \"AC\";\n\t} else if (connector == \"Tesla\") {\n\t\tsetConnectorCheckmark(3);\n\t\treturn \"Tesla\";\n\t} else if (connector == \"All\") {\n\t\tsetConnectorCheckmark(4);\n\t\treturn \"All\";\n\t} else {\n\t\treturn false;\n\t} \n}\n\n//\n// Math functions\n//\n\nfunction calcCordDistance(lat1, lng1, lat2, lng2) {\n\tvar p = 0.017453292519943295;    // Math.PI / 180\n\tvar c = Math.cos;\n\tvar a = 0.5 - c((lat2 - lat1) * p)/2 + \n          c(lat1 * p) * c(lat2 * p) * \n          (1 - c((lng2 - lng1) * p))/2;\n\n\treturn 12742 * Math.asin(Math.sqrt(a)); // 2 * R; R = 6371 km\n}\n\nfunction calcBearing(lat1,lng1,lat2,lng2){\n\tvar y = Math.sin((lng2-lng1)*(Math.PI/180)) * Math.cos(lat2*(Math.PI/180));\n\tvar x = Math.cos(lat1*(Math.PI/180))*Math.sin(lat2*(Math.PI/180)) -\n        Math.sin(lat1*(Math.PI/180))*Math.cos(lat2*(Math.PI/180))*Math.cos((lng2-lng1)*(Math.PI/180));\n\tvar brng = Math.atan2(y, x);\n\n\treturn (brng * (180/Math.PI) + 360) % 360;\n}\n\n//\n//\tVehicle function\n//\n\nfunction getConnectorName(id){\n\t\tvar text;\n\n\t\tif (id == 1) {\n\t\t\ttext = \"CHAdeMO\";\n\t\t\treturn text;\n\t\t} else if (id == 2) {\n\t\t\ttext = \"CCS\";\n\t\t\treturn text;\n\t\t} else if (id == 3) {\n\t\t\ttext = \"Rapid AC\";\n\t\t\treturn text;\n\t\t} else if (id == 7) {\n\t\t\ttext = \"Tesla\";\n\t\t\treturn text;\n\t\t} else if (id == 6) {\n\t\t\ttext = \"AC Medium\";\n\t\t\treturn text;\n\t\t} else {\n\t\t\treturn \"\";\n\t\t}\n}\n\nvar vehicleController = function(){\n\t\n\n\tvar vehicles = {\n\t\t0: {\n\t\t\tmanufacturer: \"BMW\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"i3 (60Ah)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 22,\n\t\t\t\t\t\tusable: 18.8\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t1: {\t\t\n\t\t\t\t\tmodelName: \"i3 (94Ah)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 33,\n\t\t\t\t\t\tusable: 27.2\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t2: {\n\t\t\t\t\tmodelName: \"i3 REx (60Ah)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 22,\n\t\t\t\t\t\tusable: 18.8\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2 \n\t\t\t\t\t]\n\n\t\t\t\t},\n\t\t\t\t3: {\t\t\n\t\t\t\t\tmodelName: \"i3 REx (94Ah)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 33,\n\t\t\t\t\t\tusable: 27.2\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t1: {\n\t\t\tmanufacturer: \"Nissan\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"LEAF (24kWh)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 24,\n\t\t\t\t\t\tusable: 21.3\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t1\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t1: {\n\t\t\t\t\tmodelName: \"LEAF (30kWh)\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 30,\n\t\t\t\t\t\tusable: 28.5\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t1\n\t\t\t\t\t]\n\t\t\t\t}\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t2: {\n\t\t\tmanufacturer: \"Renault\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"Zoe Q210\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 26,\n\t\t\t\t\t\tusable: 22\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t1: {\n\t\t\t\t\tmodelName: \"Zoe R240\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 26,\n\t\t\t\t\t\tusable: 23.3\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t}\t\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t3: {\n\t\t\tmanufacturer: \"Tesla\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"Model S 60\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 60,\n\t\t\t\t\t\tusable: 53.4\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t7,\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t1: {\n\t\t\t\t\tmodelName: \"Model S 70\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 70,\n\t\t\t\t\t\tusable: 62.3\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t7,\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t2: {\n\t\t\t\t\tmodelName: \"Model S 80\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 80,\n\t\t\t\t\t\tusable: 71.2\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t7,\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t3: {\n\t\t\t\t\tmodelName: \"Model S 85\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 85,\n\t\t\t\t\t\tusable: 75.6\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t7,\n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t4: {\n\t\t\t\t\tmodelName: \"Model S 90\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 90,\n\t\t\t\t\t\tusable: 80.1\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t7, \n\t\t\t\t\t\t3\n\t\t\t\t\t]\n\t\t\t\t}\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t4: {\n\t\t\tmanufacturer: \"Volkswagen\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"e-Golf\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 24,\n\t\t\t\t\t\tusable: 21.5\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t1: {\n\t\t\t\t\tmodelName: \"e-Up\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 18.7,\n\t\t\t\t\t\tusable: 16.8\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t}\n\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t5: {\n\t\t\tmanufacturer: \"Other\",\n\t\t\tmodels: {\n\t\t\t\t0: {\n\t\t\t\t\tmodelName: \"Not listed\",\n\t\t\t\t\tbattery: {\n\t\t\t\t\t\trated: 10,\n\t\t\t\t\t\tusable: 10\n\t\t\t\t\t},\n\t\t\t\t\tconnectors: [\n\t\t\t\t\t\t2\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t};\n\n\t\n\t\n\tvar faCheck = '<i class=\"fa fa-check fa-fw\" aria-hidden=\"true\"></i>';\n\tvar currentManufacturer;\n\tvar currentModel;\n\n\treturn {\n\t\tinit: function(id){\n\t\t\tvar manufacturer = 0;\n\t\t\t\n\t\t\twhile (vehicles[manufacturer]) {\n\t\t\t\tvar thisManufacturer = $(\"<li>\").append($(\"<span>\").html(vehicles[manufacturer].manufacturer));\n\t\t\t\tvar modelList = $(\"<ul>\",{class: \"models\"})\n\n\t\t\t\tvar model = 0;\n\t\t\t\twhile (vehicles[manufacturer].models[model]) {\n\t\t\t\t\t$(modelList).append($(\"<li>\").append($(\"<span>\").html(faCheck + vehicles[manufacturer].models[model].modelName).attr(\"value\",String(manufacturer))));\n\t\t\t\t\tmodel++;\n\t\t\t\t}\n\n\t\t\t\t$(thisManufacturer).append(modelList);\n\t\t\t\t$(\".manufacturers\").append(thisManufacturer);\n\n\t\t\t\tmanufacturer++;\n\t\t\t}\t\n\t\t},\n\t\tsetVehicle: function(manufacturer,model){\n\t\t\t//set capacity for planner\n\t\t\tvar batt = vehicles[manufacturer].models[model].battery.usable;\n\t\t\tchargeSuggestionController.setCapacity(batt*1000);\n\t\t\t$(\"#route-kwh-capacity\").trigger(\"blur\");\n\t\t\tcurrentManufacturer = manufacturer;\n\t\t\tcurrentModel = model;\n\t\t},\n\t\tgetVehicle: function(){\n\t\t\treturn {\n\t\t\t\tmanufacturer: vehicles[currentManufacturer].manufacturer,\n\t\t\t\tmodel: vehicles[currentManufacturer].models[currentModel],\n\t\t\t};\n\t\t}\n\t};\n}();\n\n//\n// Map functions\n//\n\nfunction AutoCompleteCustom(inputElement){\n\t//cache our results\n\tvar results = [];\n\n\t//Our request\n\tvar autoCompleteRequest = {};\n\n\t//Our field value\n\tvar inputFieldContent = '';\n\n\t//Save our input element string\n\t//this.inputId = inputElement;\n\n\t//grab our element\n\tvar inputElement = parseInputForElement(inputElement);\n\n\tvar inputBlurTimeout;\n\n\t//Setup listeners\n\n\t//Call inputChanged on paste and keydown, with 100ms debounce\n\t$(inputElement).on(\"paste keydown click\",function(){\n\t\tvar timeout;\n\t\treturn function(e){\n\t\t\tif (e.key == \"Tab\") {return;}\n\t\t\tif (e.type === \"click\") {\n\t\t\t\tif ($(\".autocomplete-container\").length) {\n\t\t\t\t\tclearView();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(inputChanged,100,this);\n\t\t}\n\t}());\n\n\t//clear the view if user clicks away\n\t$(inputElement).on(\"blur\",function(e){\n\t\tinputBlurTimeout = setTimeout(clearView,100);\n\t});\n\n\t//Our autocomplete functions\n\n\tfunction inputChanged(that){\n\t\t//get the map center\n\t\tvar center = map.getCenter();\n\n\t\t//get span of bounds\n\t\tvar bounds = map.getBounds();\n\t\tvar radius = calcCordDistance(bounds.getNorthEast().lat(), bounds.getNorthEast().lng(),\n\t\t\t\t\t\t\t\t\t  bounds.getSouthWest().lat(), bounds.getSouthWest().lng()) / 2;\n\n\t\tinputFieldContent = $(that).val();\n\n\t\t// if (inputFieldContent === \"\") {\n\t\t// \tclearView();\n\t\t// \treturn;\n\t\t// }\n\t\t\n\t\tautoCompleteRequest = {\n\t\t\tinput: inputFieldContent,\n\t\t\tlocation: center.toUrlValue(),\n\t\t\tradius: radius * 1000\n\t\t};\n\n\t\t//Post the content for autocomplete suggestions\n\t\tajaxHandler({\n\t\t\turl: \"php/autocomplete.php\",\n\t\t\tdata: autoCompleteRequest,\n\t\t\tsuccess: updateView\n\t\t});\n\t\t// $.post(\"https://evhighwaystatus.co.uk/php/autocomplete.php\",JSON.stringify(autoCompleteRequest))\n\t\t//  .done(updateView)\n\t\t//  .fail(function(a,b,c){\n\t\t//   \tvar test = a;\n\t\t//  });\n\t}\n\n\t//create and display array of results\n\n\tfunction addResult(prediction){\n\n\t\t//Form the result\n\t\tvar description = prediction.description;\n\t\tvar matchedSubstring = description.substr(prediction.matched_substrings[0].offset, prediction.matched_substrings[0].length);\n\t\tvar leftText = description.substr(0,prediction.matched_substrings[0].offset);\n\t\tvar rightText = description.slice(prediction.matched_substrings[0].offset + prediction.matched_substrings[0].length);\n\n\t\t//bold up the matched string\n\t\tvar resultString = leftText + \"<b>\" + matchedSubstring + \"</b>\" + rightText;\n\n\t\t//Split the result by \",\" so we can style the results\n\t\tvar ar = resultString.split(\",\");\n\n\t\tar.forEach(function(value,index){\n\t\t\tar[index] = value.trim();\n\t\t});\n\n\t\tresultString = ar[0];\n\n\t\tif (ar.length > 1){\n\t\t\tar = ar.splice(1);\n\t\t\tresultString = resultString + \"<span>\" + ar.join(\", \") + \"</span>\";\t\n\t\t}\n\n\t\t$resultRow = $(\"<div>\",{class: \"autocomplete-row\"}).append('<div class=\"autocomplete-icon\"><i class=\"fa fa-map-marker fa-fw\"></i></div><div class=\"autocomplete-result\">'+resultString+\"</div>\").click(function(e){\n\t\t\t$(inputElement).val(results.predictions[($(\".autocomplete-row\").index(e.delegateTarget))-1].description);\n\t\t\t//clearView();\n\t\t\t//clearTimeout(inputBlurTimeout);\n\t\t\t//$(inputElement).blur();\n\t\t});\n\t\t\n\t\t$(inputElement).siblings(\".autocomplete-container\").append($resultRow);\n\t}\n\n\tfunction addCurrentLocationResultRow() {\n\t\t$resultRow = $(\"<div>\",{class: \"autocomplete-row\"}).append('<div class=\"autocomplete-icon\"><i class=\"fa fa-location-arrow fa-fw\"></i></div><div class=\"autocomplete-result\">My current location</div>').click(function(e){\n\t\t\t$(inputElement).parent().append('<i class=\"fa fa-spinner fa-pulse fa-fw myposition-loading\"></i>');\n\t\t\tlocationController.requestLocationNow(function(position){\n\t\t\t\tgeocodeReverseRequest({\n\t\t\t\t\tlat: position.coords.latitude, \n\t\t\t\t\tlng: position.coords.longitude\n\t\t\t\t},function(results){\n\t\t\t\t\t$(inputElement).siblings(\".myposition-loading\").remove();\n\t\t\t\t\t$(inputElement).val(results[0].formatted_address);\n\t\t\t\t});\n\t\t\t},\n\t\t\tfunction(){\n\t\t\t\t$(inputElement).siblings(\".myposition-loading\").remove();\n\t\t\t});\t\t\n\t\t});\n\n\t\t$(inputElement).siblings(\".autocomplete-container\").append($resultRow);\n\t}\n\n\tfunction updateView(data){\n\t\tresults = data;\n\n\t\t//Don't update if we've cleared the input field before this response arrived\n\t\tif (!$(document.activeElement).is(inputElement)) {\n\t\t\tclearView();\n\t\t\treturn;\n\t\t}\n\n\t\t$(inputElement).siblings(\".autocomplete-container\").remove();\n\t\t$container = $(\"<div>\",{class: \"autocomplete-container\"});\n\t\t$(inputElement).after($container);\n\n\t\taddCurrentLocationResultRow();\n\n\t\tfor (var i = 0; i < results.predictions.length; i++) {\n\t\t\taddResult(results.predictions[i]);\n\t\t};\n\t}\n\n\tfunction clearView(){\n\t\t$(inputElement).siblings(\".autocomplete-container\").remove();\n\t}\n\n\tfunction parseInputForElement(input) {\n\t\tif (typeof(input) === \"string\") {\n\t\t\treturn $(\"#\"+input);\n\t\t} else if ($.isArray(input)) {\n\t\t\treturn input[0];\n\t\t} else {\n\t\t\treturn input;\n\t\t}\n\t}\n}\n\n\n\nsetTimeout(function(){\n\t\n},5000);\n\n\n\nfunction InitialiseMap() {\n\n\turlParamsController.fetch();\n\n\tmapMask.show({\n\t\ttype: \"mapLoad\",\n\t\tshowAnimation: true,\n\t});\n\n\tvar autoCompleteStart = new AutoCompleteCustom(\"routestart\");\n\tvar autoCompleteEnd = new AutoCompleteCustom(\"routeend\");\n\n\tif (device == \"computer\") {\n\t\tvar draggable = true;\n\t\tvar zoomControl = true;\n\t} else {\n\t\tvar draggable = false;\n\t\tvar zoomControl = false;\n\t}\n\n\tgeocoder = new google.maps.Geocoder;\n\n\tdirectionsService = new google.maps.DirectionsService();\n\tdirectionsDisplay = new google.maps.DirectionsRenderer({\n\t\tdraggable: draggable,\n\t\tpreserveViewport: false,\n\t    panel: $(\".directions-display\")[0] \n\t});\n\n\televation = new google.maps.ElevationService();\n\n\tdirectionsDisplay.addListener('routeindex_changed', function(){\n\t\tvar timout;\n\t\treturn function(){\n\t\t\tclearTimeout(timout);\n\t\t\ttimout = setTimeout(processRoute,50);\n\t\t};\n\t}());\n\n\tif (urlParamsController.getParams()['z'] > 0 && urlParamsController.getParams()['z'] < 21) {\n\t\tvar zoom = parseFloat(urlParamsController.getParams()['z']);\n\t} \n\n\tif (urlParamsController.getParams()['lng']> -12 && urlParamsController.getParams()['lng']< 3 && urlParamsController.getParams()['lat']> 48 && urlParamsController.getParams()['lat']< 60) {\n\t\tif (urlParamsController.getParams()['src'] == \"evhw\"){\n\t\t\tvar center = {lat:parseFloat(urlParamsController.getParams()['lat'])+0.02, lng:parseFloat(urlParamsController.getParams()['lng'])};\n\t\t} else {\n\t\t\tvar center = {lat:parseFloat(urlParamsController.getParams()['lat']), lng:parseFloat(urlParamsController.getParams()['lng'])};\n\t\t}\n\t\t\n\t\tif (typeof zoom == \"undefined\"){\n\t\t\tvar zoom = 10;\n\t\t}\n\n\t} else {\n\t\tvar center = {lat:55.1384569, lng:-4.085792};\n\t\tif (typeof zoom == \"undefined\"){\n\t\t\tvar zoom = 6;\n\t\t}\n\t}\n\n\tvar mapoptions = {\n\t\tcenter: center,\n\t\tzoom: zoom,\n\t\tzoomControl: zoomControl,\n\t\tstreetViewControl: false,\n\t\tmapTypeId: google.maps.MapTypeId.ROADMAP,\n\t\tdisableDefaultUI: true\n\t}\n\n\tmap = new google.maps.Map(document.getElementById(\"mapbase\"), mapoptions);\n\n\tgoogle.maps.event.addListener(map, 'mousemove', function() {\n    \tif (device === \"portable\") {navMenu.hideDropdowns();}\n\t});\n\n\ticonListener = google.maps.event.addListener(map,\"tilesloaded\", function(){\t\n\t\t$(document).trigger(\"mapFirstInit\");\n\t\t\n\t\tgoogle.maps.event.removeListener(iconListener);\n\t});\n\n\tgoogle.maps.event.addListener(map,\"tilesloaded\", function(){\n\t\tvar timeout;\n\t\treturn function(){\n\t\t\tclearTimeout(timeout);\n\t\t\t//timeout = setTimeout(updateUrl,500);\n\t\t};\n\t}());\n\n\tgoogle.maps.event.addListener(map,\"dragend\", function(){\n\t\tupdateUrl();\n\t});\n\n\tvar mapClickFunction = function(){\n\t\tvar timeout;\n\n\t\treturn {\n\t\t\tshow: function(e){\n\t\t\t\ttimeout = setTimeout(function(){\n\n\t\t\t\t\tif (!$('div[class^=\"infowindow\"]').length){\n\t\t\t\t\t\tvar loc = {\n\t\t\t\t\t\t\tlat: e.latLng.lat(),\n\t\t\t\t\t\t\tlng: e.latLng.lng()\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tmapWaypointPopup.setWindowPos(loc);\n\t\t\t\t\t\t\tgeocodeReverseRequest(loc,function(result, status){\n\t\t\t\t\t\t\t\tmapWaypointPopup.updateResponse(processGeocodeResponse(result,status));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (openWindow != null){\n\t\t\t    \t\topenWindow.close();\n\t\t\t    \t}\n\n\t\t\t    \tif (openRssWindow != null){\n\t\t\t    \t\topenRssWindow.close();\n\t\t\t    \t}\n\n\t\t\t    \tmapWaypointPopup.close();\n\t\t\t    \tnavMenu.hideDropdowns();\n\t\t\t    \tmyLocationPopup.close();\n\t\t\t    \tshowHistoryInfoWindow.close();\n\n\t\t\t\t},300,e);\n\t\t\t},\n\t\t\tprevent: function(){\n\t\t\t\tclearTimeout(timeout)\n\t\t\t}\n\t\t}\n\n\t}();\n\n\tgoogle.maps.event.addListener(map,\"click\", function(event){\n\t\tmapClickFunction.show(event);\n\t});\n\n\tgoogle.maps.event.addListener(map,\"dblclick\", function(){\n\t\tmapClickFunction.prevent();\n\t});\n\n\tif (urlParamsController.getParams()[\"p\"]!== undefined){\n\t\tprovidersController.update(urlParamsController.getParams()[\"p\"].toLowerCase());\n\t} else {\n\t\t//\n\t}\n\n}\n\nvar mapWaypointPopup = function(){\n\tvar infoWindow;\n\tvar geoResponse;\n\tvar pos;\n\tvar offset;\n\tvar waypoint;\n\n\treturn {\n\t\topen: function(){\n\t\t\tif (infoWindow !== undefined){\n\t\t\t\tinfoWindow.close();\n\t\t\t\tinfoWindow.setMap(null);\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\tinfoWindow = new google.maps.InfoWindow({\n\t\t\t    content: '<div class = \"infowindow\">'+\n\t\t\t    \t\t\t'<h5 style=\"width:300px\">'+geoResponse.title+'</h5>'+\n\t\t\t    \t\t\t'<div class=\"w3-row w3-btn-bar\">'+\n\t\t\t    \t\t\t  '<span class=\"w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue\" onclick=\"mapWaypointPopup.setOrigin()\">Origin</span>'+\n\t\t\t    \t\t\t  '<span class=\"w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue\" onclick=\"mapWaypointPopup.setWaypoint()\">Waypoint</span>'+\n\t\t\t    \t\t\t  '<span class=\"w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue\" onclick=\"mapWaypointPopup.setDestination()\">Destination</span>'+\n\t\t\t    \t\t\t  '</div>'+\n\t\t\t    \t\t  '</div>',\n\t\t\t\tposition: pos,\n\t\t\t    zIndex: 5000,\n\t\t\t    maxWidth: 300,\n\t\t\t    pixelOffset: offset,\n\t\t\t    disableAutoPan: true\n\t\t\t});\n\n\t\t\tinfoWindow.open(map);\n\t\t\toffset = new google.maps.Size(0, 0);\n\t\t\t\t\t\t\n\t\t},\n\t\tsetOrigin: function(){\n\t\t\t//routeInputs.show();\n\n\t\t\tif (geoResponse.title !== \"Set this pin as:\"){\n\t\t\t\t$(\"#routestart\").val(geoResponse.title);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t$(\"#routestart\").val(geoResponse.location.lat + \", \" + geoResponse.location.lng);\n\t\t\t\topenWindow.close();\n\t\t\t}\n\t\t\t\n\t\t\tthis.close();\n\t\t\t$(\"#routestart\").blur();\n\n\t\t},\n\t\tsetWaypoint: function(){\n\t\t\twaypoint = {\n\t\t\t\tname: geoResponse.title,\n\t\t\t\tlat: geoResponse.location.lat,\n\t\t\t\tlng: geoResponse.location.lng\n\t\t\t};\n\n\t\t\t// if (geoResponse.title === \"Set this pin as:\"){\n\t\t\t// \twaypoint.name = activeMarker.info.name;\n\t\t\t// \topenWindow.close();\n\t\t\t// }\n\n\t\t\tprocessWaypoints(waypoint);\n\t\t\tthis.close();\n\t\t},\n\t\tsetDestination: function(){\n\t\t\t//routeInputs.show();\n\t\t\tif (geoResponse.title !== \"Set this pin as:\"){\n\t\t\t\t$(\"#routeend\").val(geoResponse.title);\n\t\t\t} else {\n\t\t\t\t$(\"#routeend\").val(geoResponse.location.lat + \", \" + geoResponse.location.lng);\n\t\t\t\topenWindow.close();\n\t\t\t}\n\t\t\tthis.close();\n\t\t\t$(\"#routestart\").blur();\n\t\t},\n\t\tupdateResponse: function(response){\n\t\t\tgeoResponse = response;\n\t\t\tthis.open();\n\t\t},\n\t\tsetWindowPos: function(position){\n\t\t\tpos = position;\n\t\t},\n\t\tclose: function(){\n\t\t\tif (infoWindow !== undefined){\n\t\t\t\tinfoWindow.close();\n\t\t\t\tinfoWindow.setMap(null);\n\t\t\t}\n\t\t},\n\t\tsetPseudoGeoResp: function(title,location){\n\t\t\tgeoResponse = {\n\t\t\t\ttitle: title,\n\t\t\t\tlocation: location\n\t\t\t};\n\n\t\t\toffset = new google.maps.Size(activeMarker.offset, -95);\n\n\t\t}\n\t};\n}();\n\nfunction geocodeReverseRequest(latLng,callback){\n\tgeocoder.geocode({location: latLng},callback);\n}\n\nfunction geocodeRequest(address,callback){\n\tgeocoder.geocode({address: address},callback);\n}\n\nfunction processGeocodeResultForWaypoint(results,status){\n\tif (status === google.maps.GeocoderStatus.OK) {\n\t\tif (results[0]){\n\t\t\tvar thisWaypoint = {};\n\t\t\tthisWaypoint.lat = parseFloat(results[0].geometry.location.lat());\n\t\t\tthisWaypoint.lng = parseFloat(results[0].geometry.location.lng());\n\t\t\tthisWaypoint.name = results[0].formatted_address;\n\t\t\tprocessWaypoints(thisWaypoint);\n\t\t} else {\n\t\t\tvar thisWaypoint = {};\n\t\t\tthisWaypoint.lat = parseFloat(e.latLng.lat().toFixed(6));\n\t\t\tthisWaypoint.lng = parseFloat(e.latLng.lng().toFixed(6));\n\t\t\tthisWaypoint.name = 'Location: ' + thisWaypoint.lat + ', ' + thisWaypoint.lng;\n\t\t\tprocessWaypoints(thisWaypoint);\n\t\t}\n\t}\n}\n\nfunction processGeocodeResultForStart(results,status){\n\t// if (status === google.maps.GeocoderStatus.OK) {\n\t// \tif (results[0]){\n\t// \t\tvar a = document.getElementById(\"routestart\");\n\t// \t\ta.value = results[0].formatted_address;\n\t// \t} else {\n\t// \t\tvar a = document.getElementById(\"routestart\");\n\t// \t\ta.value = e.latLng.lat() + ', ' + e.latLng.lng();\n\t// \t}\n\t// }\n\n\t$(\"#routestart\").val(processGeocodeResponse(results,status).title);\n}\nfunction processGeocodeResultForEnd(results,status){\n\t// if (status === google.maps.GeocoderStatus.OK) {\n\t// \tif (results[0]){\n\t// \t\tvar a = document.getElementById(\"routeend\");\n\t// \t\ta.value = results[0].formatted_address;\n\t// \t} else {\n\t// \t\tvar a = document.getElementById(\"routeend\");\n\t// \t\ta.value = e.latLng.lat() + ', ' + e.latLng.lng();\n\t// \t}\n\t// }\n\n\t$(\"#routeend\").val(processGeocodeResponse(results,status).title);\n}\n\nfunction processGeocodeResponse(results,status){\n\tif (status === google.maps.GeocoderStatus.OK) {\n\t\tif (results[0]){\n\t\t\treturn {\n\t\t\t\ttitle: results[0].formatted_address,\n\t\t\t\tlocation: {\n\t\t\t\t\tlat:results[0].geometry.location.lat(),\n\t\t\t\t\tlng:results[0].geometry.location.lng()\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ttitle: e.latLng.lat() + ', ' + e.latLng.lng(),\n\t\t\t\tlocation: e.latLng\n\t\t\t};\n\t\t}\n\t}\n}\nfunction oldDataGeneration(){\n\t\n\tvar vehicleData = {\n\t\ttemp: 20,\n\t\twhpm: [200,300,400,500,600,500,800,700,200,500,300]\n\t};\n\tlocalStorage.vehicleData = JSON.stringify(vehicleData);\n\tlocalStorage.unit = \"mpkwh\";\n}\nvar vehicleDataController = function() { //(was setvehicledata)\n\n\t//private variables\n\n\tvar vehicleData = {\n\t\ttemperature: 20,\n\t\tefficiencyFigures : [\n\t\t\t[131,144,159,169,192,217,233,256,278,303,333],\n\t\t\t[7.63,6.94,6.29,5.92,5.21,4.61,4.29,3.91,3.6,3.3,3.0]\n\t\t],\n\t\tunit: 0,\n\t\tspeeds: [25,30,35,40,45,50,55,60,65,70,75] \n\t};\n\n\n\n\t//private functions\n\tfunction updateView(){\n\t\t$(\".vehicle-data-row\").each(function(index,element){\n\t\t\tif (vehicleData.unit === 0){\n\t\t\t\t$(element).val(vehicleData.efficiencyFigures[vehicleData.unit][index].toFixed(0))\n\t\t\t\t\t\t  .prop(\"step\",1);\n\t\t\t} else {\n\t\t\t\t$(element).val(vehicleData.efficiencyFigures[vehicleData.unit][index].toFixed(2))\n\t\t\t\t\t\t  .prop(\"step\",0.01);\n\t\t\t}\n\t\t\t\t\n\t\t});\n\t\t$(\".temperature-value\").each(function(index,element){\n\t\t\t\t$(element).val(vehicleData.temperature);\n\t\t});\n\t\t$(\".vehicle-unit\").each(function(index,element){\n\t\t\t\tif (index === vehicleData.unit) {\n\t\t\t\t\tthis.checked = true;\n\t\t\t\t}\n\t\t});\n\t}\n\n\t//storage\n\n\tfunction storeData(){\n\t\tlocalStorage.vehicleData = JSON.stringify(vehicleData);\n\t}\n\n\tfunction retrieveData(){\n\t\tif (!localStorage.vehicleData){\n\t\t\treturn;\n\t\t}\n\t\tvehicleData = JSON.parse(localStorage.vehicleData);\n\t}\n\n\tfunction upgradeHandler(){\n\t\t//Check if we need to upgrade data\n\t\tif (typeof(vehicleData.unit) === \"undefined\") {\n\t\t\t//Was a unit defined before?\n\t\t\tif (localStorage.unit) {\n\t\t\t\t//if so, update from string to new integer\n\t\t\t\tif (localStorage.unit === \"mpkwh\") {\n\t\t\t\t\tvehicleData.unit = 1;\n\t\t\t\t} else {\n\t\t\t\t\tvehicleData.unit = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//Nothing was specified, default to 0 (mpkwh)\n\t\t\t\tvehicleData.unit = 0;\n\t\t\t}\n\t\t}\n\t\t//Update the efficiency data if new style isn't present\n\t\tif (!vehicleData.efficiencyFigures) {\n\t\t\tvehicleData.efficiencyFigures = defaultEfficiencyFigures();\n\n\t\t\t//Did we have some figures stored?\n\t\t\tif (vehicleData.whpm) {\n\t\t\t\tvehicleData.efficiencyFigures[vehicleData.unit] = vehicleData.whpm;\n\t\t\t\tsyncroniseFigures(vehicleData.unit);\n\t\t\t}\n\t\t}\n\t\t//update temp to new name if not set already, or default to default.\n\t\tif (!vehicleData.temperature && vehicleData.temp) {\n\t\t\tvehicleData.temperature = vehicleData.temp;\n\t\t}\t\n\t}\n\n\t//data\n\n\tfunction syncroniseFigures(unit){\n\t\tvar targetArrays = [];\n\t\tif (unit !== undefined) {\n\t\t\tvar referenceUnit = unit;\n\t\t} else {\n\t\t\tvar referenceUnit = vehicleData.unit;\t\n\t\t}\t\n\n\t\t//determine which to update\n\n\t\tfor (var i = 0; i < vehicleData.efficiencyFigures.length; i++) {\n\t\t\tif (referenceUnit !== i) {\n\t\t\t\ttargetArrays.push(i);\n\t\t\t}\n\t\t}\n\n\t\t//update each of them according to their relationship to the reference\n\n\t\ttargetArrays.forEach(function(value,index){\n\n\t\t\tif (referenceUnit === 0) { //reference unit is watt hour per mile\n\t\t\t\tif (value === 1) {\t   //we're updating the miles per kwh from watt hour per mile, so divide by 1\n\t\t\t\t\tfor (var i = 0; i < vehicleData.efficiencyFigures[referenceUnit].length; i++) {\n\t\t\t\t\t\tvehicleData.efficiencyFigures[value][i] = 1000 / vehicleData.efficiencyFigures[referenceUnit][i];\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t} else if (referenceUnit === 1) { //reference unit is miles per killowatt hour\n\t\t\t\tif (value === 0) {\t  \t\t  //we're updating the watt hour per mile from mile per kiliwatt, so divide by 1\n\t\t\t\t\tfor (var i = 0; i < vehicleData.efficiencyFigures[referenceUnit].length; i++) {\n\t\t\t\t\t\tvehicleData.efficiencyFigures[value][i] = 1000 / vehicleData.efficiencyFigures[referenceUnit][i];\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//units to add later\n\t\t\t}\n\n\t\t});\n\t}\n\n\tfunction defaultEfficiencyFigures(){\n\t\tvar defaultEfficiencyFigures = [\n\t\t\t\t[131,144,159,169,192,217,233,256,278,303,333],\n\t\t\t\t[7.63,6.94,6.29,5.92,5.21,4.61,4.29,3.91,3.6,3.3,3.0]\n\t\t\t];\n\t\treturn defaultEfficiencyFigures;\n\t}\n\n\tfunction defaultTemperature(){\n\t\tvar defaultTemp = 20;\n\t\treturn defaultTemp;\n\t}\n\n\t//public functions\n\n\treturn {\n\t\tinit: function(){\n\t\t\tretrieveData();\n\t\t\tupgradeHandler();\n\t\t\tstoreData();\n\t\t\tupdateView();\n\t\t},\n\t\tupdate: function(){\n\t\t\t$(\".vehicle-data-row\").each(function(index,element){\n\t\t\t\tvehicleData.efficiencyFigures[vehicleData.unit][index] = parseFloat($(element).val());\n\t\t\t});\n\t\t\t$(\".temperature-value\").each(function(index,element){\n\t\t\t\tvehicleData.temperature = parseFloat($(element).val());\n\t\t\t});\n\t\t\tsyncroniseFigures();\n\t\t\tstoreData();\n\t\t},\n\t\treset: function(){\n\t\t\tvehicleData.efficiencyFigures = defaultEfficiencyFigures();\n\t\t\tvehicleData.temperature = defaultTemperature();\n\t\t\tvehicleData.unit = 0;\n\t\t\tstoreData();\n\t\t\tupdateView();\n\t\t},\n\t\tsetUnit: function(unitInt){\n\t\t\tvehicleData.unit = unitInt;\n\t\t\tstoreData();\n\t\t\tupdateView();\n\t\t},\n\t\tget: function(){\n\t\t\treturn vehicleData;\n\t\t}\n\t};\n\t\n}();\n\nvar vehicleConsumpForSpeed = function(){\n\tvar customWhmi = 0;\t\n\n\treturn {\n\t\tget: function(n){\n\n\t\t\tif (customWhmi > 0){\n\t\t\t\treturn customWhmi;\n\t\t\t}\n\t\t\tvar vehicleData = vehicleDataController.get();\n\t\t\tvar speeds = vehicleData.speeds;\n\n\t\t\tvar whMi  = vehicleData.efficiencyFigures[0];\n\n\t\t\tfor (var i = 0; i < speeds.length - 1; i++) {\n\n\t\t\t\tif (n < speeds[0]){\n\t\t\t\t\treturn whMi[i];\n\t\t\t\t}\n\n\t\t\t\tif (n > speeds[speeds.length-1]){\n\t\t\t\t\treturn whMi[speeds.length-1];\n\t\t\t\t}\n\n\t\t\t\tif (n > speeds[i] && n < speeds[i+1]){\n\t\t\t\t\tif (speeds.indexOf(n) >= 0) {z=whMi[speeds.indexOf(n)];break;}\n\t\t\t\t\tvar ratio = (n - speeds[i]) / (speeds[i+1] - speeds[i]);\n\t\t\t\t\tvar y = (whMi[i+1] - whMi[i]) * ratio;\n\t\t\t\t\tvar z = whMi[i] + y;\n\t\t\t\t}\n\t\t\t\tif (z > 0) {break;}\n\t\t\t}\n\t\t\treturn z;\n\t\t},\n\t\tsetOverride:function(mikwh){\n\t\t\tif (mikwh > 0) {\n\t\t\t\tcustomWhmi = (1000/mikwh);\n\t\t\t} else {\n\t\t\t\tcustomWhmi = 0;\n\t\t\t}\n\t\t}\n\t}; \n\t\t\n}();\n\nfunction processElevationData(result,status){\n\tvar ascent = 0;\n\tvar descent = 0;\n\tvar elChange = 0;\n\tvar routeProgress = 0;\t\n\n\tif (status === google.maps.ElevationStatus.OK){\n\n\t\televResults = [];\n\n\t\tresult.forEach(function(val){\n\t\t\televResults.push(val);\n\t\t});\n\n\n\t\tif (!$(\".charts-menu\").length){\n\t\t\t$(\".route-options\").append($(\"<div>\",{class: \"charts-menu\"}).append($(\"<div>\",{class: \"charts-title route-titles\"}).text(\"Charts\").append($(\"<div>\",{class: \"expand-h\"})).append($(\"<div>\",{class: \"expand-v\"}))));\n\t\t\t$(\".charts-menu\").append($(\"<div>\",{id: \"waypoints-elevation\"}));\n\n\t\t\t$(\".charts-title\").click(function(){\n\t\t\t\t$(\"#waypoints-elevation\").slideToggle();\n\t\t\t\t$(\".route-options .expand-v\").eq($(\".route-titles\").index(this)).fadeToggle();\n\t\t\t});\n\t\t}\n\t\t\n\t\televData = new google.visualization.DataTable();\n\t\televData.addColumn('number', 'Miles');\n      \televData.addColumn('number', 'Altitude');\n      \televData.addColumn({type: 'string', role: 'tooltip'});\n\n\t\tfor (var i = 0; i < result.length - 1; i++) {\n\t\t\tvar elChange = result[i+1].elevation - result[i].elevation;\n\n\t\t\tif (elChange > 0){\n\t\t\t\tascent += elChange;\n\t\t\t} else {\n\t\t\t\tdescent += Math.abs(elChange);\n\t\t\t}\n\t\t\n\t\t\televData.addRows([\n        \t\t[routeProgress, result[i].elevation, Math.ceil(routeProgress) + \" miles in, \" + Math.ceil(result[i].elevation) + \" meters\"]\n      \t\t]);\n\n      \t\tvar distToLeg = calcCordDistance(result[i].location.lat(),result[i].location.lng(),result[i+1].location.lat(),result[i+1].location.lng())\n\n\t\t\trouteProgress +=  (distToLeg * 0.621371);\n\t\t}\n\t\t\n\t\tvar ascentCon = (ascent / 300) * 1.5;\n\t\tvar descentCon = (descent / 300) * 0.75;\n\n\t\troute.elevation = {\n\t\t\tstart: Math.round(result[0].elevation),\n\t\t\tend: Math.round(result[result.length-1].elevation),\n\t\t\tascent: Math.round(ascent),\n\t\t\tdescent: Math.round(descent)\n\t\t};\n\n\t\tvar totCon = route.consumption.total.baseline - descentCon + ascentCon;\n\n\t\tvar temp = vehicleDataController.get();\n\t\ttemp = temp.temperature;\n\n\t\tif (temp <=20){\n\t\t\tvar tempAdjustTotCon = totCon * (1 + (((20 - temp) / 2) * 0.01));\n\t\t} else {\n\t\t\tvar tempAdjustTotCon = totCon * (1 - (((20 - temp) / 4) * 0.01));\n\t\t}\n\n\t\troute.consumption.total.adjusted = tempAdjustTotCon;\n\n\t\tvar options = {\n  \t\t\tanimation: {\n  \t\t\t\tstartup: true,\n  \t\t\t\tduration: 1000,\n  \t\t\t\teasing: 'out'\n  \t\t\t},\n      \t\tcurveType: 'function',\n      \t\t//width: $(\".charts-menu\").width(),\n      \t\t//height: 200,\n      \t\tchartArea:{left:38,top:20,width:$(\".charts-menu\").width() - 38,height:160},\n      \t\tlegend: {position: 'none'},\n      \t\tvAxis: { format:'#m'}\n    \t};\n\t\n      \tif (chart === undefined ){\n      \t\tchart = new google.visualization.AreaChart(document.getElementById(\"waypoints-elevation\"));\n     \t\t\n        \tgoogle.visualization.events.addListener(chart,'onmouseover',chartMouseover);\n      \t\tgoogle.visualization.events.addListener(chart,'onmouseout',function(){\n      \t\t\taltInfoWindow.close();\n      \t\t\taltInfoWindow = undefined;\n      \t\t});\n      \t\tgoogle.visualization.events.addListener(chart,'select',chartClick);\n\n        \tchart.draw(elevData, options);\n      \t} else {\n      \t\tchart.draw(elevData, options);\n      \t}\n      \t\n        var innerText = \"Total ascent: \" + route.elevation.ascent + \"m,  \" + \"Total descent: \" + route.elevation.descent + \"m\" + \"<br>est. Power: \" + tempAdjustTotCon.toFixed(2) + \"kWh.\";\n\n        if (document.getElementById(\"elevation-summary\") == undefined){\n        \tvar eleOverview = document.createElement(\"p\");\n        \teleOverview.innerHTML = innerText;\n        \teleOverview.style.Text = \"text-align:center;font-size:12px;padding-bottom:0;\";\n        \teleOverview.id = \"elevation-summary\";\n        \tvar chartDiv = document.getElementById(\"waypoints-elevation\");\n        \t$(\"#waypoints-elevation\").append(eleOverview);\n        \t\n        } else {\n        \tdocument.getElementById(\"elevation-summary\").innerHTML = innerText;\n        }\t\n\t}\n}\n\nfunction chartClick(){\n \tvar e = chart.getSelection();\n\tif (e.length == 1 && e[0].row !== undefined && e[0].column !== undefined){\n\t\tvar pos = {\n\t\t\tlat: elevResults[e[0].row].location.lat(),\n\t\t\tlng: elevResults[e[0].row].location.lng()\n\t\t};\n\t\tmap.panTo(pos);\n\t}\t\n}\n\nfunction chartMouseover(e){\n\tvar pos = {};\n\tpos.lat = elevResults[e.row].location.lat();\n\tpos.lng = elevResults[e.row].location.lng();\n\n\tif (altInfoWindow == undefined){\n\n\t\tvar infoWindow = new google.maps.InfoWindow({\n\t\t    content: elevData.getValue(e.row,e.column).toFixed(1) + 'm',\n\t\t\tposition: pos,\n\t\t    zIndex: 5000\n\t\t});\n\n\t\taltInfoWindow = infoWindow;\n\n\t\tgoogle.maps.event.addListener(altInfoWindow,'closeclick',function(){\n\t\t\tsetTimeout(function(){altInfoWindow = undefined;},100);\n\t\t});\n\n\t\taltInfoWindow.open(map);\n\t\tinfoWindow = undefined;\n\t\t\n\t} else {\n\t\taltInfoWindow.setPosition(pos);\n\t\taltInfoWindow.setContent(elevData.getValue(e.row,e.column).toFixed(1) + 'm');\n\t}\n}\n\n//\n// Geolocation\n//\n\nvar getGoogleMapsUrl = function(){\n\n\tvar beforePostCode = 'https://maps.google.co.uk/maps?saddr=current+location&daddr=';\n\tvar afterPostCode = '&mode=driving';\n\n\treturn function(postCode){\n\t\t\n\t\treturn beforePostCode + postCode.replace(\" \",\"+\") + afterPostCode;\n\t};\n\n}();\n\nvar locationController = function() {\n\n\t//Our watch ID and options\n\tvar locationWatchId;\n\n\tvar locationOptions = {\n\t\tenableHighAccuracy: true,\n\t\ttimeout: 10000,\n\t\tmaximumAge: 0\n\t};\n\n\t//Our location visual elements\n\tvar locationCircle;\n\tvar locationIcon;\n\n\t//Watcher for snapping map to location\n\tvar zoomSnapCount;\n\n\t//Current state of location\n\tvar locationActive;\n\tvar lastTimeStamp;\n\n\tvar continuation = false;\n\n\tfunction drawLocationMarker(position,heading,accuracy) {\n\n\t\t//Our location triangle\n\n\t\tif (!locationIcon){\n\t\t\n\t\t\tlocationIcon = new google.maps.Marker({\n\t\t\t\tposition: position,\n\t\t\t\ticon: {\n\t\t\t\t\tpath: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,\n\t\t\t\t\tanchor: new google.maps.Point(0,2.5),\n\t\t\t\t\tscale: 5,\n\t\t\t\t\tstrokeWeight: 1,\n\t\t\t\t\tstrokeColor: '#0038ff',\n\t\t\t\t\tfillColor: '#0038ff',\n\t\t\t\t\tfillOpacity: 1,\n\t\t\t\t\trotation: heading\n\t\t\t\t},\n\t\t\t\tmap: map\n\t\t\t});\n\n\t\t\tgoogle.maps.event.addListener(locationIcon,'click',function(){\n\t\t\t\tvar loc = locationIcon.getPosition();\n\t\t\t\tmapWaypointPopup.setWindowPos(loc);\n\t\t\t\tgeocodeReverseRequest(loc,function(result, status){\n\t\t\t\t\tmapWaypointPopup.updateResponse(processGeocodeResponse(result,status));\n\t\t\t\t});\n\t\t\t});\n\t\t\t\t\n\t\t} else {\n\t\t\tlocationIcon.setIcon({\n\t\t\t\t\tpath: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,\n\t\t\t\t\tanchor: new google.maps.Point(0,2.5),\n\t\t\t\t\tscale: 5,\n\t\t\t\t\tstrokeWeight: 1,\n\t\t\t\t\tstrokeColor: '#0038ff',\n\t\t\t\t\tfillColor: '#0038ff',\n\t\t\t\t\tfillOpacity: 1,\n\t\t\t\t\trotation: heading\n\t\t\t});\n\n\t\t\tlocationIcon.setPosition(position);\n\t\t}\t\n\n\t\t//Our location circle\t\t\t\n\n\t\tif (!locationCircle){\n\n\t\t\tlocationCircle = new google.maps.Circle({\n\t\t\t\tstrokeColor: '#4d78ff',\n\t\t\t\tstrokeOpacity: 0.6,\n\t\t\t\tstrokeWeight: 3,\n\t\t\t\tfillColor: '#4d78ff',\n\t\t\t\tfillOpacity: 0.1,\n\t\t\t\tmap: map,\n\t\t\t\tcenter: position,\n\t\t\t\tradius: accuracy\n\t\t\t});\n\n\t\t} else {\n\t\t\tlocationCircle.setOptions({\n\t\t\t\tcenter: position,\n\t\t\t\tradius: accuracy\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction locationSuccess(position) {\n\n\t\t\n\n\t\tlocationActive = true;\n\n\t\t$(\"#showlocation\").html(\n\t\t\t$(\"#showlocation\").html().replace(\"Show\",\"Hide\")\n\t\t);\n\n\t\tif ((position.timestamp - lastTimeStamp) > 1500 || (typeof location.lastTimeStamp === \"undefined\")){\n\n\t\t\tlastTimeStamp = position.timestamp;\n\n\t\t\tvar pos = {\n\t\t\t\tlat: position.coords.latitude,\n\t\t\t\tlng: position.coords.longitude \n\t\t\t};\n\n\t\t\tif (location.zoomSnapCount < 2 && !continuation){\n\t\t\t\tmap.setZoom(11);\n\t\t\t\tmap.panTo(pos);\n\t\t\t}\n\n\t\t\tlocation.zoomSnapCount++;\n\n\t\t\tif (isNaN(position.coords.heading) || position.coords.heading === null ){\n\t\t\t\tvar heading = 0;\n\t\t\t} else {\n\t\t\t\tvar heading = position.coords.heading;\n\t\t\t}\n\n\t\t\tdrawLocationMarker(pos,heading,position.coords.accuracy);\t\n\t\t}\n\t}\n\n\tfunction locationError(error){\n\n\t\tvar alertText;\n\n\t\tswitch(error.code) {\n\t        case error.PERMISSION_DENIED:\n\t            alertText = \"It looks like you denied the request. You need to accept this to show your location.\";\n\t            continuation = false;\n\t            break;\n\t        case error.POSITION_UNAVAILABLE:\n\t        \tcontinuation = false;\n\t            alertText = \"Your location information is currently unavailable.\";\n\t            break;\n\t        case error.TIMEOUT:\n\t        \t//try reduced accuracy if we're not already\n\t        \tif (isCordovaApp) {\n\t        \t\tcontinuation = true;\n\t        \t\tlocationController.startWatch(true);\n\t        \t\treturn;\n\t        \t}\t        \t\n\t            alertText = \"The request to get your location timed out.\";\n\t            break;\n\t        case error.UNKNOWN_ERROR:\n\t            alertText = \"An unknown error occurred.\";\n\t            continuation = false;\n\t            break;\n\t\t}\n\n\t\tlocationActive = false;\n\t\tzoomSnapCount = 0;\n\n\t\tswal({\n\t\t\ttitle: \"Sorry..\",\n\t\t\ttext: alertText,\n\t\t\ttype: \"error\"\n\t\t});\n\n\t\tlocationController.clearWatch();\t    \n\t}\n\n\treturn {\n\t\tstartWatch: function(highaccuracy){\t\t\t\t\t\t\n\t\t\tif (navigator.geolocation) {\n\n\t\t\t\t$(\".location-arrow\").addClass(\"oscillate\");\n\n\t\t\t\tnavigator.geolocation.clearWatch(locationWatchId);\n\n\t\t\t\tlocation.zoomSnapCount = 0;\n\n\t\t\t\tif (highaccuracy) {\n\t\t\t\t\tlocationOptions.enableHighAccuracy = true;\n\t\t\t\t} else {\n\t\t\t\t\tlocationOptions.enableHighAccuracy = false;\n\t\t\t\t\tlocationOptions.timeout = 30000;\n\t\t\t\t}\n\n\t\t\t\tlocationWatchId = navigator.geolocation.watchPosition(\n\t\t\t\t\tlocationSuccess,\n\t\t\t\t\tlocationError,\n\t\t\t\t\tlocationOptions\n\t\t\t\t);\n\n\t\t    } else {\n\t\t    \tswal({\n\t\t    \t\ttitle: \"Sorry..\",\n\t\t    \t\ttext: \"Geolocation doesn't appear to be available on this browser\",\n\t\t    \t\ttype: \"error\"\n\t\t    \t});\n\t\t    }\n\t\t},\n\t\ttoggleWatch: function(highaccuracy) {\n\t\t\tif (locationActive) {\n\t\t\t\tlocationController.clearWatch();\t\n\t\t\t} else {\n\t\t\t\tlocationController.startWatch(highaccuracy);\n\t\t\t}\n\t\t},\n\t\trequestLocationNow: function() {\n\t\t\tvar result = 0;\n\t\t\tvar accuracy = 999999;\n\t\t\tvar storedPosition;\n\t\t\tvar location;\n\t\t\tvar clearWatchTimeout;\n\t\t\tvar callbackTimeout;\n\t\t\tvar lastPosition;\n\t\t\tvar correctProximityCount = 0;\n\t\t\treturn function(result,error) {\n\t\t\t\tlocation = navigator.geolocation.watchPosition(\n\t\t\t\t\tfunction(position){\n\t\t\t\t\t\tif (lastPosition) {\n\t\t\t\t\t\t\t//This is at least the second result received (lastPosition is object). \n\t\t\t\t\t\t\tvar difference = calcCordDistance(lastPosition.lat,lastPosition.lng,position.coords.latitude,position.coords.longitude);\n\n\t\t\t\t\t\t\t//If within 500 meters increment proximity count \n\t\t\t\t\t\t\tif (difference < 0.5) {\n\t\t\t\t\t\t\t\tcorrectProximityCount++;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcorrectProximityCount = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t//If we get 3 consecutive results within 500m of eachother, end early.\n\t\t\t\t\t\t\tif (correctProximityCount === 3) {\n\t\t\t\t\t\t\t\tresult(position);\n\t\t\t\t\t\t\t\tclearTimeout(callbackTimeout);\n\t\t\t\t\t\t\t\tclearTimeout(clearWatchTimeout);\n\t\t\t\t\t\t\t\tnavigator.geolocation.clearWatch(location);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//If the accuracy increases, store that position for returning\n\t\t\t\t\t\tif (accuracy > position.coords.accuracy) {\n\t\t\t\t\t\t\taccuracy = position.coords.accuracy;\n\t\t\t\t\t\t\tstoredPosition = position;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//store this position for comparing next time around\n\t\t\t\t\t\tlastPosition = {\n\t\t\t\t\t\t\tlat: position.coords.latitude,\n\t\t\t\t\t\t\tlng: position.coords.longitude\n\t\t\t\t\t\t};\n\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){\n\t\t\t\t\t\terror();\n\t\t\t\t\t},\n\t\t\t\t\tlocationOptions\n\t\t\t\t);\n\n\t\t\t\tcallbackTimeout = setTimeout(function(){\n\t\t\t\t\tresult(storedPosition);\n\t\t\t\t},5000);\t\n\n\t\t\t\tclearWatchTimeout = setTimeout(function(){\n\t\t\t\t\tnavigator.geolocation.clearWatch(location);\n\t\t\t\t},5050);\t\n\t\t\t};\n\n\t\t}(),\n\t\tclearWatch: function() {\n\t\t\t$(\".location-arrow\").removeClass(\"oscillate\");\n\t\t\tcontinuation = false;\n\t\t\tlocationActive = false;\n\t\t\tzoomSnapCount = 0;\n\t\t\tnavigator.geolocation.clearWatch(locationWatchId);\n\n\t\t\t$(\"#showlocation\").html($(\"#showlocation\").html().replace(\"Hide\",\"Show\"));\n\n\t\t\t//Clear the map overlays\n\t\t\tif (locationCircle){\n\t\t\t\tlocationCircle.setMap(null);\n\t\t\t\tlocationCircle = null;\n\t\t\t}\n\t\t\tif (locationIcon){\n\t\t\t\tlocationIcon.setMap(null);\n\t\t\t\tlocationIcon = null;\n\t\t\t}\n\n\t\t}\n\t};\n}();\n\n\n\nvar myLocationPopup = function(){\n\n\tvar infoWindow;\n\tvar pos;\n\n\treturn {\n\t\tgetPopup: function(){\n\t\t\tpos = locationIcon.getPosition();\n\n\t\t\tif (infoWindow !== undefined){\n\t\t\t\tinfoWindow.close();\n\t\t\t\tinfoWindow.setPosition(pos)\n\t\t\t} else {\n\t\t\t\tinfoWindow = new google.maps.InfoWindow({\n\t\t\t\t    content: '<div class = \"infowindow-small\"><span class=\"add-to-route\" onclick=\"myLocationPopup.addToOrigin()\">Set as Origin</span><span class=\"add-to-route\" onclick=\"myLocationPopup.addToDest()\">Set as Destination</span></div>',\n\t\t\t\t\tposition: pos,\n\t\t\t\t    zIndex: 5000,\n\t\t\t\t    disableAutoPan: true\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tinfoWindow.open(map);\n\t\t},\n\t\taddToOrigin: function(){\n\t\t\tgeocodeReverseRequest(pos,function(results,status){\n\t\t\t\tif (status === google.maps.GeocoderStatus.OK){\n\t\t\t\t\tdocument.getElementById(\"routestart\").value = results[0].formatted_address;\n\t\t\t\t} else {\n\t\t\t\t\tdocument.getElementById(\"routestart\").value = pos.lat() + ', ' + pos.lng();\n\t\t\t\t}\n\t\t\t\t//routeInputs.show();\n\t\t\t});\n\t\t\t\n\t\t},\n\t\taddToDest: function(){\n\t\t\tgeocodeReverseRequest(pos,function(results,status){\n\t\t\t\tif (status === google.maps.GeocoderStatus.OK){\n\t\t\t\t\tdocument.getElementById(\"routeend\").value = results[0].formatted_address;\n\t\t\t\t} else {\n\t\t\t\t\tdocument.getElementById(\"routeend\").value = pos.lat() + ', ' + pos.lng();\n\t\t\t\t}\n\t\t\t\t//routeInputs.show();\n\t\t\t});\n\t\t},\n\t\tclose: function(){\n\t\t\tif (infoWindow !== undefined){\n\t\t\t\tinfoWindow.close();\n\t\t\t} \n\t\t}\n\t};\n\t\n}();\n\nvar markerRouteDistanceWindow = function(){\n\n\tvar distanceIntoRoute = 0;\n\tvar infoWindow;\n\n\tvar methods = {\n\t\tsetDistanceIntoRoute: function(a){\n\t\t\tdistanceIntoRoute = a.toFixed(0);\n\t\t},\n\t\tshowDistancePopup: function(marker){\n\t\t\tif (infoWindow !== undefined){\n\t\t\t} else {\n\t\t\t\tinfoWindow = new google.maps.InfoWindow({\n\t\t\t\t    content: distanceIntoRoute + ' mi',\n\t\t\t\t    zIndex: 5000,\n\t\t\t\t    pixelOffset: new google.maps.Size(marker.offset, 0),\n\t\t\t\t    disableAutoPan: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tinfoWindow.open(map,marker);\n\t\t},\n\t\tcloseDistancePopup: function(){\n\t\t\tif (infoWindow !== undefined){\n\t\t\t\tinfoWindow.close();\n\t\t\t}\n\t\t}\n\t};\n\n\treturn methods;\n};\n\n\n//\n// Route functions\n//\n\nfunction addWaypoints(){\n\t//waypointsActive = !waypointsActive;\n\tif (toggleWaypoints.isActive()) {\n\t\tdocument.getElementById(\"route-overview\").style.display = \"block\";\n\t} else {\n\t\tdocument.getElementById(\"route-overview\").style.display = \"none\";\n\t}\n} \n\nfunction processWaypoints(theWaypoint,auto){\n\tvar newEntry = true;\n\tfor (var i = 0; i < route.waypoints.length; i++) {\n\t\tif (route.waypoints[i].lat == theWaypoint.lat && route.waypoints[i].lng == theWaypoint.lng) {\n\t\t\troute.waypoints.splice(i,1);\n\t\t\tnewEntry = false;\n\t\t} \n\t}\n\n\tif (newEntry) {\n\t\tif (route.waypoints.length > 7){\n\t\t\tswal({\n\t    \t\ttitle: \"Whoops..\",\n\t    \t\ttext: \"Sorry, we can't take more than 8 waypoints..\",\n\t    \t\ttype: \"info\"\n\t    \t});\n\t\t} else {\n\t\t\troute.waypoints.push(theWaypoint);\n\t\t\taddWaypointField(theWaypoint);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\tif (auto === undefined){\n\t\t$(\"#routestart\").blur();\n\t}\n\t\n\t\n}\n\nfunction addWaypointField(theWaypoint){\n\n\tvar waypointFieldText = \"\";\n\tif (theWaypoint) {\n\t\tif (theWaypoint.name === \"Set this pin as:\") {\n\t\t\twaypointFieldText = theWaypoint.lat + \", \" + theWaypoint.lng;\n\t\t} else {\n\t\t\twaypointFieldText = theWaypoint.name;\n\t\t}\n\t}\n\t$inputContainer = $(\"<div>\", {class: \"route-input-cont route-waypoint-cont\"});\t\t\n\t$inputField = $(\"<input>\",{type: \"input\", class: \"routeinput route-waypoint-input\"}).val(waypointFieldText).attr(\"autocorrect\",\"off\").prop(\"autocomplete\",\"off\");\n\telementEventBinder.routeInputs($inputField);\n\t\n\tautoCompleteManager.add($inputField);\n\n\t$removeCont = $(\"<div>\",{class: \"waypoint-remove-container\"});\n\n\t$remove = $(\"<i>\",{class: \"material-icons waypoint-remove\"}).append(\"clear\").click(function(e){\n\t\t$(\".route-waypoint-cont\").eq($(\".waypoint-remove\").index(this)).slideUp(400,function(){\n\t\t\tremoveWaypoint($(\".waypoint-remove\").index(this));\n\t\t\tthis.remove();\n\t\t\t$(\"#routestart\").blur();\n\t\t});\n\t});\n\n\t$removeCont.append($remove);\n\n\t$fade = $(\"<span>\",{class:\"route-input-fade\"});\n\n\t$inputClear = $(\"<i>\",{class: \"material-icons route-input-clear\"}).append(\"clear\");\n\telementEventBinder.routeInputClear($inputClear);\n\n\t$marker = $(\"<i>\",{class: \"material-icons route-input-marker\"}).append(\"place\");\n\t$breadcrumbs = $(\"<i>\",{class: \"material-icons route-input-breadcrumbs\"}).append(\"more_vert\");\n\n\t$(\".route-input-cont\").last()\n\t\t\t\t\t\t  .before($inputContainer.append($marker)\n\t\t\t\t\t\t  \t\t\t\t\t\t .append($inputField)\n\t\t\t\t\t\t  \t\t\t\t\t\t .append($fade)\n\t\t\t\t\t\t  \t\t\t\t\t\t .append($inputClear)\n\t\t\t\t\t\t  \t\t\t\t\t\t .append($removeCont)\n\t\t\t\t\t\t  \t\t\t\t\t\t .append($breadcrumbs));\n\n\t$inputContainer.slideDown(400, function(){\n\t\tif (theWaypoint) {\n\t\t\t$(\"#routestart\").blur();\t\n\t\t}\n\t\t\n\t});\t\t\t\t\t  \n\n}\n\nvar autoCompleteManager = function(){\n\tvar autoCompleteArray = [];\n\treturn {\n\t\tadd: function(inputField){\n\t\t\tvar autoComplete = new AutoCompleteCustom(inputField[0]);\n\t\t\tautoCompleteArray.push(autoComplete);\n\t\t},\n\t\tremove: function(n){\n\t\t\tautoCompleteArray.splice(n,1);\n\t\t}\n\t};\n}();\n\n\n\n\nfunction removeWaypoint(waypointNumber){\n\troute.waypoints.splice(waypointNumber,1);\n\tautoCompleteManager.remove(waypointNumber);\n\t\n}\n\nfunction clearTable(table){\n\twhile (table.hasChildNodes()) {\n    \ttable.removeChild(table.firstChild);\n\t}\n}\n\nvar spinnerLoader = function(){\n\tvar spinnerActive;\n\tvar timeout;\n\treturn {\n\t\tshow: function(element){\n\t\t\tvar spinHtml = '<div class=\"sk-circle1 sk-child\"></div><div class=\"sk-circle2 sk-child\"></div><div class=\"sk-circle3 sk-child\"></div><div class=\"sk-circle4 sk-child\"></div><div class=\"sk-circle5 sk-child\"></div><div class=\"sk-circle6 sk-child\"></div><div class=\"sk-circle7 sk-child\"></div><div class=\"sk-circle8 sk-child\"></div><div class=\"sk-circle9 sk-child\"></div><div class=\"sk-circle10 sk-child\"></div><div class=\"sk-circle11 sk-child\"></div><div class=\"sk-circle12 sk-child\"></div>';\n\n\t\t\t$spinner = $(\"<div>\",{class:\"sk-circle\"}).html(spinHtml);\n\t\t\t\n\t\t\t$container = $(\"<div>\",{class: \"spinner-container\"});\n\n\t\t\t$(element).after($container)\n\t\t\t\t\t  .after($spinner);\n\n\t\t\tspinnerActive = true;\n\n\t\t\ttimeout = setTimeout(spinnerLoader.hide,10000);\n\t\t},\n\t\thide: function(){\n\t\t\tclearTimeout(timeout);\n\t\t\t$(\".sk-circle\").remove();\n\t\t\t$(\".spinner-container\").remove();\n\t\t\tspinnerActive = false;\n\t\t},\n\t\tactive: function(){\n\t\t\treturn spinnerActive;\n\t\t}\n\t};\n}();\n\nvar mapMask = function(){\n\n\tvar errorTimeout;\n\tvar active;\n\n\tfunction hideAfterTransitionEnd(e){\n\t\tconsole.log(e.originalEvent.propertyName + \": transition has ended\");\n\t\tif (e.originalEvent.propertyName.indexOf(\"filter\") > -1 || true) {\n\t\t\t$(\"#map-mask\").off(\"transitionend\",hideAfterTransitionEnd);\n\t\t\t$(\"#map-mask\").hide();\n\t\t}\n\t}\n\n\treturn {\n\t\tshow: function(options) {\n\t\t\tif (active) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tactive = true;\n\t\t\t$(\"#map-mask button\").remove();\n\t\t\t$(\"#mapbase\").addClass(\"map-loading\");\n\t\t\t$(\"#map-mask\").addClass(\"opacity-1\");\n\t\t\n\t\t\tif (options.showAnimation) {\n\t\t\t\t$(\"#map-mask .spinner\").show();\n\t\t\t} else {\n\t\t\t\t$(\"#map-mask .spinner\").hide();\n\t\t\t}\n\t\t\tif (!options.text) {\n\t\t\t\toptions.text = \"\";\n\t\t\t}\n\t\t\t$(\"#map-loading\").html(options.text);\n\t\t\t$(\"#map-mask\").show();\n\t\t\t\n\t\t\terrorTimeout = setTimeout(function(){\n\t\t\t\t$(\"#map-loading\").html(\"Operation timed out..\");\n\t\t\t\t$(\"#map-mask .spinner\").hide();\n\t\t\t\t$(\"#map-loading\").after($(\"<button>\",{class: \"w3-btn w3-margin-top w3-show w3-content w3-center w3-center w3-hover-none w3-green w3-hover-blue\"}).append(\"Retry\").click(function(){\n\t\t\t\t\t\n\t\t\t\t\tInitialiseMap();\t\n\t\t\t\t\t\n\t\t\t\t\tactive = false;\n\t\t\t\t\tmapMask.show({\n\t\t\t\t\t\ttext: options.text,\n\t\t\t\t\t\ttype: options.type,\n\t\t\t\t\t\tshowAnimation: options.showAnimation\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t},10000); \n\n\t\t},\n\t\thide: function() {\n\t\t\t// if (!userController.isLoggedIn()){\n\t\t\t// \treturn;\n\t\t\t// }\n\t\t\tactive = false;\n\t\t\tclearTimeout(errorTimeout);\n\t\t\t\n\t\t\t$(\"#mapbase\").removeClass(\"map-loading\");\t\t\t\t\t\t \n\t\t\t$(\"#map-mask\").removeClass(\"opacity-1\").on(\"transitionend\",hideAfterTransitionEnd);\t\n\t\t}\n\t\t\n\t};\t\n\n}();\n\n//mapMask.show(\"Map requires internet connection.\");\n\nfunction calcRoute(n) {\n\n\tif (!spinnerLoader.active()){\n\t\t\tspinnerLoader.show($(\".wrap\"));\n\t}\n\n\t//check if we're including reverse of route\n\n\tif ($(\"#return-onoffswitch\").prop(\"checked\") && n === undefined){\n\t\treturnJourney.getReturnRoute();\n\t} \n\n  \tvar start = document.getElementById(\"routestart\").value;\n  \tvar end = document.getElementById(\"routeend\").value;\n  \troute.start = start;\n  \troute.end = end;\n\n  \tvar gWaypoints = [];\n\n  \tvar exp = /[0-9][.][0-9]{5,}/g;\n\n  \t$(\".route-waypoint-input\").each(function(index,element){\n  \t\tvar validLatLng = $(element).val().match(/[-]?[0-9]{1,}[.][0-9]{5,}/g);\n  \t\tif (validLatLng !== null && validLatLng.length == 2){\n  \t\t\tgWaypoints.push({\n  \t\t\t\tlocation:{\n  \t\t\t\t\tlat: Number(validLatLng[0]),\n  \t\t\t\t\tlng: Number(validLatLng[1])\n  \t\t\t},\n  \t\t\tstopover: true\n  \t\t\t});\n  \t\t} else {\n  \t\t\tgWaypoints.push({\n  \t\t\t\tlocation: $(element).val(),\n  \t\t\tstopover: true\n  \t\t\t});\n  \t\t}\n  \t});\n\n  \t// for (var i = 0; i < route.waypoints.length; i++) {\n  \t// \tgWaypoints.push(\n  \t// \t\t{\n  \t// \t\tlocation:{\n  \t// \t\t\tlat: route.waypoints[i].lat,\n  \t// \t\t\tlng: route.waypoints[i].lng\n  \t// \t\t},\n  \t// \t\tstopover: true\n  \t// \t\t}\n  \t// \t);\n  \t// };\n\n  \tvar request = {\n    \t\t\t\torigin:start,\n    \t\t\t\tdestination:end,\n    \t\t\t\twaypoints: gWaypoints,\n    \t\t\t\ttravelMode: google.maps.TravelMode.DRIVING,\n    \t\t\t\tprovideRouteAlternatives: true,\n    \t\t\t\tunitSystem: google.maps.UnitSystem.IMPERIAL\n  \t};\n\n  \tdirectionsService.route(request, function(result, status) {\n\n    \tif (status === google.maps.DirectionsStatus.OK) {\n\t\t\taltRoutes = result.routes.length - 1;\n\t\t\tcurRoute = 0;\n\t\t\tdirectionsDisplay.setOptions({\n\t\t\t\tpreserveViewport: false\n\t\t\t});\n\t\t\tdirectionsDisplay.setDirections(result);\n\t\t\tdirectionsDisplay.setMap(map);\n\t\t\n\t\t\t\n    \t} else if (status === google.maps.DirectionsStatus.NOT_FOUND){\n    \t\tswal({\n\t    \t\ttitle: \"Sorry..\",\n\t    \t\ttext: \"Couldn't find one or more locations. Please check and retry.\",\n\t    \t\ttype: \"error\"\n\t    \t});\n\t    \tspinnerLoader.hide();\n    \t} else if (status === google.maps.DirectionsStatus.ZERO_RESULTS){\n    \t\tswal({\n\t    \t\ttitle: \"Sorry..\",\n\t    \t\ttext: \"No route found. Please check and try again.\",\n\t    \t\ttype: \"error\"\n\t    \t});\n\t    \tspinnerLoader.hide();\n    \t} else {\n    \t\tswal({\n\t    \t\ttitle: \"Sorry..\",\n\t    \t\ttext: \"Something went wrong. Please check and try again.\",\n\t    \t\ttype: \"error\"\n\t    \t});\n\t    \tspinnerLoader.hide();\n    \t}\n  \t});\n}\n\nfunction toggleAlternateRoutes(direction){\n\tdirectionsDisplay.setOptions({preserveViewport: true});\n\tif (direction == 0){\n\t\tif (curRoute > 0 ){\n\t\t\tcurRoute--;\n\t\t} else {\n\t\t\tcurRoute = altRoutes;\n\t\t}\n\t} else {\n\t\tif (curRoute < altRoutes ){\n\t\t\tcurRoute++;\n\t\t} else {\n\t\t\tcurRoute = 0;\n\t\t}\n\t}\n\t\n\tdirectionsDisplay.setRouteIndex(curRoute);\n\tprocessRoute();\n}\n\nvar processRoute = function(){\n\n\treturn function(){\t\t\n\n\t\tif ($(\"#routestart\").val() === \"\" || $(\"#routeend\").val() === \"\"){\n\t\t\treturn;\n\t\t}\n\n\t\tif (!spinnerLoader.active()){\n\t\t\tspinnerLoader.show($(\".wrap\"));\n\t\t}\n\n\t\tvar selector = document.getElementById(\"charger-radius\");\n\n\t\t//updateWaypointTable();\n\n\t\t// if (directionsDisplay.getDirections().routes.length != (altRoutes + 1)){\n\t\t// \taltRoutes = directionsDisplay.getDirections().routes.length - 1;\n\t\t// \tcurRoute = altRoutes;\n\t\t// }\n\n\t\tcurRoute = directionsDisplay.getRouteIndex();\n\n\n\t\tvar onroute;\n\t\tvar route_path = directionsDisplay.getDirections().routes[curRoute].overview_path;\n\t\troute.path = route_path;\n\t\tvar legs = directionsDisplay.getDirections().routes[curRoute].legs;\n\t\tvar distance = 0;\n\t\tvar time = 0;\n\n\t\t//get elevation data for this route\n\n\t\t//sample rate\n\n\t\tif (route_path.length < 100){\n\t\t\tvar elReqSampRate = route_path.length;\n\t\t} else {\n\t\t\tvar elReqSampRate = 100;\n\t\t}\n\t\t\n\t\t//build request \n\n\t\tvar elReq = {\n\t\t\tpath: route_path,\n\t\t\tsamples: elReqSampRate\n\t\t};\n\n\t\t//make the request and pass callback\n\t\t\n\t\t//elevation.getElevationAlongPath(elReq,processElevationData);\n\n\t\t//store the chosen radius if we can, else default to 2.\n\n\t\tif (storagePossible && localStorage.radius !== undefined){\n\t\t\tvar radius = localStorage.radius;\n\t\t} else{\n\t\t\tvar radius = 2;\n\t\t}\n\n\t\tif ($('#charger-radius').length){\n\t\t\tradius = $('#charger-radius').val();\n\t\t\tif (storagePossible){\n\t\t\t\tlocalStorage.radius = radius;\n\t\t\t}\n\t\t}\n\n\t\t//update route waypoint table \n\n\t\t//generate row for each leg\n\t\t// for (var i = 0; i < legs.length; i++) {\n\n\t\t// \t//is this leg not the last of a multi-leg trip?\n\t\t// \tif (i < legs.length - 1){\n\t\t// \t\tvar resultRow = document.createElement(\"tr\");\n\t\t// \t\tresultRow.className = \"waypoint-row-result\";\n\t\t// \t\tvar resultData = document.createElement(\"td\");\n\t\t// \t\tresultData.innerHTML = getMilesFromKm(legs[i].distance.value) + \" miles, \" + getTimeFromSec(legs[i].duration.value);\n\t\t// \t\tresultData.setAttribute(\"colspan\",\"3\");\n\t\t// \t\tresultData.style.cssText = \"text-align:center;\"\n\t\t// \t\tresultRow.appendChild(resultData);\n\t\t// \t\t//var elementToGet = \"waypoint-row-\"+(i+1);\n\t\t// \t\t//var currentWaypointRow = document.getElementById(elementToGet);\n\t\t// \t\t$(\"#waypoint-row-\"+(i+1)).after(resultRow);\n\t\t// \t\t//insertAfter(resultRow,currentWaypointRow);\n\t\t\t\t\n\t\t// \t} else { \n\t\t// \t\t//this leg is the last\n\n\t\t// \t\t//Are there more than one leg? Add waypoint result as we added it above for single leg.\n\t\t// \t\tif (legs.length > 1) {\n\t\t// \t\t\tvar resultRow = document.createElement(\"tr\");\n\t\t// \t\t\tresultRow.className = \"waypoint-row-result\";\n\t\t// \t\t\tvar resultData = document.createElement(\"td\");\n\t\t// \t\t\tresultData.innerHTML = getMilesFromKm(legs[i].distance.value) + \" miles, \" + getTimeFromSec(legs[i].duration.value);\n\t\t// \t\t\tresultData.setAttribute(\"colspan\",\"3\");\n\t\t// \t\t\tresultData.style.cssText = \"text-align:center;\"\n\t\t// \t\t\tresultRow.appendChild(resultData);\n\t\t// \t\t\tvar currentWaypointRow = document.getElementById(\"waypoint-row-end\");\n\t\t// \t\t\t//insertAfter(resultRow,currentWaypointRow);\n\t\t// \t\t\t$(\"#waypoint-row-\"+(i+1)).after(resultRow);\n\t\t// \t\t}\n \n\t\t// \t\t//continue with last leg\n\t\t// \t\tvar resultRow = document.createElement(\"tr\");\n\t\t// \t\tresultRow.className = \"waypoint-row-result-overview\";\n\t\t// \t\tvar resultData = document.createElement(\"td\");\n\n\t\t// \t\tfor (var x = 0; x < legs.length; x++) {\n\t\t// \t\t\tdistance += legs[x].distance.value;\n\t\t// \t\t\ttime += legs[x].duration.value;\n\t\t// \t\t}\n\n\t\t// \t\tresultData.innerHTML = 'My route: ' + getMilesFromKm(distance) + \" miles, \" + getTimeFromSec(time) + \" (excl. charging)\";\n\t\t// \t\tresultData.setAttribute(\"colspan\",\"3\");\n\t\t// \t\tresultData.style.cssText = \"text-align:center;padding-top:5px;\"\n\t\t// \t\tresultRow.appendChild(resultData);\n\n\t\t// \t\tdocument.getElementById(\"waypoint-table\").appendChild(resultRow);\n\t\t\t\n\t\t// \t\tvar resultRow = document.createElement(\"tr\");\n\t\t// \t\tresultRow.className = \"waypoint-row-result-alternates\";\n\n\t\t// \t\tvar resultData = document.createElement(\"td\");\n\n\t\t// \t\tvar img = document.createElement(\"img\");\n\t\t// \t\timg.className = \"img-nav-alternate\";\n\t\t// \t\timg.src = \"img/nav_left.png\";\n\t\t// \t\timg.height = \"15\";\n\t\t// \t\timg.width = \"15\";\n\t\t// \t\timg.setAttribute(\"onClick\",\"toggleAlternateRoutes(0)\");\n\t\t// \t\tresultData.appendChild(img);\n\n\t\t// \t\tvar link = document.createElement(\"span\");\n\t\t// \t\tlink.innerHTML = 'Route ' + (curRoute + 1) + \" of \" + (altRoutes + 1);\n\t\t// \t\tresultData.appendChild(link);\n\n\t\t// \t\timg = document.createElement(\"img\");\n\t\t// \t\timg.className = \"img-nav-alternate\";\n\t\t// \t\timg.src = \"img/nav_right.png\";\n\t\t// \t\timg.height = \"15\";\n\t\t// \t\timg.width = \"15\";\n\t\t// \t\timg.setAttribute(\"onClick\",\"toggleAlternateRoutes(1)\");\n\t\t// \t\tresultData.appendChild(img);\n\n\t\t// \t\tresultData.setAttribute(\"colspan\",\"3\");\n\t\t// \t\tresultData.style.cssText = \"text-align:center;padding-top:5px;\";\n\n\t\t// \t\tresultRow.appendChild(resultData);\n\t\t// \t\tdocument.getElementById(\"waypoint-table\").appendChild(resultRow);\n\n\t\t\t\t//dropdown for radius from route for markers\n\n\t\t\t\t//route options\n\n\t\tif (!$('.route-options-cont').length) {\n\n\t\t\t//options container\n\n\t\t\t$('#route-cont').append($(\"<div>\",{class: 'route-options'}).append($(\"<div>\",{class: \"route-options-title route-titles\"}).text(\"Options\").append($(\"<div>\",{class: \"expand-h\"})).append($(\"<div>\",{class: \"expand-v\"}))));\n\t\t\t$('.route-options').append($(\"<div>\",{class: \"route-options-cont\"}));\n\n\t\t\t//option 0\n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-0\"}));\n\n\t\t\t$(\"#option-0\").append($('<div>',{class: \"route-option-description\"}).text(\"Suggest charge stops\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-0-input\"}));\n\t\t\n\t\t\t$(\"#option-0-input\").append('<div class=\"onoffswitch\"><input type=\"checkbox\" name=\"onoffswitch\" class=\"onoffswitch-checkbox\" id=\"charge-suggest-checkbox\" checked><label class=\"onoffswitch-label\" for=\"charge-suggest-checkbox\"><span class=\"onoffswitch-inner\"></span><span class=\"onoffswitch-switch\"></span></label></div>');\n\n\t\t\t//set switch value based on storage\n\t\t\tif (localStorage.chargeSuggest !== undefined){\n\t\t\t\t\t$(\"#charge-suggest-checkbox\").prop(\"checked\",localStorage.chargeSuggest === \"true\");\n\t\t\t} \n\n\t\t\t//option 1\n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class: \"route-option\", id:\"option-1\"}).append($('<div>',{class: \"route-option-description\"}).text(\"Show chargers within\")));\n\n\t\t\t$sel = $(\"<select>\",{id: \"charger-radius\",}).change(function(){\n\t\t\t\tupdateMarkersOnMapFromRoute.update();\n\t\t\t});\n\n\t\t\tvar listItems = [0.5,1,2,5,10,20,50];\n\t\t\t\n\t\t\tfor (var l = 0; l < listItems.length; l++) {\n\t\t\t\t$opt = $(\"<option>\");\n\n\t\t\t\tif (radius == listItems[l]){\n\t\t\t\t\t$opt.prop(\"selected\",true);\n\t\t\t\t}\n\n\t\t\t\tvar unit = ' mile';\n\n\t\t\t\tif (listItems[l] > 1){\n\t\t\t\t\tunit = ' miles';\n\t\t\t\t}\n\n\t\t\t\t$opt.text(listItems[l] + unit);\n\t\t\t\t$opt.val(listItems[l]);\n\t\t\t\t$sel.append($opt);\n\t\t\t}\n\n\t\t\t$(\"#option-1\").append($(\"<div>\",{class: \"route-option-input\", id: \"option-1-input\"}).append($sel).css({\"text-align\": \"center\"}));\n\n\n\t\t\t//option 2 and 3, battery and lower capacity\n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-2\"}));\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-21\"}));\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-3\"}));\n\n\t\t\t$(\"#option-2\").append($('<div>',{class: \"route-option-description\"}).text(\"Battery capacity\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-2-input\"}));\n\n\t\t\t$(\"#option-21\").append($('<div>',{class: \"route-option-description\"}).text(\"Battery start level\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-21-input\"}));\n\n\t\t\t$(\"#option-3\").append($('<div>',{class: \"route-option-description\"}).text(\"Battery min. level\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-3-input\"}));\n\n\t\t\t$(\"#option-2-input\").append($(\"<div>\",{class: \"input-cont\"}).append($(\"<input>\",{class: \"route-kwh\", id: \"route-kwh-capacity\", type: \"text\"})).append($(\"<span>\").text(\"kWh\")));\n\t\t\t$(\"#option-21-input\").append($(\"<div>\",{class: \"input-cont\"}).append($(\"<input>\",{class: \"route-kwh\", id: \"route-kwh-start-capacity\", type: \"text\"})).append($(\"<span>\").text(\"%\")));\n\t\t\t$(\"#option-3-input\").append($(\"<div>\",{class: \"input-cont\"}).append($(\"<input>\",{class: \"route-kwh\", id: \"route-kwh-low-limit\", type: \"text\"})).append($(\"<span>\").text(\"%\")));\n\n\n\t\t\t//option 4 \n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-4\"}));\n\n\t\t\t$(\"#option-4\").append($('<div>',{class: \"route-option-description\"}).text(\"Custom mi/kWh?\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-4-input\"}));\n\t\t\n\t\t\t$(\"#option-4-input\").append('<div class=\"onoffswitch\"><input type=\"checkbox\" name=\"onoffswitch\" class=\"onoffswitch-checkbox\" id=\"mikwh-onoffswitch\"><label class=\"onoffswitch-label\" for=\"mikwh-onoffswitch\"><span class=\"onoffswitch-inner\"></span><span class=\"onoffswitch-switch\"></span></label></div>');\n\n\n\t\t\t//custom mi/kwh option\n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-5\"}));\n\n\t\t\t$(\"#option-5\").append($('<div>',{class: \"route-option-description\"}).text(\"Average efficiency\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-5-input\"}));\n\t\t\t\t\t\n\t\t\t$(\"#option-5-input\").append($(\"<div>\",{class: \"input-cont\"}).append($(\"<input>\",{class: \"route-kwh\", id: \"average-mi-kwh\", type: \"text\"})).append($(\"<span>\").text(\"mi/kWh\")));\n\n\t\t\t//set switch value and visibility of entry field based on storage\n\n\t\t\t//check if user has used switch before\n\t\t\tif (localStorage.customMiKwhOption !== undefined){\n\n\t\t\t\t//they have used the switch so set it as it was\n\t\t\t\t$(\"#mikwh-onoffswitch\").prop(\"checked\",localStorage.customMiKwhOption === \"true\");\n\n\t\t\t\t//Was the switch on before?\n\t\t\t\tif (localStorage.customMiKwhOption === \"true\"){\n\n\t\t\t\t\t//Yes the switch was on.\n\n\t\t\t\t\t//Did they enter a value?\n\t\t\t\t\tif (localStorage.customMiKwh > 0){\n\t\t\t\t\t\t//The switch was on, and they had a value, so update to reflect this\n\t\t\t\t\t\tvehicleConsumpForSpeed.setOverride(Number(localStorage.customMiKwh));\n\t\t\t\t\t\t$(\"#average-mi-kwh\").val(localStorage.customMiKwh);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//The switch was on, but no value was found. Set to default.\n\t\t\t\t\t\tvehicleConsumpForSpeed.setOverride(4.2);\n\t\t\t\t\t\t$(\"#average-mi-kwh\").val(4.2);\t\n\t\t\t\t\t}\n\n\t\t\t\t\t//The switch was on so show the input field\n\t\t\t\t\t\n\t\t\t\t\t$(\"#option-5\").show();\n\t\t\t\t} else {\n\n\t\t\t\t\t//Nope, the switch wasn't on\n\n\t\t\t\t\t//Set the override to use speed relative data (set to 0)\n\t\t\t\t\tvehicleConsumpForSpeed.setOverride(0);\n\n\t\t\t\t\t//Now, the switch wasn't on, but did they enter a value previously?\n\t\t\t\t\tif (localStorage.customMiKwh > 0){\n\t\t\t\t\t\t//Yes, so update the value field with what was entered previously.\n\t\t\t\t\t\t$(\"#average-mi-kwh\").val(localStorage.customMiKwh);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//The switch wasn't on, and there wasn't a value entered, so use defaults.\n\t\t\t\t\t\tvehicleConsumpForSpeed.setOverride(4.2);\n\t\t\t\t\t\t$(\"#average-mi-kwh\").val(4.2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t//They haven't used the switch before\n\t\t\t\t//The switch is unchecked by default, so nothing to do here but set default value in input field\n\t\t\t\t$(\"#average-mi-kwh\").val(4.2);\n\n\t\t\t\t//Set override to 0 just in case.\n\t\t\t\tvehicleConsumpForSpeed.setOverride(0);\n\t\t\t}\n\n\t\t\t//option 6 \n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-6\"}));\n\n\t\t\t$(\"#option-6\").append($('<div>',{class: \"route-option-description\"}).text(\"Include return journey\"))\n\t\t\t\t\t\t  .append($(\"<div>\",{class: \"route-option-input\", id: \"option-6-input\"}));\n\t\t\n\t\t\t$(\"#option-6-input\").append('<div class=\"onoffswitch\"><input type=\"checkbox\" name=\"onoffswitch\" class=\"onoffswitch-checkbox\" id=\"return-onoffswitch\"><label class=\"onoffswitch-label\" for=\"return-onoffswitch\"><span class=\"onoffswitch-inner\"></span><span class=\"onoffswitch-switch\"></span></label></div>');\n\n\n\t\t\t//option 7 \n\n\t\t\t$(\".route-options-cont\").append($('<div>',{class:\"route-option\",id: \"option-7\"}));\n\n\t\t\t$(\"#option-7\").append($('<div>',{class: \"w3-row\"})  .append($(\"<div>\",{class: \"w3-col s12 w3-left-align\"}).append($(\"<span>\",{class:\"\"}).html(\"Statuses to use for suggestions:\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\",{class: \"w3-col s12 w3-left-align w3-padding-left w3-padding-right\"})  .append($(\"<div>\",{class: \"w3-col s6\"})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\").append($(\"<input>\",{value:\"online\",type:\"checkbox\",class:\"w3-check route-status-include\"}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<label>\",{class:\"w3-padding-left w3-validate\"}).html(\"online\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\").append($(\"<input>\",{value:\"planned\", type:\"checkbox\",class:\"w3-check route-status-include\"}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<label>\",{class:\"w3-padding-left w3-validate\"}).html(\"planned\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\").append($(\"<input>\",{value:\"unknown\", type:\"checkbox\",class:\"w3-check route-status-include\"}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<label>\",{class:\"w3-padding-left w3-validate\"}).html(\"unknown\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t )\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\",{class: \"w3-col s6\"})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\").append($(\"<input>\",{value:\"occupied\",type:\"checkbox\",class:\"w3-check route-status-include\"}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<label>\",{class:\"w3-padding-left w3-validate\"}).html(\"occupied\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<div>\").append($(\"<input>\",{value:\"offline\",type:\"checkbox\",class:\"w3-check route-status-include\"}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t.append($(\"<label>\",{class:\"w3-padding-left w3-validate\"}).html(\"offline\")))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t )))\n\n\t\t\t//option functions\n\n\t\t\t//checkbox for charge suggest\n\n\t\t\t$(\"#charge-suggest-checkbox\").change(function(){\n\t\t\t\tif (storagePossible) {localStorage.chargeSuggest = this.checked;}\n\t\t\t\tif (!this.checked) {\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tchargeSuggestionController.resetOpacity();\n\t\t\t\t\t\tchargeSuggestionController.clearResult();\n\t\t\t\t\t\t$(\"#charge-suggest-menu\").hide();\n\t\t\t\t\t},450);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t$(\"#charge-suggest-menu\").show();\n\t\t\t\t\t},330);\n\t\t\t\t}\n\t\t\t\tsetTimeout(processRoute,350);\n\t\t\t});\n\n\t\t\t//checkbox for custom mi/kWh\n\n\t\t\t$(\"#mikwh-onoffswitch\").change(function(){\n\t\t\t\tif (storagePossible) { localStorage.customMiKwhOption = this.checked;}\n\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t$(\"#option-5\").slideToggle(function(){\n\t\t\t\t\t\tif ($(\"#mikwh-onoffswitch\").prop(\"checked\")){\n\t\t\t\t\t\t\t$(\"#average-mi-kwh\").trigger(\"blur\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvehicleConsumpForSpeed.setOverride(0);\n\t\t\t\t\t\t\tprocessRoute();\t\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},350);\t\t\t\t\t\n\t\t\t\n\t\t\t});\n\n\t\t\t//checkbox for choosing which statuses to include in route calculation\n\n\t\t\t$(\".route-status-include\").change(function(){\n\t\t\t\tvar timeout;\n\n\t\t\t\treturn function () {\n\t\t\t\t\tclearTimeout(timeout);\n\t\n\t\t\t\t\tvar routeStatusInclude = [];\n\t\t\t\t\t$(\".route-status-include\").each(function(index,element){\n\t\t\t\t\t\tif (this.checked) {\n\t\t\t\t\t\t\trouteStatusInclude.push(this.value);\n\t\t\t\t\t\t\tif (this.value == \"occupied\") {\n\t\t\t\t\t\t\t\trouteStatusInclude.push(\"in session\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tchargeSuggestionController.setRouteStatusInclude(routeStatusInclude);\n\t\t\t\t\tlocalStorage.routeStatusInclude = JSON.stringify(routeStatusInclude);\n\n\t\t\t\t\ttimeout = setTimeout(calcRoute,650);\n\n\t\t\t\t};\n\n\t\t\t}());\n\n\t\t\t//charger radius change\n\n\t\t\t$(\"#charger-radius\").change(function(){\n\t\t\t\tprocessRoute();\n\t\t\t});\n\t\t\t\t\t\n\t\t\t\n\t\t\t//dropdown for each option title\n\n\t\t\t$(\".route-options .route-options-title\").click(function(e){\n\t\t\t\tif (e.target !== this){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t$(\".route-options-cont\").slideToggle();\n\t\t\t\t$(\".route-options .expand-v\").eq($(\".route-titles\").index(this)).fadeToggle();\n\t\t\t});\n\n\t\t\t//error checking and auto-process battery capacity\t\t\t\t\t\n\n\t\t\t$(\"#route-kwh-capacity\").blur(function(){\n\n\t\t\t\tif (!(Number(this.value) > 0)) {\n\t\t\t\t\t$(\"#option-2-input .error\").remove();\n\t\t\t\t\t$(\"#option-2-input\").append($(\"<span>\",{class: \"error\"}).text(\"Oops!\"));\n\t\t\t\t\t$(\".route-kwh\").eq(0).css({\"border-color\": \"red\"});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$(\".route-kwh\").eq(0).css({\"border-color\": \"\"});\n\t\t\t\t$(\"#option-2-input .error\").remove();\n\n\t\t\t\tchargeSuggestionController.setCapacity(this.value * 1000);\n\t\t\t\tif (storagePossible) {\n\t\t\t\t\tlocalStorage.kwhCapacity = this.value;\n\t\t\t\t}\n\n\t\t\t\t$(\"#route-kwh-low-limit\").trigger(\"blur\");\n\t\t\t\t\n\t\t\t});\n\n\t\t\t//error checking and auto-process battery starting capacity\t\t\t\t\t\n\n\t\t\t$(\"#route-kwh-start-capacity\").blur(function(){\n\n\t\t\t\tif ( !(Number(this.value) > 0) || !(Number(this.value) < 101) ) {\n\t\t\t\t\t$(\"#option-21-input .error\").remove();\n\t\t\t\t\t$(\"#option-21-input\").append($(\"<span>\",{class: \"error\"}).text(\"Oops!\"));\n\t\t\t\t\t$(\".route-kwh\").eq(1).css({\"border-color\": \"red\"});\n\t\t\t\t\treturn; \n\t\t\t\t}\n\n\t\t\t\t$(\".route-kwh\").eq(1).css({\"border-color\": \"\"});\n\t\t\t\t$(\"#option-21-input .error\").remove();\n\n\t\t\t\tchargeSuggestionController.setStartTankLevel(Number(this.value));\n\t\t\t\tif (storagePossible) {\n\t\t\t\t\t\n\t\t\t\t\tlocalStorage.kwhStartCapacity = this.value;\n\t\t\t\t}\n\n\t\t\t\tprocessRoute();\n\t\t\t\t\n\t\t\t});\n\n\t\t\t//error checking and auto-process battery low limit\n\n\t\t\t$(\"#route-kwh-low-limit\").blur(function(){\n\n\t\t\t\tif (!(Number(this.value) > 0 && Number(this.value) < 100)) {\n\t\t\t\t\t$(\"#option-3-input .error\").remove();\n\t\t\t\t\t$(\"#option-3-input\").append($(\"<span>\",{class: \"error\"}).text(\"Oops!\"));\n\t\t\t\t\t$(\".route-kwh\").eq(2).css({\"border-color\": \"red\"});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$(\".route-kwh\").eq(2).css({\"border-color\": \"\"});\n\t\t\t\t$(\"#option-3-input .error\").remove();\n\n\t\t\t\tchargeSuggestionController.setLowLimit(parseFloat(this.value));\n\t\t\t\tif (storagePossible) {\n\t\t\t\t\t\n\t\t\t\t\tlocalStorage.kwhLowLimit = this.value;\n\t\t\t\t}\n\n\t\t\t\tprocessRoute();\n\t\t\t});\n\n\t\t\t//custom mi-kwh values\n\n\t\t\t$(\"#average-mi-kwh\").blur(function(){\n\t\t\t\tif (!(Number(this.value) > 0 && Number(this.value) < 10 && this.value.length < 4)) {\n\t\t\t\t\t$(\"#option-5-input .error\").remove();\n\t\t\t\t\tif (this.value.length > 3){\n\t\t\t\t\t\tvar text = \"One decimal please!\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar text = \"Oops!\"\n\t\t\t\t\t}\n\t\t\t\t\t$(\"#option-5-input\").append($(\"<span>\",{class: \"error\"}).text(text));\n\t\t\t\t\t$(\".route-kwh\").eq(2).css({\"border-color\": \"red\"});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$(\".route-kwh\").eq(2).css({\"border-color\": \"\"});\n\t\t\t\t$(\"#option-5-input .error\").remove();\n\n\t\t\t\tvehicleConsumpForSpeed.setOverride(parseFloat(this.value));\n\n\t\t\t\tif (storagePossible) {\n\t\t\t\t\tlocalStorage.customMiKwh = this.value;\n\t\t\t\t}\n\n\t\t\t\tprocessRoute();\n\t\t\t\t\n\t\t\t});\n\n\t\t\t//update route when reverse selected\n\n\t\t\t$(\"#return-onoffswitch\").change(function(){\n\t\t\t\tif (storagePossible) { localStorage.reverseOption = this.checked;}\n\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tif ($(\"#return-onoffswitch\").prop(\"checked\")) {\n\t\t\t\t\t\treturnJourney.getReturnRoute();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturnJourney.clearReturnRoute();\n\t\t\t\t\t}\n\t\t\t\t},350);\t\t\t\t\t\n\t\t\t\n\t\t\t});\n\n\t\t\t//setup minimum value and capacity from local storage if possible.\n\n\t\t\tif (storagePossible && localStorage.kwhCapacity !== undefined ){\n\t\t\t\t$(\"#route-kwh-capacity\").val(parseFloat(localStorage.kwhCapacity));\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tchargeSuggestionController.setCapacity(parseFloat(localStorage.kwhCapacity)*1000);\n\t\t\t\t\n\n\t\t\t} else {\n\t\t\t\tchargeSuggestionController.setCapacity(21000);\n\t\t\t\n\t\t\t\t$(\"#route-kwh-capacity\").val(21);\n\t\t\t\t\n\t\t\t}\n\n\t\t\tif (storagePossible && localStorage.kwhLowLimit !== undefined ){\n\t\t\t\t\n\t\t\t\t$(\"#route-kwh-low-limit\").val(parseFloat(localStorage.kwhLowLimit));\n\t\t\t\t\n\t\t\t\n\t\t\t\tchargeSuggestionController.setLowLimit(parseFloat(localStorage.kwhLowLimit));\n\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tchargeSuggestionController.setLowLimit(20);\n\t\t\t\t\n\t\t\t\t$(\"#route-kwh-low-limit\").val(20);\n\t\t\t}\n\n\t\t\t//setup start capacity from local storage if possible.\n\n\t\t\tif (storagePossible && localStorage.kwhStartCapacity !== undefined ){\n\t\t\t\t$(\"#route-kwh-start-capacity\").val(parseFloat(localStorage.kwhStartCapacity));\n\t\t\t\tchargeSuggestionController.setStartTankLevel(parseFloat(localStorage.kwhStartCapacity));\n\t\t\t} else {\n\t\t\t\tchargeSuggestionController.setStartTankLevel(80);\n\t\t\t\t$(\"#route-kwh-start-capacity\").val(80);\n\t\t\t\t\n\t\t\t}\n\n\t\t\t//setup status to include local storage if possible\n\n\t\t\tif (storagePossible && localStorage.routeStatusInclude) {\n\t\t\t\tvar routeStatusInclude = JSON.parse(localStorage.routeStatusInclude);\n\n\t\t\t\t$(\".route-status-include\").each(function(index,element){\n\t\t\t\t\tif (routeStatusInclude.indexOf(this.value) > -1) {\n\t\t\t\t\t\t$(this).prop(\"checked\",true);\n\t\t\t\t\t} \n\t\t\t\t});\n\n\t\t\t\tchargeSuggestionController.setRouteStatusInclude(routeStatusInclude);\n\n\t\t\t} else {\n\t\t\t\t$(\".route-status-include\").each(function(index,element){\n\t\t\t\t\tif (this.value == \"online\" || this.value == \"occupied\") {\n\t\t\t\t\t\t$(this).prop(\"checked\",true);\n\t\t\t\t\t} \n\t\t\t\t});\n\t\t\t\tvar routeStatusInclude = [\"online\",\"occupied\"];\n\t\t\t\tchargeSuggestionController.setRouteStatusInclude(routeStatusInclude);\n\t\t\t\tlocalStorage.routeStatusInclude = JSON.stringify(routeStatusInclude);\n\t\t\t}\n\n\t\t\t//add charge suggestions menu after the options menu\n\n\t\t\tvar $div = $(\"<div>\",{id: \"charge-suggest-menu\"});\n\t\t\t$(\".route-options-cont\").after($div);\n\n\t\t\t$p = $(\"<div>\",{id: \"suggest-title\", class: \"route-titles\"}).text(\"Charge Suggestions\").append($(\"<div>\",{class: \"expand-h\"})).append($(\"<div>\",{class: \"expand-v\"}));\n\t\t\t$(\"#charge-suggest-menu\").append($p);\n\n\t\t\t$tableCont = $(\"<div>\",{class: \"charge-suggest-cont\"});\n\t\t\t$(\"#charge-suggest-menu\").append($tableCont);\n\n\t\t\t//functions\n\n\t\t\t//on clicking the title, expand container and update expand cross.\n\n\t\t\t$(\"#suggest-title\").click(function(e){\n\t\t\t\tif (e.target !== this){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$(\".charge-suggest-cont\").slideToggle();\n\t\t\t\t$(\".route-options .expand-v\").eq($(\".route-titles\").index(this)).fadeToggle();\n\t\t\t});\n\n\t\t\t//as we expand this automatically, expand it.\n\n\t\t\t$(\"#route-cont .expand-v\").eq(2).fadeToggle();\t\n\n\t\t\t//$(\".myroute-title .expand-v\").fadeToggle();\n\t\t\t//$(\"#table-cont\").\n\n\t\t}\n\t\t\t\n\t\t//show markers within radius\n\n\t\tupdateMarkersOnMapFromRoute.update();\n\t\t\n\t\tcalcEnergyConsumption(legs);\n\n\t\tif ($(\"#charge-suggest-checkbox\").prop(\"checked\")){\n\t\t\tchargeSuggestionController.get();\n\t\t} else {\n\t\t\tchargeSuggestionController.clearResult();\n\t\t}\n\n\t\tsetTimeout(function(){\n\t\t\tspinnerLoader.hide();\n\t\t\tif (!$(\".clear-route\").length){\n\t\t\t\t$buttonBar = $(\"<div>\",{class:\"w3-btn-bar w3-col s10 clear-route\"});\n\t\t\t\t$buttonBar.append($(\"<span>\",{class: \"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue\"}).text(\"Clear\").click(function(){\n\t\t\t\t\tclearRoute();\n\t\t\t\t}));\n\t\t\t\t$buttonBar.append($(\"<span>\",{class: \"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue\"}).text(\"Reverse\").click(function(){\n\t\t\t\t\tswitchRoute();\n\t\t\t\t}));\n\t\t\t\t$buttonBar.append($(\"<span>\",{class: \"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue\"}).text(\"Add Stop\").click(function(){\n\t\t\t\t\taddWaypointField();\n\t\t\t\t}));\n\t\t\t\t$buttonBarContainer = $(\"<div>\",{class: \"w3-row\"}).append($(\"<div>\",{class:\"w3-col s1\"}).append(\"&ensp;\"))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t   .append($buttonBar)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t   .append($(\"<div>\",{class:\"w3-col s1\"}).append(\"&ensp;\"));\n\t\t\t\t\n\t\t\t\t$(\".route-inputs-container\").after($buttonBarContainer);\n\t\t\t}\n\t\t},500);\n\n\n\t\t\n    };\n\n\t\n}();\n\nvar mapIdleEvent = function(){\n\tvar e;\n\treturn {\n\t\tadd: function(){\n\t\t\te = google.maps.event.addListener(map, 'idle', function(){\n\n\t\t\t\tspinnerLoader.hide();\n\n\t\t\t\tif (!toggleWaypoints.isActive() && device == \"computer\"){\n\t\t\t\t\tsetTimeout(toggleWaypoints.toggle,500);\n\t\t\t\t}\n\n\t\t\t\tmapIdleEvent.remove();\n\t\t\t});\n\t\t},\n\t\tremove: function(){\n\t\t\tgoogle.maps.event.removeListener(e);\n\t\t}\t\t\n\t};\n}();\n\nvar updateMarkersOnMapFromRoute = function(){\n\n\tvar routeMarkers;\n\n\treturn {\n\t\tupdate: function(){\n\n\t\t\trouteMarkers = [];\n\n\t\t\tvar radius = document.getElementById(\"charger-radius\").value;\n\n\t\t\tif (storagePossible){\n\t\t\t\tlocalStorage.radius = radius;\n\t\t\t}\n\n\t\t\tvar route_path = route.path;\n\t\t\tvar routeProgress = 0;\n\n\t\t\tfor (var i = 0; i < allmarkers.length; i++) {\n\n\t\t\t\tvar d = 0;\n\n\t\t\t\tonroute = false;\n\n\t\t\t\tfor (var x = 0; x < route_path.length && !onroute; x++) {\n\t\t\t\t\tif ((calcCordDistance(route_path[x].lat(),route_path[x].lng(),allmarkers[i].position.lat(),allmarkers[i].position.lng()) < (Number(radius)*1.621371) )) {\n\t\t\t\t\t\tonroute = true;\n\n\t\t\t\t\t\tfor (var z = 0; z < x; z++) {\n\t\t\t\t\t\t\td += calcCordDistance(route_path[z].lat(),route_path[z].lng(),route_path[z+1].lat(),route_path[z+1].lng());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tallmarkers[i].markerRouteDistanceWindow.setDistanceIntoRoute((d/1.60934));\n\t\t\t\t\t\t\n\t\t\t\t\t} \n\t\t\t\t}\n\n\n\n\t\t\t\tfor (var y = 0; y < allmarkers[i].info.connectors.length; y++) { //do this once\n\t\t\t\t\tif (connectors.indexOf(allmarkers[i].info.connectors[y].type.id) >= 0) {\n\n\t\t\t\t\t\tif (onroute) {\n\t\t\t\t\t\t\tallmarkers[i].setVisible(true);\n\t\t\t\t\t\t\tallmarkers[i].setOpacity(1);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tallmarkers[i].setVisible(false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (onroute){\n\t\t\t\t\t\t\trouteMarkers.push(allmarkers[i]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetRouteMarkers: function(){\n\t\t\treturn routeMarkers;\n\t\t}\n\t}\n}();\n\nvar returnJourney = function(){\n\tvar tempWaypoints = [];\n\tvar tempDestination = \"\";\n\tvar returnActive = false;\n\treturn {\n\t\tgetReturnRoute: function(isCallback){\n\t\t\t//Assume route has been entered already so set the origin as the destination\n\t\t\tif (isCallback === undefined){\n\t\t\t\ttempDestination = $(\"#routeend\").val();\n\n\t\t\t\tgeocodeRequest(tempDestination,function(result, status){\n\t\t\t\t\treturnJourney.getReturnRoute(processGeocodeResponse(result,status));\n\t\t\t\t});\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\t//we have received the geocoded destination\n\t\t\t\t//update destination\n\t\t\t\t$(\"#routeend\").val($(\"#routestart\").val());\n\n\t\t\t\ttempWaypoints = [];\n\n\t\t\t\t//get the current waypoints and store them\n\t\t\t\troute.waypoints.forEach(function(val,ind){\n\t\t\t\t\tif (!val.autoWaypoint){\n\t\t\t\t\t\ttempWaypoints.push(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\troute.waypoints = [];\n\n\t\t\t\ttempWaypoints.forEach(function(val){\n\t\t\t\t\troute.waypoints.push(val);\n\t\t\t\t});\n\n\t\t\t\t//add our destination as a waypoint\t\t\t\t\n\n\t\t\t\tprocessWaypoints({\n\t\t\t\t\tname: isCallback.title,\n\t\t\t\t\tlat: isCallback.location.lat,\n\t\t\t\t\tlng: isCallback.location.lng,\n\t\t\t\t\tautoWaypoint: true\n\t\t\t\t},true);\n\n\t\t\t\t//add return journey waypoints back in reverse\n\n\t\t\t\tfor (var i = tempWaypoints.length - 1; i > -1; i--) {\n\t\t\t\t\troute.waypoints.push(tempWaypoints[i]);\n\t\t\t\t};\n\n\t\t\t\t//calculate route\n\t\t\t\tcalcRoute(true);\n\t\t\t}\n\n\t\t},\n\t\tisActive: function(){\n\t\t\treturn returnActive;\n\t\t},\n\t\tclearReturnRoute: function(){\n\t\t\t$(\"#routeend\").val(tempDestination);\n\t\t\troute.waypoints = [];\n\t\t\ttempWaypoints.forEach(function(val){\n\t\t\t\troute.waypoints.push(val);\n\t\t\t});\n\t\t\tcalcRoute();\n\t\t}\n\t};\n\n}();\n\nvar chargeSuggestionController = function(){\n\tvar direction_result;\n\tvar currentRoute;\n\tvar totalEnergy;\n\tvar lowLimit;\n\tvar stepData;\n\tvar pathData_1;\n\tvar pathData_2;\n\tvar pathCons;\n\tvar pathDist;\n\tvar stepEff;\n\tvar allRouteChargers;\n\tvar allRouteChargers_stored;\n\tvar chargeSuggestions;\n\tvar chargerFound;\n\tvar overviewPath;\n\tvar bounceListener;\n\tvar routeEnergyOverall;\n\tvar routeStatusInclude = [];\n\t\n\n\tfunction addToTotal(energy){\n\t\ttotalEnergy+= energy;\n\t}\n\tfunction resetTotalEnergy(){\n\t\ttotalEnergy = 0;\n\t}\n\tfunction markerBounce(){\n\t\tfor (var i = 0; i < chargeSuggestions.length; i++) {\n\t\t\tchargeSuggestions[i].setAnimation(google.maps.Animation.BOUNCE);\n\t\t}\n\t\tsetTimeout(function(){\n\t\t\tstopBounce();\n\t\t\tgoogle.maps.event.removeListener(bounceListener);\n\t\t}\n\t\t,1400);\n\t}\n\t\n\tfunction stopBounce(){\n\t\tfor (var i = 0; i < chargeSuggestions.length; i++) {\n\t\t\tchargeSuggestions[i].setAnimation(null);\n\t\t}\n\t}\n\tvar energyToNextCharger = function(){\n\t\tvar energy;\n\t\tvar distance;\n\t\tvar chargerFound;\n\t\tvar info;\n\t\tvar routeChargersSorted;\n\n\t\treturn function(startPos){\n\t\t\tenergy = 0;\n\t\t\tdistance = 0;\n\t\t\tchargerFound = false;\n\t\t\tfor (var i = startPos; i < routeEnergyOverall.length && !chargerFound; i++) {\n\t\t\t\tenergy += routeEnergyOverall[i].energy;\n\t\t\t\tdistance += calcCordDistance(routeEnergyOverall[i].start.lat,routeEnergyOverall[i].start.lng,routeEnergyOverall[i].end.lat,routeEnergyOverall[i].end.lng) * 0.621371;\n\t\t\t\tfor (var c = 0; c < allRouteChargers.length && !chargerFound; c++) {\n\t\t\t\t\tif (calcCordDistance(routeEnergyOverall[i].end.lat,routeEnergyOverall[i].end.lng,allRouteChargers[c].info.lat,allRouteChargers[c].info.lng) * 0.621371 < 1) {\n\t\t\t\t\t\tchargerFound = true;\n\t\t\t\t\t\tinfo = allRouteChargers[c];\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tif (chargerFound) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: \"charger\",\n\t\t\t\t\tenergy: energy,\n\t\t\t\t\tcharger: info,\n\t\t\t\t\tdistance: distance,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\tlat: info.info.lat,\n\t\t\t\t\t\tlng: info.info.lng\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\ttype: \"end\",\n\t\t\t\t\tenergy: energy,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\tlat: routeEnergyOverall[i].end.lat,\n\t\t\t\t\t\tlng: routeEnergyOverall[i].end.lng,\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t}();\n\tvar energyTank = function(){\n\t\tvar tank;\n\t\tvar energyTrip;\n\t\tvar capacity;\n\n\t\treturn {\n\t\t\tgetEnergyLevel: function(){\n\t\t\t\treturn tank;\n\t\t\t},\n\t\t\tuseEnergy: function(wh){\n\t\t\t\ttank-= wh;\n\t\t\t\tenergyTrip += wh;\n\t\t\t},\n\t\t\taddEnergy: function(wh){\n\t\t\t\ttank+= wh;\n\t\t\t},\n\t\t\tsetCapacity: function(wh){\n\t\t\t\tcapacity = wh;\n\t\t\t\tlocalStorage.kwhCapacity = wh/1000;\n\t\t\t\t$(\"#route-kwh-capacity\").val(Number(wh/1000).toFixed(1));\n\t\t\t},\n\t\t\tgetCapacity: function(){\n\t\t\t\treturn capacity;\n\t\t\t},\n\t\t\tfillToLevel: function(wh){\n\t\t\t\ttank = wh;\n\t\t\t},\n\t\t\tfillToPercentage: function(percentage){\n\t\t\t\ttank = energyTank.getCapacity()*(percentage/100);\n\t\t\t},\n\t\t\tfillUp: function(){\n\t\t\t\ttank = capacity;\n\t\t\t},\n\t\t\tfillToEightyPercent: function(){\n\t\t\t\ttank = capacity * 0.8;\n\t\t\t},\n\t\t\tgetEnergyTrip: function(){\n\t\t\t\treturn energyTrip;\n\t\t\t},\n\t\t\tresetEnergyTrip: function(){\n\t\t\t\tenergyTrip = 0;\n\t\t\t},\n\t\t\tisFull: function(){\n\t\t\t\treturn tank >= capacity;\n\t\t\t}\n\t\t};\n\t}();\n\n\tfunction addSuggestion(obj){\n\n\t\tvar eClass = \"charge-suggest-info\";\n\n\t\tif (obj.suggestion.charger.info.connectors[0].status === \"pseudo\"){\n\t\t\tvar name = obj.suggestion.charger.info.name;\n\t\t} else {\n\t\t\tvar name = obj.suggestion.charger.info.name.split(\",\")[0];\n\t\t}\n\n\t\tif (obj.suggestion.percentageOnArrival.toFixed(0)  < Number($(\"#route-kwh-low-limit\").val())) {\n\t\t\teClass += \" transition-power-exceeded\";\n\t\t}\n\n\t\tif (obj.suggestion.percentageOnArrival && obj.suggestion.percentageOnDeparture &&\n\t\t\tobj.suggestion.percentageOnArrival !== obj.suggestion.percentageOnDeparture) {\n\t\t\tvar a = obj.suggestion.percentageOnArrival;\n\t\t\ta = a.toFixed(0)+\"%\";\n\t\t\tvar d = obj.suggestion.percentageOnDeparture;\n\t\t\td = d.toFixed(0)+\"%\";\n\t\t\tvar text = 'Arr. ' + a + ' - Dep. ' + d;\n\t\t} else if (obj.suggestion.percentageOnArrival && obj.suggestion.percentageOnDeparture === undefined ) {\n\t\t\tvar a = obj.suggestion.percentageOnArrival;\n\t\t\ta = a.toFixed(0)+\"%\";\n\t\t\tvar text = 'Arr. ' + a;\n\t\t} else {\n\t\t\tvar d = obj.suggestion.percentageOnDeparture;\n\t\t\td = d.toFixed(0)+\"%\";\n\t\t\tvar text = 'Dep. ' + d;\n\t\t}\n\n\t\tvar referenceConnectorId = connectors[0];\n\n\t\tif (obj.suggestion.charger.info.connectors[0].status === \"pseudo\") {\n\t\t\tvar suggestionColor = \"w3-pale-green\";\n\t\t\tvar borderColor = \"w3-border-green\";\n\t\t} else {\n\t\t\tfor (var i = 0; i < obj.suggestion.charger.info.connectors.length; i++) {\n\t\t\t\tif (obj.suggestion.charger.info.connectors[i].type.id == referenceConnectorId) {\n\t\t\t\t\tvar referenceConnector = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\n\t\t\tvar referenceStatus = obj.suggestion.charger.info.connectors[referenceConnector].status;\n\n\t\t\tvar suggestionColor = \"w3-pale-green\";\n\t\t\tvar borderColor = \"w3-border-green\";\n\n\t\t\tif (referenceStatus == \"offline\") {\n\t\t\t\tsuggestionColor = \"w3-pale-red\";\n\t\t\t\tborderColor = \"w3-border-red\";\n\t\t\t}\n\n\t\t\tif (referenceStatus == \"unknown\") {\n\t\t\t\tsuggestionColor = \"w3-light-grey\";\n\t\t\t\tborderColor = \"w3-border-grey\";\n\t\t\t}\n\t\t}\n\n\t\t$row = $(\"<div>\",{class: \"charge-suggest-row w3-container w3-leftbar \"+suggestionColor+\" \"+borderColor})\n\t\t$row.append($(\"<div>\",{class: \"charge-suggest-title\"}).text(name))\n\t\t\t.append($(\"<div>\",{class: eClass}).append($(\"<img>\",{width: \"16px\",height: \"16px\",src: \"img/plug.svg\"})).append(text));\t\t\t\t\t\t\t\t\t\t   \t\t\t\t\t\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t\t\t\t\t   \t\t\t\t\t\t\t\t\t\t\t\t    \n\t\t\n\t\t$(\".charge-suggest-cont\").append($row);\n\t}\n\tfunction addTransition(suggest){\n\t\t//$img = $(\"<img>\").prop(\"src\",\"img/three-dots.png\")\n\t\t \t\t\t\t //.prop(\"width\",\"15\");\n\n\t\t$img = $(\"<i>\",{class: \"material-icons\"}).append(\"more_vert\");\n\n\t\tif (arguments.length){\n\t\t\tvar e = suggest.energy;\n\t\t\te = e.toFixed(0)+\"%\";\n\t\t\tvar d = suggest.distance;\n\t\t\td = d.toFixed(1)+\"mi\";\n\t\t\tvar eClass = \"transition-power\";\n\n\t\t\tif (suggest.energy > energyTank.getCapacity() - lowLimit){\n\t\t\t\teClass += \" transition-power-exceeded\";\n\t\t\t}\n\n\t\t\t$row = $(\"<div>\",{class: \"charge-suggest-transition\"}).append([$(\"<div>\",{class: eClass}).text(d).css({width: \"42%\"}),$(\"<div>\",{class: \"charge-transition-icon\"}).append($img),$(\"<div>\",{class: eClass}).text(e).css({width: \"42%\"})]);\n\t\t} else {\n\t\t\t$row = $(\"<div>\",{class: \"charge-suggest-transition\"}).append([$(\"<div>\").css({width: \"42%\"}),$(\"<div>\",{class: \"charge-transition-icon\"}).append($img),$(\"<div>\").css({width: \"42%\"})]);\n\t\t}\n\n\t\t$(\".charge-suggest-cont\").append($row);\n\t}\n\tfunction startAddress(){\n\t\tvar route = directionsDisplay.getDirections().routes[0];\n\t\tvar start = route.legs[0].start_address;\n\t\treturn $(\"#routestart\").val();\n\t}\n\tfunction endAddress(){\n\t\tvar route = directionsDisplay.getDirections().routes[0];\n\t\tvar end = route.legs[route.legs.length-1].end_address;\n\t\treturn $(\"#routeend\").val();\n\t}\n\n\treturn {\n\t\tget: function(){\n\t\t\tresetTotalEnergy(); \n\n\t\t\tvar waypointData = {\n\t\t\t\tstart: {\n\t\t\t\t\tlat: 1,\n\t\t\t\t\tlng: 1\n\t\t\t\t},\n\t\t\t\twaypoints: [],\n\t\t\t\tend: {\n\t\t\t\t\tlat: 1,\n\t\t\t\t\tlng: 1\n\t\t\t\t}\n\t\t\t};\n\n\n\t\t\tenergyTank.fillToPercentage(Number($(\"#route-kwh-start-capacity\").val()));\n\n\t\t\tvar c = updateMarkersOnMapFromRoute.getRouteMarkers();\n\n\t\t\tallRouteChargers = [];\n\t\t\tallRouteChargers_stored = [];\n \t\t\tchargeSuggestions = [];\n\t\t\trouteChargersSorted = [];\n\n\t\t\tdirection_result = directionsDisplay.getDirections();\n\n\t\t\t//for current route\n\t\t\tcurrentRoute = direction_result.routes[curRoute];\n\t\t\toverviewPath = currentRoute.overview_path;\n\n\t\t\tfor (var i = 0; i < c.length; i++) {\n\t\t\t\tallRouteChargers.push(c[i]);\n\t\t\t\tallRouteChargers_stored.push(c[i]);\n\t\t\t\t\n\t\t\t};\n\n\t\t\tfor (var i = 0; i < allRouteChargers.length; i++) {\n\t\t\t\tallRouteChargers[i].setOpacity(0.4);\n\t\t\t};\n\n\t\t\t//Are we receiving a response to the elevation response?\n\t\t\tif (arguments[0] !== undefined){\n\t\t\t\t//YES\n\t\t\t\tvar elevationResult = arguments[0];\n\t\t\t\tvar elevationStatus = arguments[1];\n\t\t\t\tprocessElevationData(arguments[0],arguments[1]);\n\n\t\t\t} else {\n\t\t\t\t//NO\n\n\t\t\t\t//get elevation data for this route and build request \n\t\t\t\tvar elReq = {\n\t\t\t\t\tpath: overviewPath,\n\t\t\t\t\tsamples: 500\n\t\t\t\t};\n\n\t\t\t\t//make the request and pass this function as callback to return later\n\t\t\t\televation.getElevationAlongPath(elReq,chargeSuggestionController.get);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//It should be healthy at this point - TODO what if it's not?\n\n\t\t\tif (elevationStatus === google.maps.ElevationStatus.OK){\n\n\t\t\t\t//find out ratio of total route for each step step\n\t\t\t\tvar allSteps = [];\n\n\t\t\t\t//total distance\n\t\t\t\tvar routeDistance = 0;\n\n\t\t\t\t//get total route distance\n\t\t\t\tcurrentRoute.legs.forEach(function(leg){\n\t\t\t\t\trouteDistance += leg.distance.value;\n\t\t\t\t});\n\n\t\t\t\t//create array of all steps and their ratio to route\n\n\t\t\t\tcurrentRoute.legs.forEach(function(leg){\n\t\t\t\t\tleg.steps.forEach(function(step){\n\t\t\t\t\t\tvar stepRatioOfRoute = step.distance.value / routeDistance;\n\t\t\t\t\t\tallSteps.push({\n\t\t\t\t\t\t\t\tstep: step,\n\t\t\t\t\t\t\t\tratio: stepRatioOfRoute\n\t\t\t\t\t\t});\t\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t//determine how many elevation responses we have and what they count toward the main route in ratio terms\n\t\t\t\t\n\t\t\t\t//ratio\n\t\t\t\tvar singleElevationResultRatioOfRoute = 1 / elevationResult.length;\n\n\t\t\t\t//for each result, add the energy effect. Starting at 1, so 0-1 energy stored at 1.\n\n\t\t\t\televationResult.forEach(function(result,index){\n\n\t\t\t\t\tvar elChange = 0;\n\t\t\t\t\tvar ascent = 0;\n\t\t\t\t\tvar descent = 0;\n\t\t\t\t\tvar ascentCon = 0;\n\t\t\t\t\tvar decentCon = 0;\n\n\t\t\t\t\tif (index > 0) {\n\t\t\t\t\t\telChange = result.elevation - elevationResult[index-1].elevation;\n\n\t\t\t\t\t\tif (elChange > 0){\n\t\t\t\t\t\t\tascent += elChange;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdescent += Math.abs(elChange);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tascentCon = (ascent / 300) * 1500;\n\t\t\t\t\t\tdescentCon = (descent / 300) * 750;\n\n\t\t\t\t\t\tresult.energy = ascentCon - descentCon;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.energy = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t//split the elevation data amongst steps\n\t\t\t\tallSteps.forEach(function(thisStep){\n\t\t\t\t\tvar thisStepElevRatio = 0;\n\t\t\t\t\tthisStep.elevData = [];\n\t\t\t\t\twhile (thisStepElevRatio + singleElevationResultRatioOfRoute <= thisStep.ratio) {\n\t\t\t\t\t\tthisStep.elevData.push(elevationResult[0]);\n\t\t\t\t\t\televationResult.splice(0,1);\n\t\t\t\t\t\tthisStepElevRatio += singleElevationResultRatioOfRoute;\n\t\t\t\t\t}\n\t\t\t\t});\t\t\t\t\t\t\n\n\t\t\t}\n\n\n\n\t\t\t//generate an array of overall route path with energy used for each step/path\n\n\t\t\trouteEnergyOverall = [];\n\t\t\tvar elevationPath = [];\n\n\t\t\tvar dist = 0;\n\t\t\tvar stepNo = 0;\n\n\t\t\tfor (var a = 0; a < currentRoute.legs.length; a++){\n\t\t\t\tfor (var b = 0; b < currentRoute.legs[a].steps.length; b++){\n\t\t\t\t\tstepEnergy = calcStepEnergyUsage(currentRoute.legs[a].steps[b]);\n\t\t\t\t\n\t\t\t\t\t//Include elevation data if all is okay\n\n\t\t\t\t\tvar stepElevEnergy = 0;\n\n\t\t\t\t\tif (elevationStatus === google.maps.ElevationStatus.OK){\n\n\t\t\t\t\t\tallSteps[stepNo].elevData.forEach(function(step){\n\t\t\t\t\t\t\tstepElevEnergy += step.energy;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var c = 1; c < currentRoute.legs[a].steps[b].path.length; c++) {\n\n\t\t\t\t\t\tpathEnergy = (stepEnergy / currentRoute.legs[a].steps[b].path.length);\n\t\t\t\t\t\tpathElevEnergy = (stepElevEnergy / currentRoute.legs[a].steps[b].path.length)\n\n\t\t\t\t\t\televationPath.push({\n\t\t\t\t\t\t\tlat: currentRoute.legs[a].steps[b].path[c].lat(),\n\t\t\t\t\t\t\tlng: currentRoute.legs[a].steps[b].path[c].lng()\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\tvar ambTemp = vehicleDataController.get().temperature;\n\n\t\t\t\t\t\tif (ambTemp <=20){\n\t\t\t\t\t\t\tvar pathEnergyTempAdjust = pathEnergy * (1 + (((20 - ambTemp) / 2) * 0.01));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar pathEnergyTempAdjust = pathEnergy * (1 - (((20 - ambTemp) / 4) * 0.01));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdist = calcCordDistance(currentRoute.legs[a].steps[b].path[c-1].lat(),currentRoute.legs[a].steps[b].path[c-1].lng(),currentRoute.legs[a].steps[b].path[c].lat(),currentRoute.legs[a].steps[b].path[c].lng())*0.621371;\n\n\t\t\t\t\t\trouteEnergyOverall.push({\n\t\t\t\t\t\t\tenergy: pathEnergyTempAdjust + pathElevEnergy,\n\t\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\t\tlat: currentRoute.legs[a].steps[b].path[c-1].lat(),\n\t\t\t\t\t\t\t\tlng: currentRoute.legs[a].steps[b].path[c-1].lng()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\tlat: currentRoute.legs[a].steps[b].path[c].lat(),\n\t\t\t\t\t\t\t\tlng: currentRoute.legs[a].steps[b].path[c].lng()\t\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdistance: dist,\n\t\t\t\t\t\t\tstartStep: {\n\t\t\t\t\t\t\t\tlat:currentRoute.legs[a].steps[b].start_location.lat(),\n\t\t\t\t\t\t\t\tlng:currentRoute.legs[a].steps[b].start_location.lng()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tendStep: {\n\t\t\t\t\t\t\t\tlat:currentRoute.legs[a].steps[b].end_location.lat(),\n\t\t\t\t\t\t\t\tlng:currentRoute.legs[a].steps[b].end_location.lng()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\t\n\n\n\t\t\t\t\t\tif (a == 0 && b == 0 && c == 1) {\n\n\t\t\t\t\t\t\tallRouteChargers.push({\n\t\t\t\t\t\t\t\tinfo:{\n\t\t\t\t\t\t\t\t\tname: \"Start\",\n\t\t\t\t\t\t\t\t\tlat: currentRoute.legs[a].steps[b].path[c].lat(),\n\t\t\t\t\t\t\t\t\tlng: currentRoute.legs[a].steps[b].path[c].lng(),\n\t\t\t\t\t\t\t\t\tconnectors: [{status:\"pseudo\"}]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (a == currentRoute.legs.length-1 && b == currentRoute.legs[a].steps.length-1 && c == currentRoute.legs[a].steps[b].path.length-1) {\n\t\t\t\t\t\t\t//add start and end to allRouteChargers to allow calculations later on\n\t\t\t\t\t\t\tallRouteChargers.push({\n\t\t\t\t\t\t\t\tinfo:{\n\t\t\t\t\t\t\t\t\tname: \"End\",\n\t\t\t\t\t\t\t\t\tlat: currentRoute.legs[a].steps[b].path[c].lat(),\n\t\t\t\t\t\t\t\t\tlng: currentRoute.legs[a].steps[b].path[c].lng(),\n\t\t\t\t\t\t\t\t\tconnectors: [{status:\"pseudo\"}]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t};\n\n\t\t\t\t\tstepNo += 1;\n\t\t\t\t};\n\t\t\t};\n\n\t\t\twaypointData.start.lat = routeEnergyOverall[0].start.lat.toFixed(5);\n\t\t\twaypointData.start.lng = routeEnergyOverall[0].start.lng.toFixed(5);\n\t\t\twaypointData.end.lat = routeEnergyOverall[routeEnergyOverall.length-1].end.lat.toFixed(5);\n\t\t\twaypointData.end.lng = routeEnergyOverall[routeEnergyOverall.length-1].end.lng.toFixed(5);\n\n\t\t\t\n\t\t\t\n\n\t\t\t//Order all the route chargers along route (including multiples)\n\n\t\t\tvar energy = 0;\n\t\t\tvar dist = 0;\n\t\t\tvar conns = [];\n\t\t\tvar ongoingDist = 0;\n\t\t\tvar lastDistanceFromHere, lastClosestCharger;\n\n\t\t\tallRouteChargers.forEach(function(charger,index){\n\t\t\t\tcharger.lastRouteBearing = 0;\n\t\t\t});\n\t\t\t\n\t\t\tfor (var i = 0; i < routeEnergyOverall.length; i++) {\n\t\t\t\tenergy += routeEnergyOverall[i].energy;\n\t\t\t\tdist += routeEnergyOverall[i].distance;\n\t\t\t\tongoingDist += routeEnergyOverall[i].distance;\n\n\t\t\t\t//find the closest charger to where we currently are\n\n\t\t\t\tvar distanceFromHere = 9999;\n\t\t\t\tvar closestCharger;\n\t\t\t\tvar tempDistance = 0;\n\t\t\t\t\n\t\t\t\tallRouteChargers.forEach(function(charger,index){\n\t\t\t\t\ttempDistance = calcCordDistance(routeEnergyOverall[i].start.lat,routeEnergyOverall[i].start.lng,charger.info.lat,charger.info.lng);\n\t\t\t\t\tif (tempDistance < distanceFromHere) {\n\t\t\t\t\t\tif (routeChargersSorted.length > 0){\n\t\t\t\t\t\t\tif (routeChargersSorted[routeChargersSorted.length -1].charger.info.name !== charger.info.name){\n\t\t\t\t\t\t\t\tclosestCharger = charger;\n\t\t\t\t\t\t\t\tdistanceFromHere = tempDistance;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclosestCharger = charger;\n\t\t\t\t\t\t\tdistanceFromHere = tempDistance;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t});\t\n\n\t\t\t\t//we now know which is the closest charger\n\t\t\t\t\n\t\t\t\tif (distanceFromHere > $(\"#charger-radius\").val()*1.621371) {\n\t\t\t\t\t//Too far away so move along route\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\n\n\t\t\t\t//closer next time and no others closest?\n\t\t\t\tif (i < routeEnergyOverall.length - 1) {\n\n\t\t\t\t\t//check whether the closest charger is still this one next time\n\t\t\t\t\tvar closestChargerNext;\n\t\t\t\t\tnextDistanceFromHere = 9999;\n\t\t\t\t\ttempDistance = 0;\n\n\t\t\t\t\t//find closest charger to next step\n\t\t\t\t\tallRouteChargers.forEach(function(charger,index){\n\t\t\t\t\t\ttempDistance = calcCordDistance(routeEnergyOverall[i+1].start.lat,routeEnergyOverall[i+1].start.lng,charger.info.lat,charger.info.lng);\n\t\t\t\t\t\tif (tempDistance < nextDistanceFromHere) {\n\t\t\t\t\t\t\tnextDistanceFromHere = tempDistance;\n\t\t\t\t\t\t\tclosestChargerNext = charger;\n\t\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tvar nextDistance = calcCordDistance(routeEnergyOverall[i+1].start.lat,routeEnergyOverall[i+1].start.lng,closestCharger.info.lat,closestCharger.info.lng);\n\t\t\t\t\t\n\t\t\t\t\tif (nextDistance < distanceFromHere && closestCharger.info.name === closestChargerNext.info.name) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\t\n\t\t\t\t}\n\n\t\t\t\t// //closer last time?\n\t\t\t\t// if (i > 0) {\n\t\t\t\t// \tvar lastDistance = calcCordDistance(routeEnergyOverall[i-1].start.lat,routeEnergyOverall[i-1].start.lng,closestCharger.info.lat,closestCharger.info.lng);\n\t\t\t\t// \tif (lastDistance < distanceFromHere ) {\n\t\t\t\t// \t\tcontinue;\n\t\t\t\t// \t}\t\n\t\t\t\t// }\n\t\t\t\t\t\t\n\t\t\t\t//do we have another charger near by, and therefore need to check the side of road?\n\t\t\t\tvar closestChargers = [];\n\t\t\t\t\n\t\t\t\tallRouteChargers.forEach(function(charger,index){\n\t\t\t\t\ttempDistance = calcCordDistance(closestCharger.info.lat,closestCharger.info.lng,charger.info.lat,charger.info.lng);\n\t\t\t\t\tif (tempDistance < 3 && tempDistance > 0) {\n\t\t\t\t\t\tclosestChargers.push(charger);\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t});\t\n\n\t\t\t\t\n\n\n\t\t\t\t//we only have one other charger within 1.5km - enough to say motorway?\n\n\t\t\t\tif (closestChargers.length == 1 && closestCharger.info.name !== \"End\" && closestCharger.info.name !== \"Start\") {\n\t\t\t\t\t//is this charger on the correct side of the road\n\t\t\t\t\tvar routeBearing = calcBearing(routeEnergyOverall[i].start.lat,routeEnergyOverall[i].start.lng,routeEnergyOverall[i].end.lat,routeEnergyOverall[i].end.lng);\n\t\t\t\t\tvar bearingToCharger = calcBearing(routeEnergyOverall[i].start.lat,routeEnergyOverall[i].start.lng,closestCharger.info.lat,closestCharger.info.lng);\n\t\t\t\t\tvar lowBearingLimit = bearing.minusDegrees(routeBearing,180);\n\n\t\t\t\t\t//Was our heading last we checked bearing similar to now?\n\t\t\t\t\tif (closestCharger.lastRouteBearing !== 0 && bearing.smallestDelta(routeBearing,closestCharger.lastRouteBearing) < 90) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (bearing.antiClockwiseDegrees(routeBearing,bearingToCharger) > 180) {\n\t\t\t\t\t\tclosestCharger.lastRouteBearing = routeBearing;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if ((bearingToCharger > routeBearing) || (bearingToCharger < lowBearingLimit)) {\n\t\t\t\t\t// \tclosestCharger.lastRouteBearing = routeBearing;\n\t\t\t\t\t// \tcontinue;\n\t\t\t\t\t// }\n\t\t\t\t}\t\t\t\t\n\t\t\t\t\n\t\t\t\t//Have we just added this charger?\n\t\t\t\tif (routeChargersSorted.length > 0){\n\n\t\t\t\t\t//When was this last added?\n\t\t\t\t\tvar lastDistance = 0;\n\t\t\t\t\trouteChargersSorted.forEach(function(charger,index){\n\t\t\t\t\t\tif (charger.charger.info.name === closestCharger.info.name && lastDistance === 0) {\n\t\t\t\t\t\t\tlastDistance = charger.distIntoRoute;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t \tif (ongoingDist - lastDistance < 5){\n\n\t\t\t\t \t\tcontinue;\n\t\t\t\t \t}\n\t\t\t\t}\t\t\t\t\n\n\t\t\t\t// Have we looped back around and found the start which we've already added?\n\t\t\t\tif (routeChargersSorted.length > 0){\n\t\t\t\t \tif (closestCharger.info.name === \"Start\"){\n\t\t\t\t \t\tcontinue;\n\t\t\t\t \t}\n\t\t\t\t}\n\n\t\t\t\t// Have we found the end on our first shot?\n\t\t\t\tif (routeChargersSorted.length === 0){\n\t\t\t\t \tif (closestCharger.info.name === \"End\"){\n\t\t\t\t \t\tcontinue;\n\t\t\t\t \t}\n\t\t\t\t}\n\n\t\t\t\t//Is the closest charger actually the end point? If so, wait until we're right next to it.\n\t\t\t\tif (routeChargersSorted.length > 0){\n\t\t\t\t \tif (closestCharger.info.name === \"End\" && i !== routeEnergyOverall.length - 1){\n\t\t\t\t \t\tcontinue;\n\t\t\t\t \t}\n\t\t\t\t}\n\n\n\t\t\t\t//Create array of this charger's connectors to find online statuses\n\n\t\t\t\tconns = [];\n\n\t\t\t\tclosestCharger.info.connectors.forEach(function(con){\n\t\t\t\t\tif (con.status !== \"pseudo\"){\n\t\t\t\t\t\tconns.push(con.type.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tvar conNo = -1;\n\n\t\t\t\t//find the location of the first valid connector \n\n\t\t\t\tconnectors.forEach(function(value){\n\t\t\t\t\tif (conns.indexOf(value) > -1 && conNo < 0)  {\n\t\t\t\t\t\tconNo = conns.indexOf(value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t\n\n\t\t\t\t//Check if the chosen connector is online\n\t\t\t\tif (closestCharger.info.connectors[0].status === \"pseudo\" || routeStatusInclude.indexOf(closestCharger.info.connectors[conNo].status) > -1){\n\n\t\t\t\t\t// var info = new google.maps.InfoWindow({\n\t\t\t\t\t// \tposition: {lat: routeEnergyOverall[i].start.lat, lng: routeEnergyOverall[i].start.lng},\n\t\t\t\t\t// \tcontent: closestCharger.info.name+\"<br>\"+routeBearing+\"<br>\"+bearingToCharger,\n\t\t\t\t\t// \tmap: map\n\t\t\t\t\t// });\n\n\t\t\t\t\t//Yes! So add it to the list of sorted chargers\n\t\t\t\t\trouteChargersSorted.push({\n\t\t\t\t\t\tcharger: closestCharger,\n\t\t\t\t\t\tenergy: energy,\n\t\t\t\t\t\tdistance: dist,\n\t\t\t\t\t\tdistIntoRoute: ongoingDist\n\t\t\t\t\t});\n\n\t\t\t\t\tif (closestCharger.info.connectors[0].status !== \"pseudo\") {\n\t\t\t\t\t\twaypointData.waypoints.push({\n\t\t\t\t\t\t\tlat: closestCharger.info.lat.toFixed(5),\n\t\t\t\t\t\t\tlng: closestCharger.info.lng.toFixed(5),\n\t\t\t\t\t\t\tstartStep: {\n\t\t\t\t\t\t\t\tlat: routeEnergyOverall[i].startStep.lat.toFixed(5),\n\t\t\t\t\t\t\t\tlng: routeEnergyOverall[i].startStep.lat.toFixed(5)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tendStep: {\n\t\t\t\t\t\t\t\tlat: routeEnergyOverall[i].endStep.lat.toFixed(5),\n\t\t\t\t\t\t\t\tlng: routeEnergyOverall[i].endStep.lat.toFixed(5)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\n\t\t\t\t\t//clear counters\n\n\t\t\t\t\tenergy = 0;\n\t\t\t\t\tdist = 0;\t\t\t\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t//Not online, so continue.\n\t\t\t\tcontinue;\t\n\t\t\t\t\n\t\t\t}\n\n\t\t\t// submitJSONToServer(\"php/waypoints.php\",JSON.stringify(waypointData),function(response){\n\t\t\t// \talert(\"Hello\");\n\t\t\t// });\n\n\t\t\t\n\t\t\t//now find charge suggestions\n\n\t\t\tvar energyNeeded = 0;\n\t\t\t\n\t\t\tvar energy = 0;\n\t\t\tvar dist = 0;\n\t\t\tvar nextStop = 0;\n\n\t\t\t//need last leg in sorted list to calc\n\t\t\tfor (var i = 0; i < routeChargersSorted.length; i++) {\n\n\t\t\t\t//total energy & distance so far\n\t\t\t\tenergy += routeChargersSorted[i].energy;\n\t\t\t\tdist += routeChargersSorted[i].distance;\n\n\t\t\t\t//Consume energy required to get to this stop, we would have charged earlier if we needed to\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tvar toGetHere = routeChargersSorted[i].energy;\n\t\t\t\t\tenergyTank.useEnergy(toGetHere);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//while we're not the first OR last stop (as we can't charge at and and define start charge.\n\t\t\t\tif (i < routeChargersSorted.length-1 && i == nextStop){\n\t\t\t\t\t\n\t\t\t\t\t//energy we got here with\n\t\t\t\t\tvar weArrivedWith = energyTank.getEnergyLevel();\n\n\t\t\t\t\trouteChargersSorted[i].percentageOnArrival = (energyTank.getEnergyLevel()/energyTank.getCapacity()) * 100;\n\n\t\t\t\t\t//How many stops do can we get through whilst charge is less than max?\n\t\t\t\t\t\n\t\t\t\t\tenergyNeeded = 0;\n\n\t\t\t\t\tvar oldNextStop = nextStop;\n\n\t\t\t\t\tfor (var z = 0; z < routeChargersSorted.length; z++) {\n\n\t\t\t\t\t\tif (z > i) { //for chargers ahead of us, if we can add that energy to the tank with spare do so\n\t\t\t\t\t\t\tif ( i > 0 && ((energyNeeded + routeChargersSorted[z].energy + lowLimit) <= (energyTank.getCapacity()*0.9))  ||\n\t\t\t\t\t\t\t     i == 0 && ((energyNeeded + routeChargersSorted[z].energy + lowLimit) <= energyTank.getEnergyLevel()) ) {\n\t\t\t\t\t\t\t\tenergyNeeded += routeChargersSorted[z].energy;\n\t\t\t\t\t\t\t\tnextStop = z;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (oldNextStop == nextStop) {\n\t\t\t\t\t\t\t\t\tnextStop = i + 1;\n\t\t\t\t\t\t\t\t\tenergyNeeded = (energyTank.getCapacity() * 0.9) - lowLimit;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\n\t\t\t\t\tvar currentEnergy = energyTank.getEnergyLevel();\n\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tenergyTank.fillToLevel(energyNeeded+lowLimit);\t\n\t\t\t\t\t}\t\t\t\t\t\n\n\t\t\t\t\t//Update the level we've charged to\n\t\t\t\t\trouteChargersSorted[i].percentageOnDeparture = (energyTank.getEnergyLevel()/energyTank.getCapacity()) * 100;\n\n\t\t\t\t\t//add this stop to the chargers array\n\t\t\t\t\tchargeSuggestions.push({\n\t\t\t\t\t\tenergy: (energy / energyTank.getCapacity()) * 100,\n\t\t\t\t\t\tdistance: dist,\n\t\t\t\t\t\tsuggestion: routeChargersSorted[i]\n\t\t\t\t\t});\n\n\t\t\t\t\tenergy = 0;\n\t\t\t\t\tdist = 0;\n\t\t\t\t\t\n\t\t\t\t}\t\t\t\t\t\n\n\t\t\t\t\n\n\t\t\t\t//add the final charger as a suggestion so we can render it with distance and energy\n\t\t\t\tif (i == (routeChargersSorted.length-1)){\n\n\t\t\t\t\trouteChargersSorted[i].percentageOnArrival = (energyTank.getEnergyLevel()/energyTank.getCapacity()) * 100;\n\n\t\t\t\t\t//add this stop to the chargers array\n\t\t\t\t\tchargeSuggestions.push({\n\t\t\t\t\t\tenergy: (energy / energyTank.getCapacity()) * 100,\n\t\t\t\t\t\tdistance: dist,\n\t\t\t\t\t\tsuggestion: routeChargersSorted[i]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//We're done with start and end markrs for chargers so update with names\n\n\t\t\tchargeSuggestions[0].suggestion.charger.info.name = startAddress();\n\t\t\tchargeSuggestions[chargeSuggestions.length-1].suggestion.charger.info.name = endAddress();\n\n\t\t\t//set opacity on suggestions (except first and last as these should be start and end points and get comments\n\t\t\tvar commentRequest = [];\n\t\t\tfor (var i = 1; i < chargeSuggestions.length - 1; i++) {\n\n\t\t\t\tchargeSuggestions[i].suggestion.charger.setOpacity(1);\n\n\t\t\t\tcommentRequest.push({\n\t\t\t\t\toperator_id: chargeSuggestions[i].suggestion.charger.info.provider_openid,\n\t\t\t\t\tlat: chargeSuggestions[i].suggestion.charger.info.lat,\n\t\t\t\t\tlng: chargeSuggestions[i].suggestion.charger.info.lng\n\t\t\t\t});\n\n\t\t\t};\n\n\t\t\tajaxHandler({\n\t\t\t\turl: \"php/OCM_comments.php\",\n\t\t\t\tdata: commentRequest,\n\t\t\t\tsuccess: chargeSuggestionController.processComments\n\t\t\t});\n\t\t\n    \t\t//submitJSONToServer(\"php/OCM_comments.php\",JSON.stringify(commentRequest),chargeSuggestionController.processComments);\n\n\t\t\t// bounceListener = google.maps.event.addListener(map, 'idle', function(){\n\t\t\t// \tsetTimeout(function(){\n\t\t\t// \t\tchargeSuggestion.bounceMarkers();\n\t\t\t// \t},\n\t\t\t// \t500);\n\t\t\t// });\n\n\t\t\tchargeSuggestionController.renderResult();\n\n\t\t},\n\t\tsetCapacity: function(wh){\n\t\t\tenergyTank.setCapacity(wh);\n\t\t},\n\t\tsetStartTankLevel: function(percentage){\n\t\t\tenergyTank.fillToPercentage(percentage);\n\t\t},\n\t\tsetLowLimit: function(limit){\n\t\t\tlowLimit = (energyTank.getCapacity()/100) * limit;\n\t\t},\n\t\tbounceMarkers: function(){\n\t\t\tmarkerBounce();\n\t\t},\n\t\trenderResult: function(){\n\t\t\tthis.clearResult();\n\n\t\t\t// var $div = $(\"<div>\",{id: \"charge-suggest-menu\"});\n\t\t\t// $(\".route-options-cont\").after($div);\n\n\t\t\t// $p = $(\"<p>\",{id: \"suggest-title\"}).text(\"Charge Suggestions\");\n\t\t\t// $(\"#charge-suggest-menu\").append($p);\n\n\t\t\t// $tableCont = $(\"<div>\",{class: \"charge-suggest-cont\"}).css({display: \"none\",width:\"100%\"});\n\t\t\t// $(\"#charge-suggest-menu\").append($tableCont);\n\n\n\t\t\t// $(\"#suggest-title\").click(function(e){\n\t\t\t// \tif (e.target !== this){\n\t\t\t// \t\treturn;\n\t\t\t// \t}\n\t\t\t// \t$(\".charge-suggest-cont\").slideToggle();\n\t\t\t// });\n\t\t\t\n\n\t\t\tfor (var i = 0 ; i < chargeSuggestions.length; i++) {\n\t\t\t\taddSuggestion(chargeSuggestions[i]);\n\t\t\t\t\n\t\t\t\tif (i < chargeSuggestions.length - 1){\n\t\t\t\t\taddTransition(chargeSuggestions[i+1]);\n\t\t\t\t}\t\t\n\t\t\t};\n\n\t\t\t$(\".charge-suggest-cont\").append($(\"<div>\",{class: \"suggest-caution\"}).text(\"Caution, this is currently in Beta. Check Plugshare before travel.\"));\n\n\t\t\t$(\".charge-suggest-title\").click(function(){\n\t\t\t\tvar suggestNo = $.inArray(this,$(\".charge-suggest-title\"));\n\t\t\t\tif (suggestNo > 0 && suggestNo < $(\".charge-suggest-title\").length - 1){\n\t\t\t\t\t\n\t\t\t\t\t// map.panTo({\n\t\t\t\t\t// \tlat: chargeSuggestions[suggestNo].suggestion.charger.info.lat,\n\t\t\t\t\t// \tlng: chargeSuggestions[suggestNo].suggestion.charger.info.lng,\n\t\t\t\t\t// });\n\t\t\t\t\tchargeSuggestions[suggestNo].suggestion.charger.showInfoWindow(true);\n\t\t\t\t\t// alert(chargeSuggestion.getChargingTime(\n\t\t\t\t\t// \tenergyTank.getCapacity(),\n\t\t\t\t\t// \tchargeSuggestions[suggestNo].suggestion.percentageOnArrival,\n\t\t\t\t\t// \tchargeSuggestions[suggestNo].suggestion.percentageOnDeparture,\n\t\t\t\t\t// \t50\n\t\t\t\t\t// ));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\n\n\t\t},\n\t\tclearResult: function(){\n\t\t\t$(\".charge-suggest-cont\").children().remove();\n\t\t},\n\t\tresetOpacity: function(){\n\t\t\tif (allRouteChargers_stored.length){\n\t\t\t\tfor (var i = 0; i < allRouteChargers_stored.length; i++) {\n\t\t\t\t\tallRouteChargers_stored[i].setOpacity(1);\t\n\t\t\t\t};\n\t\t\t}\n\t\t}, \n\t\tprocessComments: function(response){\n\t\t\tvar commentRequest = response;\n\n\t\t\t$(\".charge-suggest-title\").after(function(index){\n\t\t\t\tvar now = new Date();\n\t\t\t\tif (index > 0 && index < $(\".charge-suggest-title\").length - 1){\n\n\t\t\t\t\tvar $userData = $(\"<div>\",{class: \"charge-suggest-userdata\"});\n\t\t\t\t\tvar $commCont = $(\"<div>\",{class: \"charge-suggest-comment-container\"});\n\n\t\t\t\t\t//if there aren't any comments\n\t\t\t\t\tif (commentRequest[index - 1].comments === null){\n\t\t\t\t\t\t$userData.append($(\"<div>\",{class: \"comments-title\"})\n\t\t\t\t\t\t\t\t\t.append($(\"<div>\",{class: \"expand-h-small no-comments\"}))\n\t\t\t\t\t\t\t\t\t.append($(\"<div>\",{class: \"expand-v-small no-comments\"}))\n\t\t\t\t\t\t\t\t\t.append($(\"<i>\",{class: \"material-icons comment-icon\"}).append(\"warning\"))\n\t\t\t\t\t\t\t \t \t.append($(\"<span>\").append(\"No user comments\"))\n\t\t\t\t\t\t\t \t \t.append($commCont)\n\t\t\t\t\t\t\t \t );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t$($commCont).append($(\"<span>\").append(\"Comments powered by <a target='_blank' href='http://openchargemap.org/site/poi/details/\" + commentRequest[index - 1].comments[0].ChargePointID +\"'>OpenChargeMap</a>\"));\n\n\t\t\t\t\t\tvar lastCommentDate;\n\t\t\t\t\t\tvar lastCheckinType;\n\n\t\t\t\t\t\tfor (var i = 0; i < commentRequest[index - 1].comments.length; i++) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar aClass = \"bubble charge-suggest-comment\" + commentType(commentRequest[index - 1].comments[i].CheckinStatusTypeID);\n\t\t\t\t\t\t\tvar date = new Date(commentRequest[index - 1].comments[i].DateCreated);\n\t\t\t\t\t\t\tif (!i){\n\t\t\t\t\t\t\t\tlastCommentDate = date;\n\t\t\t\t\t\t\t\tlastCheckinType = commentType(commentRequest[index - 1].comments[i].CheckinStatusTypeID);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar date = date.getDate() + \" \" + getActualMonth(date.getMonth()) + \" \" + date.getFullYear().toString().substring(2,4) + \":\";\n\n\t\t\t\t\t\t\tvar commentTitle = \"\";\n\t\t\t\t\t\t\tvar userComment = commentRequest[index - 1].comments[i].Comment;\n\n\t\t\t\t\t\t\tif (commentRequest[index - 1].comments[i].CheckinStatusType === null) {\n\t\t\t\t\t\t\t\tcommentTitle = commentRequest[index - 1].comments[i].CommentType.Title;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcommentTitle = commentRequest[index - 1].comments[i].CheckinStatusType.Title;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (commentTitle.indexOf(\"(\") > 0){\n\t\t\t\t\t\t\t\tcommentTitle = commentTitle.substring(0,commentTitle.indexOf(\"(\")-1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (userComment) {\n\n\t\t\t\t\t\t\t\tvar userName = commentRequest[index - 1].comments[i].UserName;\n\n\t\t\t\t\t\t\t\tif (userName) {\n\t\t\t\t\t\t\t\t\tuserName = \" - \" + userName;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tuserName = \"\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$commCont.append(\n\t\t\t\t\t\t\t\t\t$(\"<div>\",{class: aClass}).append( $(\"<div>\",{class: \"comment-date\"}).append(date))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  .append( $(\"<div>\",{class: \"comment-text\"}).append(commentTitle))\n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t  .append( $(\"<div>\",{class: \"user-comment collapsed-comment\"}).append( $(\"<div>\",{class: \"quote-cont\"}).append($(\"<i>\",{class: \"fa fa-quote-left\"}))  )\n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .append($(\"<span>\").append(userComment))\n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .append( $(\"<div>\",{class: \"quote-cont\"}).append($(\"<i>\",{class: \"fa fa-quote-right\"})) )\n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .append($(\"<span>\").append(userName)) \n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t  )\t\t\t\t\n\t\t\t\t\t\t \t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$commCont.append(\n\t\t\t\t\t\t\t\t\t$(\"<div>\",{class: aClass}).append( $(\"<div>\",{class: \"comment-date\"}).append(date))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  .append( $(\"<div>\",{class: \"comment-text\"}).append(commentTitle))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  .append( $(\"<div>\",{class: \"user-comment collapsed-comment\"}).append($(\"<span>\").append('No comment left..'))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .append($(\"<span>\").append(userName)) )\n\t\t\t\t\t\t \t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tvar daysSinceLastCheckin = daysBetweenDates(lastCommentDate,now);\n\n\t\t\t\t\t\tif (daysSinceLastCheckin > 7) {\n\t\t\t\t\t\t\tif (lastCheckinType == \" comment-positive\"){\n\t\t\t\t\t\t\t\tvar imgSrc = \"error_outline\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"Last successful checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t} else if (lastCheckinType == \" comment-negative\") {\n\t\t\t\t\t\t\t\tvar imgSrc = \"warning\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"Unsuccessful checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar imgSrc = \"error_outline\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"Neutral checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (lastCheckinType == \" comment-positive\"){\n\t\t\t\t\t\t\t\tvar imgSrc = \"check\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"Successful checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t} else if (lastCheckinType == \" comment-negative\") {\n\t\t\t\t\t\t\t\tvar imgSrc = \"warning\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"Unsuccessful checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar imgSrc = \"error_outline\";\n\t\t\t\t\t\t\t\tvar cmtTitle = \"General checkin \" + daysSinceLastCheckin + \" days ago\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//Add to the userdata-header first!\n\t\t\t\t\t\t$userData.append($(\"<div>\",{class: \"comments-title\"})\n\t\t\t\t\t\t\t\t \t .append($(\"<i>\",{class: \"material-icons comment-icon\"}).append(imgSrc))\n\t\t\t\t\t\t\t\t \t .append($(\"<span>\").append(cmtTitle))\n\t\t\t\t\t\t\t\t\t .append($(\"<div>\",{class: \"expand-h-small\"}))\n\t\t\t\t\t\t\t\t\t .append($(\"<div>\",{class: \"expand-v-small\"}))\n\t\t\t\t\t\t\t\t\t .click(function(e){\n\t\t\t\t\t\t\t\t \t \t$(\".charge-suggest-comment-container\").eq($(\".comments-title\").index(e.delegateTarget)).slideToggle();\n\t\t\t\t\t\t\t\t \t \t$(\".comments-title > .expand-v-small\").eq($(\".comments-title\").index(e.delegateTarget)).fadeToggle();\n\t\t\t\t\t\t\t\t \t })\n\t\t\t\t\t\t\t\t );\n\n\t\t\t\t\t\t$userData.append($commCont);\n\n\t\t\t\t\t}\t\t\t\t\t\n\n\t\t\t\t\treturn $userData;\n\t\t\t\t}\n\n\t\t\t});\n\t\t},\n\t\tgetChargingTime: function(){\n\n\t\t\tvar capacity = 0;\n\t\t\tvar chargeTime = 0;\n\t\t\tvar targetCap = 0;\n\t\t\tvar powerInc = 0;\n\n\t\t\tfunction getChargingSpeed(p){\n\t\t\t\tif (p <= 0.75) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (p <= 0.80) {\n\t\t\t\t\treturn 0.8;\n\t\t\t\t} else if (p <= 0.85) {\n\t\t\t\t\treturn 0.65;\n\t\t\t\t} else if (p <= 0.90) {\n\t\t\t\t\treturn 0.35;\n\t\t\t\t} else if (p <= 0.95) {\n\t\t\t\t\treturn 0.15;\n\t\t\t\t} else if (p <= 1.00) {\n\t\t\t\t\treturn 0.05;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0.01;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn function(capTotal, capStart, capEnd, chargeSpeed) {\n\t\t\t\tcapacity = Number(capStart.toFixed(0))/100;\n\t\t\t\ttargetCap = Number(capEnd.toFixed(0))/100;\n\t\t\t\tchargeTime = 0;\n\t\t\t\tpowerInc = 0.01 * capTotal; //eg 0.01 of 20kW = 200w.\n\n\t\t\t\twhile (capacity < targetCap) {\n\t\t\t\t\tcapacity += 0.01;\n\t\t\t\t\tchargeTime+= (3600 / ((getChargingSpeed(capacity) * (chargeSpeed * 1000)) / powerInc));\n\t\t\t\t}\n\n\t\t\t\treturn chargeTime / 60;\n\n\t\t\t};\n\n\t\t}(),\n\t\tsetRouteStatusInclude: function(statuses){\n\t\t\trouteStatusInclude = statuses;\n\t\t}\n\n\t};\n\n}();\n\n\nfunction daysBetweenDates(firstDate,secondDate){\n\tvar oneDay = 24*60*60*1000; \n\treturn diffDays = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay)));\n}\n\nfunction commentType(id){\n\tif (id == 10 || id == 15 || id == 210){\n\t\treturn \" comment-positive\";\n\t} else if ( id == 120 || id == 130 || id == 160 || id == 30 || id == 22 || id == 20 || id == 25 || id == 50 || id == 40 || id == 200){\n\t\treturn \" comment-negative\";\n\t} else {\n\t\treturn \" comment-neutral\";\n\t}\n}\n\nfunction calcEnergyConsumption(legs){\n\tvar routeCon = 0;\n\tvar stepDist = 0;\n\tvar stepSpeed = 0;\n\tvar stepCon = 0;\n\tvar legCon = 0;\n\n\tfor (var l = 0; l < legs.length; l++) {\n\t\tlegCon = 0;\n\t\tfor (var s = 0; s < legs[l].steps.length; s++) {\n\t\t\tstepDist = (legs[l].steps[s].distance.value / 1000) * 0.621371;\n\t\t\tstepSpeed = stepDist / (legs[l].steps[s].duration.value / (60*60));\n\t\t\treqSpeed = stepSpeed * 1.00;\n\t\t\tstepCon = (vehicleConsumpForSpeed.get(reqSpeed)/1000) * stepDist;\n\t\t\tlegCon += stepCon;\n\t\t};\n\n\t\trouteCon += legCon;\n\t\troute.consumption.waypoints[l] = {baseline:legCon,adjusted:0};\n\t};\n\n\troute.consumption.total.baseline = routeCon;\n}\n\nvar calcStepEnergyEfficiency = function(step){\n\tvar stepDist = 0;\n\tvar stepSpeed = 0;\n\tvar stepEff = 0;\n\n\treturn function(step){\n\t\tstepDist = (step.distance.value / 1000) * 0.621371;\n\t\tstepSpeed = stepDist / (step.duration.value / (60*60));\n\t\treqSpeed = stepSpeed * 1.00;\n\t\tstepEff = vehicleConsumpForSpeed.get(reqSpeed);\n\t\treturn stepEff;\n\t};\n}();\n\nvar calcStepEnergyUsage = function(step){\n\tvar stepDist = 0;\n\tvar stepSpeed = 0;\n\tvar stepEff = 0;\n\n\treturn function(step){\n\t\tstepDist = (step.distance.value / 1000) * 0.621371;\n\t\tstepSpeed = stepDist / (step.duration.value / (60*60));\n\t\treqSpeed = stepSpeed * 1.00;\n\t\tstepEff = vehicleConsumpForSpeed.get(reqSpeed);\n\t\treturn stepEff * stepDist;\n\t};\n}();\n\nfunction getTimeFromSec(sec){\n\tvar hour = Math.ceil(sec/(60*60)) - 1;\n\n\tvar mins = Math.ceil((sec / 60) - (hour * 60));\n\n\tif (hour > 0){\n\t\tif (mins > 0){\n\t\t\treturn hour + \" hours \" + mins + \" mins\";\n\t\t} else {\n\t\t\treturn hour + \" hours \";\n\t\t}\n\t\t\n\t} else {\n\t\treturn mins + \" mins\";\n\t}\n}\n\nfunction getMilesFromKm(km){\n\tvar distance = ((km / 1000) * 0.621371) ;\n\tdistance = Math.ceil(distance);\n\treturn distance;\n}\n\nfunction insertAfter(newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\nfunction clearRoute() {\n\tdirectionsDisplay.setMap(null);\n\n\tchargeSuggestionController.clearResult();\n\n\tif (chart !== undefined){\n\t\tchart.clearChart();\n\t}\n\t\n\troute.clear();\n\t$(\".directions-display\").html(\"\");\n\t\n\tdocument.getElementById(\"routestart\").value = \"\";\n\tdocument.getElementById(\"routeend\").value = \"\";\n\t\n\tshowMarkers();\n\n\t$(\".route-waypoint-cont\").remove();\n}\n\n//\n// Map marker functions\n//\n\nfunction addMarker(location,direction) {\n\n\tvar url;\n\tvar offset;\n\tvar shape;\n\tvar zindex;\n\tvar obstat = \"\";\n\tvar pinDirection = \"\";\n\tvar markertype = \"\";\n\n\tif (direction == \"left\") {\n\t\tpinDirection = \"l\";\n\t\tshape = {\n\t\t\t\t\tcoords: [5,2,9,1,13,4,14,9,13,13,10,14,5,13,2,11,1,6,3,2,5,2],\n\t\t\t\t\ttype: 'poly'\n\t\t};\n\n\t\toffset = -9;\n\n\t\tif (location.connectors[0].status == \"offline\") {\n\t\t\turl = \"img/pl_64x64.png\";\n\t\t} else if (location.connectors[0].status == \"planned\" || location.connectors[0].status == \"unknown\" || location.connectors[0].status == \"occupied\" || location.connectors[0].status == \"in session\") {\n  \t\t\turl = \"img/bl_64x64.png\";\n  \t\t} else {\n  \t\t\turl = \"img/gl_64x64.png\";\n\t\t}\n\n\t} else if (direction == \"mid\") {\n\t\tpinDirection = \"m\";\n\t\tshape = {\n\t\t\t\t\tcoords: [16,0,21,2,22,8,20,13,14,12,10,8,11,2,16,0],\n\t\t\t\t\ttype: 'poly'\n\t\t};\n\n\t\toffset = 0;\n\n\t\tif (location.connectors[0].status == \"offline\") {\n\t\t\turl = \"img/pm_64x64.png\";\n\t\t} else if (location.connectors[0].status == \"planned\" || location.connectors[0].status == \"unknown\") {\n  \t\t\turl = \"img/bm_64x64.png\";\n  \t\t} else {\n  \t\t\turl = \"img/gm_64x64.png\";\n\t\t}\n\n    } else if (direction == \"right\") {\n    \tpinDirection = \"r\";\n\t\tshape = {\n\t\t\t\t\tcoords: [28,1,31,5,31,11,28,15,21,15,18,10,18,5,23,1,28,1],\n\t\t\t\t\ttype: 'poly'\n\t\t};\n\n\t\toffset = 7;\n\n\t\tif (location.connectors[0].status == \"offline\") {\n\t\t\turl = \"img/pr_64x64.png\";\n\t\t\t\n\t\t} else if (location.connectors[0].status == \"planned\" || location.connectors[0].status == \"unknown\") {\n  \t\t\turl = \"img/br_64x64.png\";\n\t\t\t\n  \t\t} else {\n  \t\t\turl = \"img/gr_64x64.png\";\n\t\t}\t\t\t\t\n    }\n\n\tif (location.connectors[0].status == \"offline\") {\n\t\tzindex = 8000 - (location.lat*100);\n\t\tobstat = \"offline\";\n\t} else if (location.connectors[0].status == \"planned\" || location.connectors[0].status == \"unknown\") {\n  \t\tzindex = 6000 - (location.lat*100);\n  \t} else {\n  \t\tzindex = 10000 - (location.lat*100);\n\t}\n\n\tvar image = { \n\t\turl: url,\n\t\tscaledSize: new google.maps.Size(32, 32),\n\t\torigin: new google.maps.Point(0, 0),\n\t\tanchor: new google.maps.Point(16, 32)\n    };\n\n\tvar marker = new google.maps.Marker({\n\t\tinfo: location,\n\t\tposition: {lat: location.lat, lng: location.lng},\n\t\tmap: map,\n\t\ticon: image,\n\t\tshape: shape,\n\t\tzIndex: zindex,\n\t\tvisible: false,\n\t\toffset: offset,\n\t\tupdateMarker: updateMarkerUrl,\n\t\trouteOptions: routeOptions,\n\t\tshowInfoWindow: getMarkerInfoWindow,\n\t\tpinDirection: pinDirection,\n\t\tgetChargerHistory: getChargerHistory,\n\t\tprocessChargerHistory: processChargerHistory,\n\t\tmarkerRouteDistanceWindow: markerRouteDistanceWindow()\n\t});\n\n    google.maps.event.addListener(marker, 'click', getMarkerInfoWindow);\n    \n    google.maps.event.addListener(marker, 'click', function(){\n    \tactiveMarker=this;\n    \t\n    });\n    // google.maps.event.addListener(marker, 'mouseover', function(){\n    // \tvar a = updateMarkersOnMapFromRoute.getRouteMarkers();\n    // \tfor (var i = 0; i < a.length; i++) {\n    // \t\ta[i].markerRouteDistanceWindow.showDistancePopup(a[i]);\n    // \t};\n    \n    // });\n    // google.maps.event.addListener(marker, 'mouseout', function(){\n    // \tvar a = updateMarkersOnMapFromRoute.getRouteMarkers();\n    // \tfor (var i = 0; i < a.length; i++) {\n    // \t\ta[i].markerRouteDistanceWindow.closeDistancePopup();\n    // \t};\n    // });\n\n    marker.markerRouteDistanceWindow.setDistanceIntoRoute(allmarkers.length);\n  \n    allmarkers.push(marker);\n}\n\nfunction getChargerHistory(a){\n\tvar p = a.info.provider;\n\tvar lat = a.info.lat;\n\tvar lng = a.info.lng;\n\tvar j = {\n\t\tprovider: p,\n\t\tlat: lat,\n\t\tlng: lng\n\t};\n\n\tajaxHandler({\n\t\turl: \"php/charger_history.php\",\n\t\tdata: j,\n\t\tsuccess: processChargerHistory\n\t});\n\n\t//submitJSONToServer(\"php/charger_history.php\",JSON.stringify(j),processChargerHistory);\n}\n\nfunction processChargerHistory(result){\n\tvar a = result;\n\tactiveMarker.chargerHistory = a;\n}\n\nfunction updateMarkerUrl(){\n\tvar icon = this.getIcon();\n\n\tfor (var i = 0; i < this.info.connectors.length; i++){\n\t\tif (this.info.connectors[i].type.id == connectors[0]) {\n\t\t\tif (this.pinDirection == \"r\") {\n\t\t\t\tif (this.info.connectors[i].status == \"offline\"){\n\t\t\t\t\ticon.url = \"img/pr_64x64.png\";\n\t\t\t\t} else if (this.info.connectors[i].status == \"planned\" || \n\t\t\t\t\t\t   this.info.connectors[i].status == \"unknown\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"occupied\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"in session\") {\n\t\t\t\t\ticon.url = \"img/br_64x64.png\";\n\t\t\t\t} else {\n\t\t\t\t\ticon.url = \"img/gr_64x64.png\";\n\t\t\t\t}\n\t\t\t\tthis.setIcon(icon);\n\t\t\t\tbreak;\n\t\t\t} else if (this.pinDirection == \"m\") {\n\t\t\t\tif (this.info.connectors[i].status == \"offline\"){\n\t\t\t\t\ticon.url = \"img/pm_64x64.png\";\n\t\t\t\t} else if (this.info.connectors[i].status == \"planned\" || \n\t\t\t\t\t\t   this.info.connectors[i].status == \"unknown\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"occupied\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"in session\") {\n\t\t\t\t\ticon.url = \"img/bm_64x64.png\";\n\t\t\t\t} else {\n\t\t\t\t\ticon.url = \"img/gm_64x64.png\";\n\t\t\t\t}\n\t\t\t\tthis.setIcon(icon);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tif (this.info.connectors[i].status == \"offline\"){\n\t\t\t\t\ticon.url = \"img/pl_64x64.png\";\n\t\t\t\t} else if (this.info.connectors[i].status == \"planned\" || \n\t\t\t\t\t\t   this.info.connectors[i].status == \"unknown\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"occupied\" ||\n\t\t\t\t\t\t   this.info.connectors[i].status == \"in session\") {\n\t\t\t\t\ticon.url = \"img/bl_64x64.png\";\n\t\t\t\t} else {\n\t\t\t\t\ticon.url = \"img/gl_64x64.png\";\n\t\t\t\t}\n\t\t\t\tthis.setIcon(icon);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n  \n}\n\nfunction routeOptions(){\n\n\t//hereyouare\n\tmapWaypointPopup.setPseudoGeoResp(\"Set this pin as:\",{lat:this.info.lat,lng:this.info.lng});\n\tmapWaypointPopup.setWindowPos({lat:this.info.lat,lng:this.info.lng});\n\tmapWaypointPopup.open();\n\n\n\t// if (document.getElementById(\"routestart\").value == \"\" || document.getElementById(\"routeend\").value == \"\"){\n\t// \tswal({\n\t// \t\ttitle: \"Oops..\",\n\t// \t\ttext: \"You need a start and end point before you can add a waypoint.\",\n\t// \t\ttype: \"error\"\n\t// \t});\n\t// } else {\n\t// \tvar thisWaypoint = {};\n\t// \tthisWaypoint.name = this.info.name;\n\t// \tthisWaypoint.lat = this.info.lat;\n\t// \tthisWaypoint.lng = this.info.lng;\n\t// \tprocessWaypoints(thisWaypoint);\n\t// }\t\n\n\t// if (openWindow != null){\n\t//     \topenWindow.close();\n\t// }\n}\n\nfunction getMarkerInfoWindow(n){\n\n\tactiveMarker = this;\n\n\tthis.getChargerHistory(this);\n\n\t\n\tif (openRssWindow != null){\n\t\topenRssWindow.close();\n\t}\n\tif (openWindow != null){\n\t\topenWindow.close();\n\t}\n\tshowHistoryInfoWindow.close();\n\t\n\tvar content = infoWindowContent(this.info);\n\n\tvar infoWindow = new google.maps.InfoWindow({\n\t\tgetRssInfoWindow: showRssInfoWindow,\n\t\tgetHistoryInfoWindow: showHistoryInfoWindow,\n\t    content: content,\n\t    maxWidth: 300,\n\t    pixelOffset: new google.maps.Size(this.offset, 0),\n\t    zIndex: 9,\n\t    disableAutoPan: false\n\t});\n\n\tgoogle.maps.event.addListener(infoWindow,'closeclick',function(){\n\t\tshowHistoryInfoWindow.close();\n\t});\n\n\topenWindow = infoWindow;\n\topenWindow.info = this.info;\n\topenWindow.open(map,this);\n\tdelete infoWindow;\n\t\n}\n\nfunction showRssInfoWindow(){\n\n\tif (openRssWindow != null){\n    \t\topenRssWindow.close();\n    }\n\n\tvar content = \n\t'<div class = \"infowindow_rss\">'+\n\t'<h3>Available Connectors</h3>'+\n\t'<table style=\"width:100%\">'; \n\n\tif (this.info.provider == \"Ecotricity\" || this.info.provider == \"Polar\") {\n\t    for (var i = 0; i < this.info.connectors.length; i++) {\n\t    \tif (rssCheckChargerPresent(this.info,i)) {\n\t    \t\tvar rssActionText = \"Remove\";\n\t    \t} else {\n\t    \t\tvar rssActionText = \"Add\";\n\t    \t}\n\t    \tcontent += '<tr><td style=\"width:60%\"><h4>' + this.info.connectors[i].type.title + '</h4> </td> <td style=\"width:40%;text-align:center\" > <a class=\"rss_cmd\" onclick=\"rssAddRemove(' + i + ')\">' + rssActionText + '</a></td></tr>';\n\t    }\n\t} else {\n\t\tcontent += '<tr><td style=\"width:100%;text-align:center;\" ><h3> Sorry, not yet supported.</h3> </td> </tr>';\n\t}\n\n\tcontent+= \"</table></div>\";\n\n\tvar infoWindow = new google.maps.InfoWindow({\n\t\t    content: content,\n\t\t    minWidth: 100,\n\t\t    pixelOffset: new google.maps.Size(activeMarker.offset + 75, -50),\n\t\t    zIndex: 10,\n\t\t    disableAutoPan: true\n\t\t});\n\n\topenRssWindow = infoWindow;\n\topenRssWindow.open(map,activeMarker);\n\tdelete infoWindow;\n\n}\n\nvar showHistoryInfoWindow = function(){\n\n\tvar historyWindow;\n\tvar infoWindowContent;\n\tvar infoWindowContentHeight;\n\n\tfunction statusColour(status){\n\t\tif (status === 'online' || status === \"in session\"){\n\t\t\treturn 'green';\n\t\t} else if (status === 'offline'){\n\t\t\treturn 'red';\n\t\t} else {\n\t\t\treturn 'black';\n\t\t}\n\t}\n\n\treturn {\n\t\tshow: function(){\n\t\t\tif (historyWindow !== undefined){\n\t\t    \t\thistoryWindow.close();\n\t\t    }\n\t\t    infoWindowContentHeight = $(\".infowindow-content\").css(\"height\");\n\t\t    infoWindowContent = $(\".infowindow-content\").html();\n\n\t\t    var a = [];\n\n\t\t    for (var i = 0; i < activeMarker.info.connectors.length; i++) {\n\t\t    \tif (activeMarker.info.connectors[i].isDual){\n\t\t    \t\ta.push(activeMarker.info.connectors[i].type.title);\n\t\t    \t}\n\t\t    };\n\t\t    \n\t\t\tvar content = \n\t\t\t// '<div class = \"charger-history\">'+\n\t\t\t'<h5 style=\"min-width:300px\">Status History</h5>'+\n\t\t\t'<div class=\"charger-history-content\">';\n\n\t\t\t\n\t\t\t// +\n\t\t\t// '<tr>'+\n\t\t\t// '<th>Date</th>'+\n\t\t\t// '<th>Connector</th>'+\n\t\t\t// '<th>State</th>'+\n\t\t\t// '</tr>'; \n\n\t\t\tif (activeMarker.chargerHistory !== false){\n\n\t\t\t\tcontent += '<div class=\"w3-row\">';\n\n\t\t\t\tfor (var i = 0; i < activeMarker.chargerHistory.length; i++) {\n\n\n\t\t\t\t\tif (a.indexOf(activeMarker.chargerHistory[i].type) < 0){\n\t\t\t\t\t\tcontent += '<div class=\"w3-col s4\">';\n\n\t\t\t\t\t\t//format is 2016-04-01 14:30:24\n\n\t\t\t\t\t\tvar d = activeMarker.chargerHistory[i].date_time;\n\t\t\t\t\t\tvar date = d.split(\" \")[0];\n\t\t\t\t\t\tvar time = d.split(\" \")[1];\n\t\t\t\t\t\tvar date = date.split(\"-\");\n\t\t\t\t\t\tvar time = time.split(\":\");\n\n\t\t\t\t\t\tcontent += date[2] + ' ' + (getActualMonth(Number(date[1])-1)) + ' ' + date[0].substring(2,4) + ' ' + time[0] + \":\" + time[1]\t;\n\t\t\t\t\t\tcontent += '</div>';\n\n\t\t\t\t\t\tcontent += '<div class=\"w3-col s4\">';\n\n\t\t\t\t\t\tcontent += activeMarker.chargerHistory[i].type;\n\t\t\t\t\t\tcontent += '</div>';\n\n\t\t\t\t\t\tcontent += '<div class=\"w3-col s4 w3-text-' + statusColour(activeMarker.chargerHistory[i].new_status) + '\">';\n\n\t\t\t\t\t\tcontent += activeMarker.chargerHistory[i].new_status;\n\t\t\t\t\t\tcontent += '</div>';\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tcontent += '</div>';\n\t\t\t} else {\n\t\t\t\tcontent += '<div class=\"w3-col s12\">Looks like we don'+String.fromCharCode(39)+'t have any historical data yet..</div>';\n\t\t\t}\n\n\t\t\tcontent+= \"</div>\";\n\t\t\t\n\t\t\tinfoWindowContentHeight = $(\".infowindow-content\").css(\"height\");\n\t\t\t$(\".infowindow-content\").css(\"height\",infoWindowContentHeight)\n\t\t\t\t\t\t\t\t\t.css(\"overflow\",\"auto\")\n\t\t\t\t\t\t\t\t\t.html(content);\n\t\t\t$(\".history-button\").removeClass(\"w3-green\").addClass(\"w3-blue\");\n\n\t\t\t// // var infoWindow = new google.maps.InfoWindow({\n\t\t\t// \t    content: content,\n\t\t\t// \t    pixelOffset: new google.maps.Size(activeMarker.offset + 102, -63),\n\t\t\t// \t    zIndex: 10,\n\t\t\t// \t    maxWidth:350,\n\t\t\t// \t    disableAutoPan: false\n\t\t\t// \t});\n\n\t\t\t// historyWindow = infoWindow;\n\t\t\t// historyWindow.open(map,activeMarker);\n\t\t\n\t\t},\n\t\tclose: function(){\n\t\t\tif (historyWindow !== undefined){\n\t\t\t\thistoryWindow.close();\t\n\t\t\t}\n\t\t\t$(\".infowindow-content\").html(infoWindowContent);\n\t\t\t$(\".history-button\").removeClass(\"w3-blue\").addClass(\"w3-green\");\n\t\t},\n\t\ttoggle: function(){\n\t\t\tif (!$(\".charger-history-content\").length) {\n\t\t\t\tthis.show();\n\n\t\t\t} else {\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t};\n\t\n\n\t\t\n\n}();\n\nvar connectorsController = function (){\n\n\tvar timeout;\n\n\tvar connectorIds = [\n\t\t{\n\t\t\tid: 2, \n\t\t\tname: \"CCS\"\n\t\t},\n\t\t{\n\t\t\tid: 1, \n\t\t\tname: \"CHAdeMO\"\n\t\t},\n\t\t{\n\t\t\tid: 3, \n\t\t\tname: \"AC (tethered)\"\n\t\t},\n\t\t{\n\t\t\tid: 4, \n\t\t\tname: \"AC (socket)\"\n\t\t},\n\t\t{\n\t\t\tid: 7, \n\t\t\tname: \"Tesla\"\n\t\t}\n\t];\n\n\treturn {\n\t\tupdate: function(cid,startup){\t\n\n\t\t\tclearTimeout(timeout);\t\t\n\n\t\t\tif (startup === undefined){\n\t\t\t\t//normal operation\n\n\t\t\t\t//initilise our array if we haven't got any connectors\n\t\t\t\tif (connectors == \"none\"){\n\t\t\t\t\tconnectors = [];\n\t\t\t\t}\n\n\t\t\t\tvar cLoc = connectors.indexOf(cid);\n\n\t\t\t\t//if the id being added exists, remove it. Else, add it.\n\t\t\t\tif (cLoc >= 0){\n\t\t\t\t\tconnectors.splice(cLoc,1);\n\t\t\t\t} else {\n\t\t\t\t\tconnectors.push(cid);\n\t\t\t\t}\n\t\t\t\t//If we can, store the users choice locally.\n\t\t\t\tif (storagePossible) {\n\t\t\t    \tlocalStorage.connectors = JSON.stringify(connectors);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t//first execution after site load, autoload if you will\n\t\t\t\tif (storagePossible){\n\t\t\t\t\tif (localStorage.connectors !== undefined){\n\t\t\t\t\t\tconnectors = JSON.parse(localStorage.connectors);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconnectors = \"none\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconnectorsController.update(1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tupdateConnectorCheckmarks();\n\n\t\t\ttimeout = setTimeout(function(){\n\t\t\t\tshowMarkers();\n\t\t\t},500);\n\t\t},\n\t\tgetNameArray: function(){\n\t\t\tvar currentConnectors = [];\n\n\t\t\tconnectors.forEach(function(cValue,cIndex){\n\t\t\t\tvar connectorName = \"\";\n\t\t\t\tconnectorIds.forEach(function(idValue,idIndex){\n\t\t\t\t\tif (cValue == idValue.id) {\n\t\t\t\t\t\tconnectorName = idValue.name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcurrentConnectors.push(connectorName);\n\t\t\t});\n\n\t\t\treturn currentConnectors;\n\t\t},\n\t\tclear: function(){\n\t\t\tconnectors = [];\n\t\t}\n\n\t};\n\n}();\n\n\n\n\nvar getActualMonth = function(){\n\tvar m = [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];\n\n\treturn function(e){\n\t\treturn m[e];\n\t};\n}();\n\nfunction updateConnectorCheckmarks(){\n\n\t$(\".connectors i\").each(function(index,element){\n\t\tswitch (index){\n\t\t\tcase 0:\n\t\t\t\tif (connectors.indexOf(2) >= 0) {\n\t\t\t\t\t$(element).fadeTo(50,1);\n\t\t\t\t} else {\n\t\t\t\t\t$(element).fadeTo(50,0);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tif (connectors.indexOf(1) >= 0) {\n\t\t\t\t\t$(element).fadeTo(50,1);\n\t\t\t\t} else {\n\t\t\t\t\t$(element).fadeTo(50,0);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif (connectors.indexOf(3) >= 0) {\n\t\t\t\t\t$(element).fadeTo(50,1);\n\t\t\t\t} else {\n\t\t\t\t\t$(element).fadeTo(50,0);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tif (connectors.indexOf(4) >= 0) {\n\t\t\t\t\t$(element).fadeTo(50,1);\n\t\t\t\t} else {\n\t\t\t\t\t$(element).fadeTo(50,0);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tif (connectors.indexOf(7) >= 0) {\n\t\t\t\t\t$(element).fadeTo(50,1);\n\t\t\t\t} else {\n\t\t\t\t\t$(element).fadeTo(50,0);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t});\n}\n\nfunction showMarkers(args) {\n\n\tfor ( var i = 0; i < allmarkers.length; i++) {\n\t\tallmarkers[i].setVisible(false);\n\t\tallmarkers[i].setOpacity(1);\n\n\t\tvar connectorcount = allmarkers[i].info.connectors.length;\n\n\t\tfor ( var y = 0; y < connectorcount; y++) {\n\n\t\t\tif (connectors.indexOf(allmarkers[i].info.connectors[y].type.id) >= 0) {\n\t\t\t\tallmarkers[i].setVisible(true);\n\t\t\t\tallmarkers[i].updateMarker();\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n\nfunction infoWindowContent (location){\n\tvar status;\n\tvar dual = false;\n\tvar psurl = \"http://api.plugshare.com/view/map?latitude=mylat&longitude=mylng&spanLat=0.003&spanLng=0.02\";\n\n\tif (device == \"computer\"){\n\t\tvar linkTarget = 'target=\"_blank\"';\n\t} else {\n\t\tvar linkTarget = 'target=\"_self\"';\n\t}\n\n\tpsurl = psurl.replace(\"mylat\",location.lat);\n\tpsurl = psurl.replace(\"mylng\",location.lng);\n\n\tvar content = \n\t'<div class = \"infowindow\">';\n\n\tif (location.provider === \"Ecotricity\" || location.provider === \"CYC\"){\n\t\t\t\t//content += '<img class=\"history-img\" src=\"img/history.png\" width=\"20px\" height=\"20px\" onclick=\"openWindow.getHistoryInfoWindow.show()\"/>';\n\t}\n\n\tcontent+= '<div class=\"w3-content w3-border w3-border-white infowindow-content\">';\n\t\n\tcontent += '<h5 style=\"min-width:300px;\">'+ location.name +' (' + location.provider + ')</h5>';\n\n\tif (location.postcode !== undefined && location.postcode !== null && location.postcode !== \"\") {\n\t\t//content+= '<span><a href=\"' + getGoogleMapsUrl(location.postcode) + '\" ' + linkTarget + '>' + location.postcode + '</a></span>';\n\t} else {\n\t\t//content+= '</h5>';\n\t}\n\n\t\n\n\tfor (var i = 0; i < location.connectors.length; i++) {\n\t\t\n\t\tif (location.connectors[i].isDual === true){\n\t\t\tvar dual = true;\n\t\t}\n\n\t\tif (location.connectors[i].status == \"unknown\") {\n\t\t\tstatus = 'unknown';\n\t\t\tstyleHTML = ' style=\"color: black\" ';\n\t\t} else if (location.connectors[i].status == \"planned\") {\n\t\t\tstatus = 'planned';\n\t\t\tstyleHTML = ' style=\"color: #2291ff\" ';\n\t\t} else if (location.connectors[i].status == \"offline\") {\n\t\t\tstatus = 'offline';\n\t\t\tstyleHTML = ' style=\"color: red\" ';\n\t\t} else if (location.connectors[i].status == \"occupied\") {\n\t\t\tstatus = 'occupied';\n\t\t\tstyleHTML = ' style=\"color: #2291ff\" ';\n\t\t} else if (location.connectors[i].status == \"in session\") {\n\t\t\tstatus = 'in session';\n\t\t\tstyleHTML = ' style=\"color: #2291ff\" ';\n\t\t} else {\n\t\t\tstatus = 'online';\n\t\t\tstyleHTML = ' style=\"color: green\" ';\n\t\t}\n\n\t\tvar pwrstr = location.connectors[i].power + \" kW\";\n\n\t\tif (location.connectors[i].socket == undefined){\n\t\t\tif (location.connectors[i].quantity !== undefined){\n\t\t\t\tvar connstr = location.connectors[i].type.title + ': ' + location.connectors[i].quantity;\n\t\t\t} else {\n\t\t\t\tvar connstr = location.connectors[i].type.title;\n\t\t\t}\n\t\t} else {\n\t\t\tvar connstr = location.connectors[i].socket;\n\t\t}\n\n\t\tif (location.connectors[i].isDual === true){\n\t\t\t//status+= '*'\n\t\t} else {\n\t\t\n\t\t}\n\t\t\n\n\t\tcontent += '<div class=\"w3-row\">'+\n\t\t\t\t\t\t '<div class=\"w3-col s5 w3-left-align\"><i class=\"fa fa-fw fa-plug\"></i><p style=\"display:inline-block;\">' + connstr + '</p></div>' +\n\t\t                 '<div class=\"w3-col s4 w3-center\"><i class=\"fa fa-fw fa-bolt\"></i><p style=\"display:inline-block;\">' + pwrstr +   '</p></div>' + \n\t\t                 '<div class=\"w3-col s3 w3-center\"><p style=\"display:inline-block;\"> ' + '<span ' + styleHTML + '>' + status + '</span></p></div>' + \n\t\t          '</div>';\n\t\t\n\t}\n\n\tif (location.provider === \"Ecotricity\" && !location.isBeta){\n\t\tcontent += '<div class=\"w3-col s12 w3-padding-top w3-left-align w3-text-red\"><p>Ecotricity status no longer live. Please check their app.</p></div>';\t\n\t} else if (location.provider === \"Ecotricity\" && location.isBeta) {\n\n\t\tvar lastUpdateTime = moment(location.lastHeartbeat);\n\t\t\t\t\t\n\t\t//var lastUpdateTime = lastUpdateTime.getHours() + \":\" + lastUpdateTime.getMinutes() + \" on \" + lastUpdateTime.getDate() + \" \" + getActualMonth(lastUpdateTime.getMonth());\n\n\t\tcontent += '<div class=\"w3-col s12 w3-padding-top w3-left-align\"><i class=\"fa fa-fw fa-heartbeat\"></i><p>'+lastUpdateTime.calendar()+'</p></div>';\n\t} else {\n\n\t}\n\t\n\n\t//add source\n\n\tcontent += '<div class=\"w3-right-align w3-padding-bottom\"><span class=\"\">Data source:</span> <span class=\"\"><a href=\"'+location.source.url+'\" target=\"_blank\">'+location.source.name+'</a></spanLng></div>';\n\t\n\tcontent += '</div>';\n\t\n\t//'<table>'+\n\tcontent +='<div class=\"w3-btn-bar\">'+\n\t'<a class=\"w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white\" href=\"'+psurl+'\" ' + linkTarget + '>Plugshare</a>'+\n\t'<span class=\"w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white\" onclick=\"activeMarker.routeOptions()\">Route</span>' +\n\t'<span class=\"w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white history-button\" onclick=\"openWindow.getHistoryInfoWindow.toggle()\">History</span>'+\n\t'</div>';\n\t\n\t//'<span class=\"w3-btn w3-col s4 w3-border-white\" onclick=\"openWindow.getRssInfoWindow()\">RSS</span>'+\n\t//'</div>';\n\t\n\t//'<a href=\"http://maps.google.com/?saddr=Current%20Location&daddr='+lat+','+lng+'\">Get me there!</a>'+\n\t\n\t\n\n\treturn content;\n}\n\n//\n// Data management functions\n//\n\nfunction updateProviderCheckmarks(){\n\t$(\".networks span\").each(function(index,element){\n\t\tif ( providerreq.providers.indexOf($(element).attr(\"data-value\")) >=0){\n\t\t\t$(element).children(\"i\").fadeTo(50,1)\n\t\t} else {\n\t\t\t$(element).children(\"i\").fadeTo(50,0)\n\t\t}\n\t});\n\n}\n\nvar providersController = function(){\n\n\tvar timeout;\n\tvar selectedProviders = [];\n\n\tfunction upgradeHandler(){\n\t\tif (!localStorage.selectedProviders && localStorage.networks) {\n\t\t\tvar oldNetworks = JSON.parse(localStorage.networks);\n\t\t\toldNetworks.providers.forEach(function(value,index){\n\t\t\t\tif (value) {\n\t\t\t\t\tselectedProviders.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\tlocalStorage.selectedProviders = JSON.stringify(selectedProviders);\n\t\t}\n\t}\n\n\treturn {\n\t\tupdate: function(startup){\n\t\t\t//normal execution\n\n\t\t\tupgradeHandler();\n\n\t\t\tmapMask.show({\n\t\t\t\ttype: \"markerLoad\",\n\t\t\t\tshowAnimation: true\n\t\t\t});\n\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (startup === undefined){\n\n\t\t\t\tselectedProviders = [];\n\n\t\t\t\t$(\".network-selected\").each(function(){\n\t\t\t\t\tselectedProviders.push($(this).data(\"value\"));\n\t\t\t\t});\n\n\t\t\t\tif(storagePossible) {\n\t\t\t    \tlocalStorage.selectedProviders = JSON.stringify(selectedProviders);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t//first execution\n\n\t\t\t\tif (storagePossible && (localStorage.selectedProviders !== undefined)){\n\t\t\t\t\tselectedProviders = JSON.parse(localStorage.selectedProviders);\n\t\t\t\t} \n\n\t\t\t\t$(\".networks span\").each(function(){\n\t\t\t\t\tif (selectedProviders.indexOf($(this).data(\"value\")) >= 0) {\n\t\t\t\t\t\t$(this).addClass(\"network-selected\");\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (storagePossible) {\n\t\t\t\t\t//load from the cache whilst we wait for new data\n\t\t\t    \tif (localStorage.data !== undefined){\n\t\t\t    \t\t//loadStatusData(localStorage.data);\n\t\t\t    \t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttimeout = setTimeout(function(){\n\t\t\t\tajaxHandler({\n\t\t\t\t\turl: \"php/status_data.php\",\n\t\t\t\t\tdata: {providers: selectedProviders},\n\t\t\t\t\tsuccess: loadStatusData\n\t\t\t\t});\n\t\t\t\t//submitJSONToServer(\"php/status_data.php\",JSON.stringify({providers: selectedProviders}),loadStatusData);\n\t\t\t},750);\n\n\t\t},\n\t\tselectAll: function(){\n\t\t\t$(\".networks span\").each(function(index,element){\n\t\t\t\t$(this).addClass(\"network-selected\");\n\t\t\t\tprovidersController.update();\n\t\t\t});\n\t\t},\n\t\trefresh: function(){\n\t\t\tprovidersController.update();\n\t\t}\n\t};    \n\n\n}();\n\n\nfunction loadStatusData(response) {\n\n\t//do we have a map to add markers?\n\tif (typeof(map) != 'object' || (typeof(map) == 'object' && !map.zoom)) {\n\t\t//No, so return (mask will prompt reload)\n\t\treturn;\n\t}\n\n\tvar co = response;\n\tvar skipMarkerRefresh = false;\n\n\t//Is the data we have populated already the same as what we've received? If so, end. TODO\n\n\t// if (storagePossible && localStorage.data) {\n\t// \tvar oldData = JSON.parse(localStorage.data);\n\t// \tif (oldData.last_updated === co.last_updated && oldData.locations.length == co.locations.length) {\n\t// \t\tskipMarkerRefresh = true;\n\t// \t}\n\t// }\n\n\tif (!skipMarkerRefresh || firstRun){\n\n\t\t$(\"#updated\").html('Updated: ' + co.last_updated);\n\n\t\tfirstRun = false;\n\n\t\tif (storagePossible){\n\n\t\t\tlocalStorage.data = JSON.stringify(response);\n\t\t}\n\n\t\tfirstRun = false;\n\n\t\tif (allmarkers.length > 0){\n\t\t\tfor (var i = 0; i < allmarkers.length; i++) {\n\t\t\t\tallmarkers[i].setMap(null);\n\t\t\t}\n\t\t\tallmarkers = [];\n\t\t}\n\n\t\tvar closeproximity_A = false;\n\t\tvar closeproximity_B = false;\n\t\tvar radius = 0;\n\n\t\tfor (var i = 0; i < co.locations.length; i++) {\n\n\t\t\tcloseproximity_A = false;\n\t\t\tcloseproximity_B = false;\n\n\t\t\tif (co.locations[i].provider == \"Ecotricity\"){\n\t\t\t\tradius = 0.2;\n\t\t\t} else if (co.locations[i].provider == \"Polar\"){\n\t\t\t\tradius = 0.1;\n\t\t\t} else {\n\t\t\t\tradius = 0.5;\n\t\t\t}\n\n\t\t\tfor (var y = 0; y < co.locations.length; y++) {\n\t\t\t\t\n\t\t\t\tif (i != y) {\n\t\t\t\t\tif (calcCordDistance(co.locations[i].lat,co.locations[i].lng,co.locations[y].lat,co.locations[y].lng) < radius) {\n\t\t\t\t\t\tif (i < y) {\n\t\t\t\t\t\t\tcloseproximity_A = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcloseproximity_B = true;\n\t\t\t\t\t\t}\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (closeproximity_A) {\n\t\t\t\taddMarker(co.locations[i],\"left\");\t\n\t\t\t} else if (closeproximity_B) {\n\t\t\t\taddMarker(co.locations[i],\"right\");\t\n\t\t\t} else {\n\t\t\t\taddMarker(co.locations[i],\"mid\");\n\t\t\t}\n\t\t\t\n\t\t}\n\n\t\tshowMarkers();\n\n\t\tif (urlParamsController.getParams()['src'] == \"evhw\"){\n\t\t\ttweetLinkInfoWindow(urlParamsController.getParams()[\"lat\"],urlParamsController.getParams()[\"lng\"]);\n\t\t}\n\n\t\tsetTimeout(function(){\n\t\t\t$(document).trigger(\"markersAdded\");\n\t\t},750);\n    \t\t\t\n\t}\n\n\tmapMask.hide();\n}\n\n//\n// Cookies and other goodies\n//\n\nfunction addCookie (cname, cvalue, dexp) {\n\tvar d = new Date();\n    d.setTime(d.getTime() + (dexp*24*60*60*1000));\n    var expires = \"expires=\"+d.toUTCString();\n\tdocument.cookie = cname + \"=\" + cvalue + \"; \" +  expires;\n}\n\nfunction getCookie(cname) {\n    var name = cname + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i=0; i<ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0)==' ') c = c.substring(1);\n        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);\n    }\n    return \"\";\n}\n\nvar urlParamsController = function(){\n\tvar getParameters = {};\n\tvar hashParameters = {};\n\tvar parts;\n\treturn {\n\t\tfetch: function(){\n\t\t\tparts = window.location.search.substr(1).split(\"&\");\n\t\t\tfor (var i = 0; i < parts.length; i++) {\n\t\t    \tvar temp = parts[i].split(\"=\");\n\t\t    \tgetParameters[decodeURIComponent(temp[0])] = decodeURIComponent(temp[1]);\n\t\t\t}\n\t\t\tparts = window.location.hash.substr(1).split(\"&\");\n\t\t\tfor (var i = 0; i < parts.length; i++) {\n\t\t    \tvar temp = parts[i].split(\"=\");\n\t\t    \thashParameters[decodeURIComponent(temp[0])] = decodeURIComponent(temp[1]);\n\t\t\t}\n\t\t},\n\t\tgetParams: function(){\n\t\t\treturn getParameters;\n\t\t},\n\t\thashParams: function(){\n\t\t\treturn hashParameters;\n\t\t}\n\t};\t\n}();\n\nfunction updateUrl(o){\n\tvar center = map.getCenter();\n\tvar lat = center.lat().toFixed(5);\n\tvar lng = center.lng().toFixed(5);\n\tvar z = map.getZoom();\n\tvar path = window.location.pathname;\n\thistory.replaceState(history.state,window.document.title,\"/?lat=\"+lat+\"&lng=\"+lng+\"&z=\"+z);\n\n\tif (o !== undefined){\n\t\thistory.replaceState(history.state,window.document.title,\"/?lat=\"+lat+\"&lng=\"+lng+\"&z=\"+z +\"&login=true\");\n\t}\n}\n\nfunction gradient(d,a){\n\treturn a/d;\n}\n\n//\n// RSS Functions\n//\n\nfunction rssCheckChargerPresent(info, connector){\n\tfor (var i = 0; i < c.targetChargers.length; i++) {\n\t\tif (info.provider == c.targetChargers[i].provider && info.lat == c.targetChargers[i].lat &&\n\t\t\tinfo.lng == c.targetChargers[i].lng && info.connectors[connector].type.title == c.targetChargers[i].type ) {\n\t\t\treturn true;\n\t\t} \n\t}\n\treturn false;\n}\n\nfunction rssAddRemove(connector){\n\tdocument.getElementsByClassName(\"rssgen\")[0].style.display = \"inline-block\";\n\tdocument.getElementById(\"rssgen-text\").setAttribute(\"onclick\", \"requestUrl()\");\n\tdocument.getElementById(\"rssgen-text\").style.cursor = \"pointer\";\n\n\tvar newentry = true;\n\n\tvar cInfo = {\n\t\tname: activeMarker.info.name,\n\t\tprovider: activeMarker.info.provider,\n\t\tlat: activeMarker.info.lat,\n\t\tlng: activeMarker.info.lng,\n\t\ttype: activeMarker.info.connectors[connector].type.title,\n\t\tstatus: \"new\"\n\t};\n\n\tif (c.targetChargers.length > 0){\n\t\tfor (var i = 0; i < c.targetChargers.length && newentry; i++) {\n\t\t\tif (cInfo.provider == c.targetChargers[i].provider && cInfo.lat == c.targetChargers[i].lat &&\n\t\t\t\tcInfo.lng == c.targetChargers[i].lng && cInfo.type == c.targetChargers[i].type ) {\n\t\t\t\tdocument.getElementsByClassName(\"rss_cmd\")[connector].innerHTML = \"Add\";\n\t\t\t\tc.targetChargers.splice(i,1);\n\t\t\t\tdocument.getElementById(\"rssgen-text\").innerHTML = \"Click to generate RSS feed URL. You've added \" + c.targetChargers.length + \" station(s) so far.\";\n\t\t\t\tif (c.targetChargers.length == 0){\n\t\t\t\t\trssClear();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t};\n\t\t}\n\t\tc.targetChargers.push(cInfo);\n\t\tdocument.getElementsByClassName(\"rss_cmd\")[connector].innerHTML = \"Remove\";\n\t\t\n\t} else {\n\t\tc.targetChargers.push(cInfo);\n\t\tdocument.getElementsByClassName(\"rss_cmd\")[connector].innerHTML = \"Remove\";\n\t}\n\n\tdocument.getElementById(\"rssgen-text\").innerHTML = \"Click to generate RSS feed URL. You've added \" + c.targetChargers.length + \" station(s) so far.\";\n\t\n}\n\nfunction requestUrl(){\n\tsubmitJSONToServer(\"php/rss_process.php\",\n\t\t\t\t\t\tJSON.stringify(c),\n\t\t\t\t\t\tprocessRssServerResponse\n\t);\n}\n\nfunction rssClear(){\n\tc.targetChargers = [];\n\t// rsstargets = [];\n\tdocument.getElementById(\"rss-response\").style.display = \"none\";\n\t//document.getElementsByClassName(\"rssgen\")[0].style.left = \"calc(50% - \" + (document.getElementsByClassName(\"rssgen\")[0].offsetWidth)/2 + \"px)\";\n\tdocument.getElementsByClassName(\"rssgen\")[0].style.display = \"none\";\n\tdocument.getElementById(\"rss-response\").value = \"\";\n\tdocument.getElementById(\"rssgen-text\").setAttribute(\"onclick\", \"requestUrl()\");\n\tdocument.getElementById(\"rssgen-text\").style.cursor = \"pointer\";\n\tdocument.getElementsByClassName(\"rssgen\")[0].style.top = \"85%\";\n\n}\n\nfunction initalGetRequest(){\n\tvar xhttp = new XMLHttpRequest();\n\tvar url;\n\tif (isCordovaApp) {\n\t\turl = \"https://evhighwaystatus.co.uk/php/heat_me_up.php\";\n\t} else {\n\t\turl = \"php/heat_me_up.php\"\n\t}\n\t xhttp.onreadystatechange = function() { \n        if (xhttp.readyState == 4 && xhttp.status == 200){\n  \t\t//nothing to see here\n  \t\t}\n    }\n    xhttp.open(\"GET\",url,true);\n    xhttp.send();\n}\n\nfunction submitCarwingsAction(){\n\tupdateUrl(true);\n\tif (typeof(ga) != 'undefined') {\n\t\tga('send', 'event', 'Carwings', document.getElementById(\"carwings-options\").value, 'HeatMyLeaf');\n\t}\n\t$(\"#loading\").show();\n\t$(\"#carwings-submit\").prop(\"disabled\",true);\n\t$(\"#carwings-submit\").css({\"opacity\":0});\n\n\tvar ajaxData = 'username='+$(\"#username\").val()+'&password='+$(\"#password\").val()+'&action='+$(\"#carwings-options\").val();\n\n\tajaxHandler({\n\t\turl: \"php/heat_me_up.php\",\n\t\tdata: ajaxData,\n\t\tsuccess: processCarwingsResponse,\n\t\talways: function(){\n\t\t\t$(\"#loading\").hide();\n\t\t\t$(\"#carwings-submit\").prop(\"disabled\",false);\n\t\t\t$(\"#carwings-submit\").css({\"opacity\":1});\n\t\t}\n\t});\n\n\n\t// var xhttp = new XMLHttpRequest();\n\t//  xhttp.onreadystatechange = function() { \n //        if (xhttp.readyState == 4 && xhttp.status == 200)\n //            processCarwingsResponse(xhttp.responseText);\n //    };\n //    xhttp.open(\"POST\",\"https://evhighwaystatus.co.uk/php/heat_me_up.php\",true);\n //    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n //    xhttp.send('username='+document.getElementById(\"username\").value+'&password='+document.getElementById(\"password\").value+'&action='+document.getElementById(\"carwings-options\").value);\n}\n\n\n\n\n\nfunction processCarwingsResponse(response){\n\n\tvar r = response;\n\tvar message = \"\";\n\tvar type = \"\";\n\tvar title = \"\"; \n\n\tswitch(r.status){ \n\n\t\tcase \"login_fail\":\n\t\t\ttitle = \"Login Failed\";\n\t\t\ttype = \"error\";\n\t\t\tmessage = \"Looks like those Carwings credentials aren't valid..\";\n\t\t\tbreak; \n\n\t\tcase \"action_success\":\n\t\t\ttitle = \"Success!\";\n\t\t\ttype = \"success\";\n\n\t\t\tswitch (r.request){\n\t\t\t\tcase \"ac_on\":\n\t\t\t\t\tmessage = \"Hi \" + r.user_id + \"!<br><br>Your LEAF's now warming as we speak..\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ac_off\":\n\t\t\t\t\tmessage = \"Hi \" + r.user_id + \"!<br><br>Your LEAF's AC has been turned off..\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"battery\":\n\t\t\t\t\tmessage = \"Hi \" + r.user_id + \"! Here's your current battery info..<br><br>\";\n\t\t\t\t\tmessage+= \"Range without AC: <b>\" + r.leaf_info.range.ac_off + \"</b> miles<br><br>\";\n\t\t\t\t\tmessage+= \"Range with AC: <b>\" + r.leaf_info.range.ac_on + \"</b> miles<br><br>\";\n\t\t\t\t\tmessage+= \"Bars: <b>\" + r.leaf_info.bars + \"/12</b>\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"start_charge\":\n\t\t\t\t\tmessage = \"Hi \" + r.user_id + \"!<br><br>Your LEAF's charging has now been started..\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t\t\n\t\t\t//heatMeUp();\n\t\t\tbreak;\n\n\t\tcase \"request_timeout\":\n\t\t\ttitle = \"Timeout\";\n\t\t\ttype = \"info\";\n\t\t\tmessage = \"Hi \" + r.user_id + \"!<br><br>The request was issued successfully, but confirmation wasn't received in a timely manor..\";\n\t\t\t//heatMeUp();\n\t\t\tbreak;\t\n\n\t\tcase \"carwings_update_fail\":\n\t\t\ttitle = \"Failed\";\n\t\t\ttype = \"error\";\n\t\t\tmessage = \"Hi \" + r.user_id + \"!<br><br>We logged in OK, but the command failed. Maybe wait and try again.\";\n\t\t\tbreak;\n\t}\n\n\tswal({\n\t\ttitle: title,\n\t\thtml: true,\n\t\ttype: type,\n\t\ttext: message\n\t});\n\n}\n\nvar networkFailure = function() {\n\treturn {\n\t\tshow: function(){\n\t\t\tif (!$(\".network-failure-alert\").length) {\n\t\t\t\t\t$alert = $(\"<div>\",{class: \"w3-container w3-card-8 w3-animate-top w3-red w3-top network-failure-alert\", style: \"z-index:5; position:absolute;\"}).append($(\"<span>\",{class:\"w3-closebtn\"}).append(\"&times;\").click(function(){\n\t\t\t\t\t\t\tthis.parentNode.remove();\n\t\t\t\t\t\t})).append(\"<p>Network connection unavailable</p>\");\n\t\t\t\t\t$(\".wrap\").append($alert);\n\t\t\t\t}\n\t\t\t//mapMask.hide();\n\t\t},\n\t\thide: function(){\n\t\t\t$(\".network-failure-alert\").remove();\n\t\t}\n\t};\n\t\n}();\n\nfunction ajaxHandler(settings) {\n\tvar ajaxUrl;\n\n\tif (isCordovaApp) {\n\t\tajaxUrl = \"https://evhighwaystatus.co.uk/\" + settings.url;\n\t} else {\n\t\tajaxUrl = settings.url;\n\t}\n\n\tif (typeof(settings.data) === 'string') {\n\t\tvar ajaxData = settings.data;\n\t} else {\n\t\tvar ajaxData = JSON.stringify(settings.data);\n\t}\t \n\n\t$.ajax({\n\t\tmethod: 'post',\n\t\turl: ajaxUrl,\n\t\tbeforeSend: function(xhr) {\n\t\t\tif (isCordovaApp) {\n\t\t\t\txhr.setRequestHeader('xAppAuth', '8;iLY3AZ1m7,?[pUKM0!+E7h44;u2W81dWl<(mf85kevN0J-MN^V6P1F47VTE77');\n\t\t\t}\n\t\t\tif (typeof(settings.data) === 'string') {\n\t\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\t}\n\t\t},\n\t\tdata: ajaxData\n\t}).done(function(data,b,c){\n\t\tsettings.success(data);\n\t}).fail(function(a,b,c){\n\t\tnetworkFailure.show();\n\t\tif (settings.fail) {\n\t\t\tsettings.fail();\n\t\t}\n\t}).always(function(a,b,c){\n\t\tif (settings.always) {\n\t\t\tsettings.always();\n\t\t}\n\t});\n}\n\n\n\nfunction processRssServerResponse(response){\n\tif (response.length < 60) {\n\t\tvar boxContent = response;\n\t} else {\n\t\tvar boxContent = \"Sorry, something went wrong.\";\n\t}\n\n\tdocument.getElementById(\"rss-response\").value = boxContent;\n\tdocument.getElementById(\"rss-response\").style.display = \"block\";\n\t//document.getElementsByClassName(\"rssgen\")[0].style.left = \"calc(50% - \" + (document.getElementsByClassName(\"rssgen\")[0].offsetWidth)/2 + \"px)\";\n\tdocument.getElementById(\"rssgen-text\").innerHTML = \"Here's your unique RSS URL:\";\n\tdocument.getElementById(\"rssgen-text\").setAttribute(\"onclick\", \"\");\n\tdocument.getElementById(\"rssgen-text\").style.cursor = \"default\";\n\tdocument.getElementsByClassName(\"rssgen\")[0].style.top = \"45%\";\n\t\n}\n// Popup\nfunction cookieMessage(){\n\n\t$alert = $(\"<div>\",{class: \"w3-container w3-light-grey w3-bottom w3-card-8\", style: \"z-index:5;\"}).append($(\"<span>\",{class:\"w3-closebtn\"}).append(\"&times;\").click(function(){\n\t\tthis.parentNode.style.display = \"none\";\n\t\taddCookie(\"cookies\",true,365);\n\t})).append(\"<p>Just so you know, we use cookies to enhance your browsing experience and provide website statistics.</p>\");\n\n\t$(\".wrap\").append($alert);\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\n}\n\nvar bearing = function(){\n\t\n\treturn {\n\t\tminusDegrees: function (bearing,degrees){\n\t\t\tvar a = bearing;\n\t\t\tfor (var i = 0; i < degrees; i++) {\n\t\t\t\ta-= 1;\n\t\t\t\tif (a <= -1){\n\t\t\t\t\ta = 359;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn a;\n\t\t},\n\t\taddDegrees: function (bearing, degrees){\n\t\t\tvar a = bearing;\n\t\t\tfor (var i = 0; i < degrees; i++) {\n\t\t\t\ta+= 1;\n\t\t\t\tif (a >= 360){\n\t\t\t\t\ta = 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn a;\n\t\t},\n\t\tantiClockwiseDegrees: function(bearing,target){\n\t\t\tvar a = bearing;\n\t\t\tvar delta = 0;\n\n\t\t\twhile (Math.abs(a - target) > 1) {\n\t\t\t\ta = this.minusDegrees(a,1);\n\t\t\t\tdelta++;\n\t\t\t}\n\n\t\t\treturn delta;\n\t\t}, \n\t\tsmallestDelta: function(bearing1, bearing2){\n\t\t\tvar a = bearing1;\n\t\t\tvar delta1 = 0;\n\t\t\tvar delta2 = 0;\n\n\t\t\twhile (Math.abs(bearing2 - a) > 1) {\n\t\t\t\ta = this.addDegrees(a,1);\n\t\t\t\tdelta1++;\n\t\t\t}\n\n\t\t\ta = bearing1;\n\n\t\t\twhile (Math.abs(bearing2 - a) > 1) {\n\t\t\t\ta = this.minusDegrees(a,1);\n\t\t\t\tdelta2++;\n\t\t\t}\n\n\t\t\tif (delta1 < delta2) {\n\t\t\t\treturn delta1;\n\t\t\t} else {\n\t\t\t\treturn delta2;\n\t\t\t}\n\t\t}\n\t};\n}();\n"]}