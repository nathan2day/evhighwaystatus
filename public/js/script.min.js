var timeOut,allmarkers=[],map,openWindow,activeMarker,directionsDisplay,directionsService,iconListener,altRoutes=0,curRoute=0,GET={},activeRouteInputElement="",locationCircle=null,locationIcon=null,connectors=[],providerreq={providers:[]},openRssWindow,c={},route={start:"",end:"",path:[],consumption:{total:{baseline:0,adjusted:0},waypoints:[]},clear:function(){this.end=this.start="";this.path=[];this.consumption={total:{baseline:0,adjusted:0},waypoints:[]};this.waypoints=[]},waypoints:[]};
c.targetChargers=[];
var firstRun=!0,heatmeupopen=!1,showingElevationInfo=!1,showingRouteSettings=!1,elevation,chart,elevResults=[],elevData,altInfoWindow,geocoder,storagePossible="undefined"!==typeof Storage?!0:!1,userController=function(){function a(a){g.getProfile(a,function(f,p){if(f)b(),g.show();else{providersController.update(!0);h=!0;localStorage.id_token=a;localStorage.userProfile=JSON.stringify(p);var x=p.user_metadata.firstName?p.user_metadata.firstName+" "+p.user_metadata.lastName:p.name;$(".username").html(x);
$(".logout").html("Logout");-1==p.picture.indexOf("cdn.auth0.com")&&$(".menu-icon-container").html('<img class="avatar" src="'+p.picture+'"></img>').addClass("profile-picture");p.email_verified?$(".username").html(x):($(".username").html(x+" (provisional)"),$(".username").css({color:"red"}),swal({title:"Welcome!",text:"Registration's complete. To unlock full functionality please verify your email address by following the link in the registration email.",type:"success",showConfirmButton:!0,confirmButtonText:""}));
updateUrl();d(a)}})}function b(){localStorage.id_token="";localStorage.userProfile="";$(".username").html("Guest");$(".logout").html("Login");$(".menu-icon-container").html('<i class="fa fa-car menu-icon"></i>').removeClass("profile-picture");h=!1}function d(a){f.renewIdToken(a,function(a,b){a||(localStorage.id_token=b.id_token)})}var g,f,h=!1;return{init:function(){g=new Auth0Lock("2ZONj7AJBZPWqTAb1UrhWq8d4qZj7xwN","evhighwaystatus.eu.auth0.com",{theme:{logo:"https://evhighwaystatus.co.uk/img/Icon-App-60x60@3x.png",
primaryColor:"white"},languageDictionary:{title:"Welcome!"},closable:!0,auth:{redirect:!0,responseType:"token"},additionalSignUpFields:[{name:"firstName",placeholder:"First name",validator:function(a){return{valid:1<a.length,hint:"Please enter your first name"}},icon:"https://evhighwaystatus.co.uk/img/user-shape.png"},{name:"lastName",placeholder:"Last name",validator:function(a){return{valid:1<a.length,hint:"Please enter your last name"}},icon:"https://evhighwaystatus.co.uk/img/user-shape.png"}]});
g.on("authenticated",function(b){a(b.idToken)});g.on("authorization_error",function(a){b()});f=new Auth0({domain:"evhighwaystatus.eu.auth0.com",clientID:"2ZONj7AJBZPWqTAb1UrhWq8d4qZj7xwN",callbackURL:"https://evhighwaystatus.co.uk",responseType:"token"});urlParamsController.hashParams().id_token||localStorage.id_token&&10<localStorage.id_token.length&&a(localStorage.id_token)},toggleLoginStatus:function(){if(localStorage.id_token){var a=JSON.parse(localStorage.userProfile);b();window.location.assign("https://evhighwaystatus.eu.auth0.com/v2/logout?returnTo=https://evhighwaystatus.co.uk&client_id="+
a.clientID)}else g.show()},isLoggedIn:function(){return h}}}(),testAuthHeaders=function(){return{go:function(){$.ajax({url:"https://evhighwaystatus.co.uk/php/secured/authentication.php",method:"POST",crossDomain:!0,beforeSend:function(a){a.setRequestHeader("X-Authorization","Bearer "+localStorage.id_token)}}).done(function(a,b,d){}).always(function(a,b,d){})}}}(),switchRoute=function(){return function(){var a=[];$(".routeinput").each(function(){a.push(this.value)});a.reverse();$(".routeinput").each(function(b){this.value=
a[b]});calcRoute()}}(),navMenu=function(){var a;return{initMobile:function(){for(var a=document.getElementsByClassName("dropbtn"),d=0;d<a.length;d++)a[d].addEventListener("mousedown",navMenu.showDropdown);a=document.getElementsByClassName("dropdown-content");for(d=0;d<a.length;d++);},initDesktop:function(){},showDropdown:function(b){for(var d=document.getElementsByClassName("dropbtn"),g=document.getElementsByClassName("dropdown-content"),f=0;f<g.length;f++)d[f]===b.srcElement?a==f?(g[f].style.display=
"none",a=null):(g[f].style.display="block",a=f):g[f].style.display="none"},hideDropdowns:function(){for(var b=document.getElementsByClassName("dropdown-content"),d=0;d<b.length;d++)b[d].style.display="none",b[d].style.display="";a=null}}}();function routeData(){showingRouteSettings?(document.getElementById("vehicle-energy-data").style.top="-550px",showingRouteSettings=!1):(document.getElementById("vehicle-energy-data").style.top="50px",showingRouteSettings=!0)}
function tweetLinkInfoWindow(a,b){for(var d=0;d<allmarkers.length;d++)allmarkers[d].info.lat==parseFloat(a)&&allmarkers[d].info.lng==parseFloat(b)&&(activeMarker=allmarkers[d],activeMarker.showInfoWindow())}function toggleElevation(){showingElevationInfo?(document.getElementById("waypoints-elevation").style.display="none",showingElevationInfo=!1):(document.getElementById("waypoints-elevation").style.display="block",showingElevationInfo=!0)}
var toggleWaypoints=function(){var a=!0,b=0;return{isActive:function(){return a},toggle:function(){a=!a;navMenu.hideDropdowns();b=$("#route-overview").width()+Number($("#route-overview").css("margin-left").replace("px",""))+$(".myroute-tab").width();a?($("#route-overview").css({left:-1*b}),$(".tab-triangle").removeClass("fa-chevron-left").addClass("fa-chevron-right"),""==document.getElementById("routestart").value?route.start="Not yet added.":route.start=document.getElementById("routestart").value,
""==document.getElementById("routeend").value?route.end="Not yet added.":route.end=document.getElementById("routeend").value):($("#route-overview").css({left:0}),$(".tab-triangle").removeClass("fa-chevron-right").addClass("fa-chevron-left"))}}}();function setConnectorCheckmark(a){for(var b=document.getElementsByClassName("checkmark_con"),d=0;d<b.length;d++)b[d].style.visibility=d==a?"visible":"hidden"}
function heatMeUp(){heatmeupopen?(document.getElementsByClassName("carwings-login")[0].style.top="-550px",document.getElementById("loading").style.display="none",heatmeupopen=!1):(document.getElementsByClassName("carwings-login")[0].style.top="50px",heatmeupopen=!0);navMenu.hideDropdowns()}function toggleBubble(a){a?document.getElementsByClassName("bubble")[0].style.display="inline-block":document.getElementsByClassName("bubble")[0].style.display="none"}
var routeInputs=function(){var a=!1;return{show:function(){a||(document.getElementById("clear-route").style.display="block",document.getElementById("route-overview").style.display="block",navMenu.hideDropdowns(),a=!0)},hide:function(){document.getElementById("clear-route").style.display="none";document.getElementById("route-overview").style.display="none";a=!1},isActive:function(){return a}}}();
function closeNavMenus(){for(var a=document.getElementsByClassName("dropdown-content"),b=0;b<a.length;b++)a[b].style.display="none",a[b].style.display=""}var isCordovaApp;(isCordovaApp=-1<document.URL.indexOf("localhost")?!0:-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://"))?document.addEventListener("deviceready",function(){initialise()},!1):$(document).ready(initialise);
function initFacebook(){window.fbAsyncInit=function(){FB.init({appId:"260883924295945",xfbml:!0,version:"v2.7"})};(function(a,b,d){var g=a.getElementsByTagName(b)[0];a.getElementById(d)||(a=a.createElement(b),a.id=d,a.src="//connect.facebook.net/en_US/sdk.js",g.parentNode.insertBefore(a,g))})(document,"script","facebook-jssdk")}
function initialise(){urlParamsController.fetch();isCordovaApp&&$("#menu").addClass("cordova-app");$(document).on("markersAdded",function(){mapMask.hide();document.getElementById("icons").style.visibility="visible";document.getElementById("updated").style.visibility="visible"});$(document).on("mapFirstInit",function(){setTimeout(userController.init,1E3);providersController.update(!0)});initFacebook();initalGetRequest();document.addEventListener("resume",function(){setTimeout(providersController.update,
50)},!1);setUp();vehicleController.init();$("#menu").mmenu({extensions:["pageshadow"]},{offCanvas:{pageSelector:"#page"}});isCordovaApp&&new FastClick(document.body,{excludeNode:"^pac-"});var a=$("#menu").data("mmenu");$(".hamburger").click(function(){$("#menu").hasClass("mm-opened")?a.close():a.open();$(this).blur()});a.bind("opening",function(){$(".hamburger").addClass("is-active")});a.bind("closing",function(){$(".hamburger").removeClass("is-active");setupWizard.stopProgress()});isCordovaApp&&
($(".hamburger").addClass("cordova-app"),navigator.splashscreen.hide());$(".hamburger").css({top:0});$("#routeplanner").click(function(){a.close();setTimeout(function(){toggleWaypoints.toggle()},410)});$("#route-settings").click(function(){a.close();setTimeout(function(){$("#vehicle-energy-data").show()},410)});$("#wizard").click(function(){a.close();setTimeout(function(){a.openPanel($("#mm-0"));setupWizard.firstVisit()},410)});$("#heatmyleaf").click(function(){a.close();setTimeout(function(){$(".carwings-login").show()},
410)});$("#about").click(function(){a.close();setTimeout(function(){$("#about-menu").show()},410)});$("#showlocation").click(function(){a.close();setTimeout(function(){locationController.toggleWatch(!0)},410)});$(".models span").click(function(a){$(".models span > i").fadeTo(50,0);$(this).children("i").fadeTo(50,1);a=Number($(this).attr("value"));var d=$($(this).parents(".models")).find("span"),d=$(d).index(this);vehicleController.setVehicle(a,d);setupWizard.stopProgress()});$(".connectors span").click(function(a){connectorsController.update(Number($(this).attr("data-value")))});
$(".networks span").click(function(a){$(this).toggleClass("network-selected");providersController.update()});setupWizard.setAPI(a);$(".vehicle-data-row").blur(function(){vehicleDataController.update()});$(".logout").click(function(){a.close();setTimeout(function(){userController.toggleLoginStatus()},410)});InitialiseMap()}var networkStatusController=function(){var a=!1;return{onlineEvent:function(){a=!0;networkFailure.hide()},offlineEvent:function(){a=!1;networkFailure.show()},isOnline:function(){return a}}}();
function setUp(){function a(a){$("#route-cont").scrollTop(a)}"portable"===device&&navMenu.initMobile();$(window).on("online",function(){networkStatusController.onlineEvent()});$(window).on("offline",function(){networkStatusController.offlineEvent()});vehicleDataController.init();document.getElementById("routestart").addEventListener("focus",function(){activeRouteInputElement="start"});document.getElementById("routestart").addEventListener("blur",function(){setTimeout(function(){"end"!=activeRouteInputElement&&
(activeRouteInputElement="");""==document.getElementById("routestart").value?route.start="Not yet added.":route.start=document.getElementById("routestart").value},100)});document.getElementById("routeend").addEventListener("focus",function(){activeRouteInputElement="end"});"evhw"==urlParamsController.getParams().src?(connectorsController.update(1),connectorsController.update(2),connectorsController.update(3),connectorsController.update(4),connectorsController.update(7)):connectorsController.update("",
!0);"none"==connectors||void 0===localStorage.newIntro?(localStorage.newIntro=!0,setupWizard.firstVisit()):""!=getCookie("beer")||isCordovaApp||(swal({title:"Just a quick one..",text:"You can now buy me a beer from the <b>Support</b> menu if you find this site useful :) <br><br>(This'll close in a second)",html:!0,type:"info",timer:6E3}),addCookie("beer","true",365));$("#about-menu h3").click(function(a){this==a.target&&($("#about-menu .menu-cont").eq($("#about-menu h3").index(this)).slideToggle(),
$("#about-menu .expand-v").eq($("#about-menu h3").index(this)).fadeToggle())});$(".popup-window>i").click(function(a){$(a.target.parentNode).hide()});$(".w3-modal .w3-closebtn").click(function(a){$(a.target).parents(".w3-modal").hide();$("#loading").hide();$("#carwings-submit").prop("disabled",!1);$("#carwings-submit").css({opacity:1})});$(".myroute-title").click(function(){$(".directions-display-cont").slideToggle();$(".myroute-title > .expand-v").fadeToggle()});$(".myroute-tab").click(function(){toggleWaypoints.toggle()});
$("#route-overview").css("left",-1*($("#route-overview").width()+Number($("#route-overview").css("margin-left").replace("px",""))+$(".myroute-tab").width())).show();$(window).on("orientationchange resize",function(){toggleWaypoints.isActive()&&$("#route-overview").css("left",-1*($("#route-overview").width()+Number($("#route-overview").css("margin-left").replace("px",""))+$(".myroute-tab").width()))});$(".about img").click(function(){$(".menu-cont").hide();$(".about").hide();$(".about .expand-v").show()});
$(".mobile-triangle-cont").click(function(){toggleWaypoints.toggle()});$("#planner-close").click(function(){toggleWaypoints.toggle()});elementEventBinder.routeInputClear($(".route-input-clear"));elementEventBinder.routeInputs($(".routeinput"));$(".icon-link").prop("target","_blank").prop("href",function(a){if(0!=a)return 1==a?"https://www.facebook.com/EVHighwayStatus/":2==a?"https://twitter.com/EVHighwayMap":"https://plus.google.com/communities/108139006036148477833"});$(".location-arrow").click(function(a){locationController.toggleWatch(!0)});
$(".vehicle-data-row").blur(function(){vehicleDataController.update()});$(".temperature-value").blur(function(){vehicleDataController.update()});$(".vehicle-unit").click(function(){this.checked&&vehicleDataController.setUnit(parseFloat(this.value))});$(".route-overview-title").click(function(){for(var b=$("#route-cont").scrollTop(),d=0;0<b;)setTimeout(a,d,b-1),b--,b--,d++});$("#reset-vehicle-data").click(function(){vehicleDataController.reset()})}
var elementEventBinder=function(){return{routeInputs:function(a){$(a).blur(function(){setTimeout(function(){var a=!0;$(".routeinput").each(function(){this.value||(a=!1)});a&&calcRoute()},100)})},routeInputClear:function(a){$(a).click(function(){$(".routeinput").eq($(".route-input-clear").index(this)).val("")})}}}(),setupWizard=function(){var a=!1,b=!1,d=!1,g=!1,f;return{firstVisit:function(){a=!0;swal({title:"Welcome!",text:"A warm welcome to you - this is our Setup Wizard. Would you like help setting up a few parameters?",
type:"info",showConfirmButton:!0,showCancelButton:!0,closeOnConfirm:!1,closeOnCancel:!1,confirmButtonText:"Sure!",cancelButtonText:"Skip"},function(b){b?swal({title:"Setup",text:"To allow us to set the right EV connector and battery capacity for route planning purposes, please select your vehicle.",type:"info",showCancelButton:!0,showConfirmButton:!0,closeOnCancel:!1,confirmButtonText:"Choose",cancelButtonText:"Skip"},function(b){b?(f.open(),setTimeout(function(){f.openPanel($("#mm-3"))},500),d=!0):
(a=!1,swal({title:"Enjoy..",text:"No problem - you can find all our settings in our menu which is accessed via the 'burger' icon in the corner. ",type:"success",showConfirmButton:!0,closeOnConfirm:!1,confirmButtonText:"Okay"},function(){swal.close();""!==getCookie("cookies")||isCordovaApp||cookieMessage();$(document).trigger("showAlerts")}))}):(a=!1,swal({title:"Enjoy..",text:"No problem - you can find all our settings in our menu which is accessed via the 'burger' icon in the corner. ",type:"success",
closeOnConfirm:!1,showConfirmButton:!0,confirmButtonText:"Okay"},function(){swal.close();""!==getCookie("cookies")||isCordovaApp||(cookieMessage(),$(document).trigger("showAlerts"))}))})},postVehicleSelection:function(a){d&&(setTimeout(function(){f.close();setTimeout(function(){f.openPanel($("#mm-0"))},500)},250),d=!1,a=vehicleController.getVehicle(),"Other"!==a.manufacturer?setTimeout(function(){swal({title:"Setup",text:"Okay, we've set your vehicle to the "+a.manufacturer+" "+a.model.modelName+
".\n\nThe "+a.model.modelName+"'s primary connector is the "+getConnectorName(a.model.connectors[0])+" connector. Would you like the map to only display locations with this connector?\n\n(You can change this at any time)",type:"info",showConfirmButton:!0,showCancelButton:!0,closeOnConfirm:!1,closeOnCancel:!1,confirmButtonText:"Yes please",cancelButtonText:"Skip"},function(b){b&&(connectorsController.clear(),connectorsController.update(a.model.connectors[0]));setupWizard.networkSelection()})},750):
setTimeout(function(){swal({title:"Setup",text:"Looks like we don't list your vehicle yet, sorry about that.<br><br>Please specify the battery capacity (kWh, usable) to use for route planning:",type:"input",inputPlaceholder:'for example: "21.5"',html:!0,showConfirmButton:!0,showCancelButton:!1,closeOnConfirm:!1,closeOnCancel:!1,confirmButtonText:"Confirm"},function(a){if(""===a||!(100>=Number(a)&&1<=Number(a)))return swal.showInputError("Please enter a value between 1 and 100"),!1;chargeSuggestionController.setCapacity(1E3*
Number(a));swal({title:"Setup",text:"Great! We've updated the planner to <b>"+Number(a).toFixed(2)+"</b> kWh.<br><br>Next, please choose your vehicle's connector(s), just close the menu when you're done to continue.",type:"success",html:!0,showConfirmButton:!0,showCancelButton:!1,closeOnConfirm:!0,closeOnCancel:!1,confirmButtonText:"Choose"},function(a){f.open();setTimeout(function(){f.openPanel($("#mm-2"));setTimeout(function(){f.openPanel($("#mm-11"))},500)},500);g=!0})})},750))},networkSelection:function(){var d=
$(".networks li").length;swal({title:"Setup",text:"Next up we have the network selection. We currently show rapid status data for "+d+" providers in the UK.\n\nDo you want to show all of them, or choose a specific set?",type:"info",showConfirmButton:!0,showCancelButton:!0,closeOnConfirm:!1,closeOnCancel:!0,confirmButtonText:"All",cancelButtonText:"Choose now"},function(d){d?(providersController.selectAll(),setupWizard.setupComplete(),a=!1):(b=!0,f.open(),setTimeout(function(){f.openPanel($("#mm-2"));
setTimeout(function(){f.openPanel($("#mm-10"))},500)},500))})},postNetworkSelection:function(){setTimeout(function(){f.openPanel($("#mm-0"));setupWizard.setupComplete()},500);b=a=!1},postConnectorSelection:function(){g=!1;f.closeAllPanels();var a="<ul>";connectorsController.getNameArray().forEach(function(b){a+="<li>"+b+"</li>"});a+="</ul>";setTimeout(function(){swal({title:"Setup",text:"Okay, we've set the connector(s) to:<br>"+a,type:"info",html:!0,showConfirmButton:!0,closeOnConfirm:!1,confirmButtonText:"Next"},
function(){setupWizard.networkSelection()})},500)},setupComplete:function(){swal({title:"Complete",text:"You're all set.\n\nGo explore and enjoy our site. We hope you enjoy your stay. If you need any assistance, feel free to get in touch via the 'Support' link in the menu.",type:"success",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"Let's go!"},function(){""!==getCookie("cookies")||isCordovaApp||cookieMessage();$(document).trigger("showAlerts")})},setAPI:function(a){f=a},stopProgress:function(){a&&
(b?setupWizard.postNetworkSelection():d?setupWizard.postVehicleSelection():g&&setupWizard.postConnectorSelection())}}}();function processRouteDirect(){var a=document.getElementById("routestart").value,b=document.getElementById("routeend").value;""!=a&&""!=b&&calcRoute()}function setConnectorFromCookie(a){a=void 0===a?getConnectorFromCookie():a;if(0!=a)showMarkers(a);else return!1}
function getConnectorFromCookie(a){a=void 0===a?getCookie("connector"):a;return"CCS"==a?(setConnectorCheckmark(0),"CCS"):"CHAdeMO"==a||"CHAdeMO AC"==a?(setConnectorCheckmark(1),"CHAdeMO"):"AC"==a||"AC Medium"==a?(setConnectorCheckmark(2),"AC"):"Tesla"==a?(setConnectorCheckmark(3),"Tesla"):"All"==a?(setConnectorCheckmark(4),"All"):!1}
function calcCordDistance(a,b,d,g){var f=Math.cos;a=.5-f(.017453292519943295*(d-a))/2+f(.017453292519943295*a)*f(.017453292519943295*d)*(1-f(.017453292519943295*(g-b)))/2;return 12742*Math.asin(Math.sqrt(a))}function calcBearing(a,b,d,g){return(180/Math.PI*Math.atan2(Math.sin(Math.PI/180*(g-b))*Math.cos(Math.PI/180*d),Math.cos(Math.PI/180*a)*Math.sin(Math.PI/180*d)-Math.sin(Math.PI/180*a)*Math.cos(Math.PI/180*d)*Math.cos(Math.PI/180*(g-b)))+360)%360}
function getConnectorName(a){return 1==a?"CHAdeMO":2==a?"CCS":3==a?"Rapid AC":7==a?"Tesla":6==a?"AC Medium":""}
var vehicleController=function(){var a={0:{manufacturer:"BMW",models:{0:{modelName:"i3 (60Ah)",battery:{rated:22,usable:18.8},connectors:[2]},1:{modelName:"i3 (94Ah)",battery:{rated:33,usable:27.2},connectors:[2]},2:{modelName:"i3 REx (60Ah)",battery:{rated:22,usable:18.8},connectors:[2]},3:{modelName:"i3 REx (94Ah)",battery:{rated:33,usable:27.2},connectors:[2]}}},1:{manufacturer:"Nissan",models:{0:{modelName:"LEAF (24kWh)",battery:{rated:24,usable:21.3},connectors:[1]},1:{modelName:"LEAF (30kWh)",
battery:{rated:30,usable:28.5},connectors:[1]}}},2:{manufacturer:"Renault",models:{0:{modelName:"Zoe Q210",battery:{rated:26,usable:22},connectors:[3]},1:{modelName:"Zoe R240",battery:{rated:26,usable:23.3},connectors:[3]}}},3:{manufacturer:"Tesla",models:{0:{modelName:"Model S 60",battery:{rated:60,usable:53.4},connectors:[7,3]},1:{modelName:"Model S 70",battery:{rated:70,usable:62.3},connectors:[7,3]},2:{modelName:"Model S 80",battery:{rated:80,usable:71.2},connectors:[7,3]},3:{modelName:"Model S 85",
battery:{rated:85,usable:75.6},connectors:[7,3]},4:{modelName:"Model S 90",battery:{rated:90,usable:80.1},connectors:[7,3]}}},4:{manufacturer:"Volkswagen",models:{0:{modelName:"e-Golf",battery:{rated:24,usable:21.5},connectors:[2]},1:{modelName:"e-Up",battery:{rated:18.7,usable:16.8},connectors:[2]}}},5:{manufacturer:"Other",models:{0:{modelName:"Not listed",battery:{rated:10,usable:10},connectors:[2]}}}},b,d;return{init:function(b){for(b=0;a[b];){for(var d=$("<li>").append($("<span>").html(a[b].manufacturer)),
h=$("<ul>",{"class":"models"}),k=0;a[b].models[k];)$(h).append($("<li>").append($("<span>").html('<i class="fa fa-check fa-fw" aria-hidden="true"></i>'+a[b].models[k].modelName).attr("value",String(b)))),k++;$(d).append(h);$(".manufacturers").append(d);b++}},setVehicle:function(g,f){chargeSuggestionController.setCapacity(1E3*a[g].models[f].battery.usable);$("#route-kwh-capacity").trigger("blur");b=g;d=f},getVehicle:function(){return{manufacturer:a[b].manufacturer,model:a[b].models[d]}}}}();
function AutoCompleteCustom(a){function b(a){var b=map.getCenter(),d=map.getBounds(),d=calcCordDistance(d.getNorthEast().lat(),d.getNorthEast().lng(),d.getSouthWest().lat(),d.getSouthWest().lng())/2;p=$(a).val();w={input:p,location:b.toUrlValue(),radius:1E3*d};ajaxHandler({url:"php/autocomplete.php",data:w,success:f})}function d(b){var d=b.description,f=d.substr(b.matched_substrings[0].offset,b.matched_substrings[0].length),g=d.substr(0,b.matched_substrings[0].offset);b=d.slice(b.matched_substrings[0].offset+
b.matched_substrings[0].length);var h=(g+"<b>"+f+"</b>"+b).split(",");h.forEach(function(a,b){h[b]=a.trim()});f=h[0];1<h.length&&(h=h.splice(1),f=f+"<span>"+h.join(", ")+"</span>");$resultRow=$("<div>",{"class":"autocomplete-row"}).append('<div class="autocomplete-icon"><i class="fa fa-map-marker fa-fw"></i></div><div class="autocomplete-result">'+f+"</div>").click(function(b){$(a).val(k.predictions[$(".autocomplete-row").index(b.delegateTarget)-1].description)});$(a).siblings(".autocomplete-container").append($resultRow)}
function g(){$resultRow=$("<div>",{"class":"autocomplete-row"}).append('<div class="autocomplete-icon"><i class="fa fa-location-arrow fa-fw"></i></div><div class="autocomplete-result">My current location</div>').click(function(b){$(a).parent().append('<i class="fa fa-spinner fa-pulse fa-fw myposition-loading"></i>');locationController.requestLocationNow(function(b){geocodeReverseRequest({lat:b.coords.latitude,lng:b.coords.longitude},function(b){$(a).siblings(".myposition-loading").remove();$(a).val(b[0].formatted_address)})},
function(){$(a).siblings(".myposition-loading").remove()})});$(a).siblings(".autocomplete-container").append($resultRow)}function f(b){k=b;if($(document.activeElement).is(a))for($(a).siblings(".autocomplete-container").remove(),$container=$("<div>",{"class":"autocomplete-container"}),$(a).after($container),g(),b=0;b<k.predictions.length;b++)d(k.predictions[b]);else h()}function h(){$(a).siblings(".autocomplete-container").remove()}var k=[],w={},p="";a=function(a){return"string"===typeof a?$("#"+a):
$.isArray(a)?a[0]:a}(a);$(a).on("paste keydown click",function(){var a;return function(d){"Tab"!=d.key&&("click"===d.type&&$(".autocomplete-container").length?h():(clearTimeout(a),a=setTimeout(b,100,this)))}}());$(a).on("blur",function(a){setTimeout(h,100)})}setTimeout(function(){},5E3);
function InitialiseMap(){urlParamsController.fetch();mapMask.show({type:"mapLoad",showAnimation:!0});new AutoCompleteCustom("routestart");new AutoCompleteCustom("routeend");if("computer"==device)var a=!0,b=!0;else b=a=!1;geocoder=new google.maps.Geocoder;directionsService=new google.maps.DirectionsService;directionsDisplay=new google.maps.DirectionsRenderer({draggable:a,preserveViewport:!1,panel:$(".directions-display")[0]});elevation=new google.maps.ElevationService;directionsDisplay.addListener("routeindex_changed",
function(){var a;return function(){clearTimeout(a);a=setTimeout(processRoute,50)}}());if(0<urlParamsController.getParams().z&&21>urlParamsController.getParams().z)var d=parseFloat(urlParamsController.getParams().z);-12<urlParamsController.getParams().lng&&3>urlParamsController.getParams().lng&&48<urlParamsController.getParams().lat&&60>urlParamsController.getParams().lat?(a="evhw"==urlParamsController.getParams().src?{lat:parseFloat(urlParamsController.getParams().lat)+.02,lng:parseFloat(urlParamsController.getParams().lng)}:
{lat:parseFloat(urlParamsController.getParams().lat),lng:parseFloat(urlParamsController.getParams().lng)},"undefined"==typeof d&&(d=10)):(a={lat:55.1384569,lng:-4.085792},"undefined"==typeof d&&(d=6));b={center:a,zoom:d,zoomControl:b,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("mapbase"),b);google.maps.event.addListener(map,"mousemove",function(){"portable"===device&&navMenu.hideDropdowns()});iconListener=google.maps.event.addListener(map,
"tilesloaded",function(){$(document).trigger("mapFirstInit");google.maps.event.removeListener(iconListener)});google.maps.event.addListener(map,"tilesloaded",function(){return function(){clearTimeout(void 0)}}());google.maps.event.addListener(map,"dragend",function(){updateUrl()});var g=function(){var a;return{show:function(b){a=setTimeout(function(){if(!$('div[class^="infowindow"]').length){var a={lat:b.latLng.lat(),lng:b.latLng.lng()};mapWaypointPopup.setWindowPos(a);geocodeReverseRequest(a,function(a,
b){mapWaypointPopup.updateResponse(processGeocodeResponse(a,b))})}null!=openWindow&&openWindow.close();null!=openRssWindow&&openRssWindow.close();mapWaypointPopup.close();navMenu.hideDropdowns();myLocationPopup.close();showHistoryInfoWindow.close()},300,b)},prevent:function(){clearTimeout(a)}}}();google.maps.event.addListener(map,"click",function(a){g.show(a)});google.maps.event.addListener(map,"dblclick",function(){g.prevent()});void 0!==urlParamsController.getParams().p&&providersController.update(urlParamsController.getParams().p.toLowerCase())}
var mapWaypointPopup=function(){var a,b,d,g,f;return{open:function(){void 0!==a&&(a.close(),a.setMap(null));a=new google.maps.InfoWindow({content:'<div class = "infowindow"><h5 style="width:300px">'+b.title+'</h5><div class="w3-row w3-btn-bar"><span class="w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue" onclick="mapWaypointPopup.setOrigin()">Origin</span><span class="w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue" onclick="mapWaypointPopup.setWaypoint()">Waypoint</span><span class="w3-btn w3-round w3-col s4 w3-border w3-border-white w3-green w3-hover-blue" onclick="mapWaypointPopup.setDestination()">Destination</span></div></div>',
position:d,zIndex:5E3,maxWidth:300,pixelOffset:g,disableAutoPan:!0});a.open(map);g=new google.maps.Size(0,0)},setOrigin:function(){"Set this pin as:"!==b.title?$("#routestart").val(b.title):($("#routestart").val(b.location.lat+", "+b.location.lng),openWindow.close());this.close();$("#routestart").blur()},setWaypoint:function(){f={name:b.title,lat:b.location.lat,lng:b.location.lng};processWaypoints(f);this.close()},setDestination:function(){"Set this pin as:"!==b.title?$("#routeend").val(b.title):
($("#routeend").val(b.location.lat+", "+b.location.lng),openWindow.close());this.close();$("#routestart").blur()},updateResponse:function(a){b=a;this.open()},setWindowPos:function(a){d=a},close:function(){void 0!==a&&(a.close(),a.setMap(null))},setPseudoGeoResp:function(a,d){b={title:a,location:d};g=new google.maps.Size(activeMarker.offset,-95)}}}();function geocodeReverseRequest(a,b){geocoder.geocode({location:a},b)}function geocodeRequest(a,b){geocoder.geocode({address:a},b)}
function processGeocodeResultForWaypoint(a,b){if(b===google.maps.GeocoderStatus.OK){if(a[0]){var d={};d.lat=parseFloat(a[0].geometry.location.lat());d.lng=parseFloat(a[0].geometry.location.lng());d.name=a[0].formatted_address}else d={},d.lat=parseFloat(e.latLng.lat().toFixed(6)),d.lng=parseFloat(e.latLng.lng().toFixed(6)),d.name="Location: "+d.lat+", "+d.lng;processWaypoints(d)}}function processGeocodeResultForStart(a,b){$("#routestart").val(processGeocodeResponse(a,b).title)}
function processGeocodeResultForEnd(a,b){$("#routeend").val(processGeocodeResponse(a,b).title)}function processGeocodeResponse(a,b){if(b===google.maps.GeocoderStatus.OK)return a[0]?{title:a[0].formatted_address,location:{lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng()}}:{title:e.latLng.lat()+", "+e.latLng.lng(),location:e.latLng}}
function oldDataGeneration(){localStorage.vehicleData=JSON.stringify({temp:20,whpm:[200,300,400,500,600,500,800,700,200,500,300]});localStorage.unit="mpkwh"}
var vehicleDataController=function(){function a(){$(".vehicle-data-row").each(function(a,b){0===f.unit?$(b).val(f.efficiencyFigures[f.unit][a].toFixed(0)).prop("step",1):$(b).val(f.efficiencyFigures[f.unit][a].toFixed(2)).prop("step",.01)});$(".temperature-value").each(function(a,b){$(b).val(f.temperature)});$(".vehicle-unit").each(function(a,b){a===f.unit&&(this.checked=!0)})}function b(){localStorage.vehicleData=JSON.stringify(f)}function d(a){var b=[],d=void 0!==a?a:f.unit;for(a=0;a<f.efficiencyFigures.length;a++)d!==
a&&b.push(a);b.forEach(function(a,b){if(0===d){if(1===a)for(var g=0;g<f.efficiencyFigures[d].length;g++)f.efficiencyFigures[a][g]=1E3/f.efficiencyFigures[d][g]}else if(1===d&&0===a)for(g=0;g<f.efficiencyFigures[d].length;g++)f.efficiencyFigures[a][g]=1E3/f.efficiencyFigures[d][g]})}function g(){return[[131,144,159,169,192,217,233,256,278,303,333],[7.63,6.94,6.29,5.92,5.21,4.61,4.29,3.91,3.6,3.3,3]]}var f={temperature:20,efficiencyFigures:[[131,144,159,169,192,217,233,256,278,303,333],[7.63,6.94,6.29,
5.92,5.21,4.61,4.29,3.91,3.6,3.3,3]],unit:0,speeds:[25,30,35,40,45,50,55,60,65,70,75]};return{init:function(){localStorage.vehicleData&&(f=JSON.parse(localStorage.vehicleData));"undefined"===typeof f.unit&&(f.unit=localStorage.unit?"mpkwh"===localStorage.unit?1:0:0);f.efficiencyFigures||(f.efficiencyFigures=g(),f.whpm&&(f.efficiencyFigures[f.unit]=f.whpm,d(f.unit)));!f.temperature&&f.temp&&(f.temperature=f.temp);b();a()},update:function(){$(".vehicle-data-row").each(function(a,b){f.efficiencyFigures[f.unit][a]=
parseFloat($(b).val())});$(".temperature-value").each(function(a,b){f.temperature=parseFloat($(b).val())});d();b()},reset:function(){f.efficiencyFigures=g();f.temperature=20;f.unit=0;b();a()},setUnit:function(d){f.unit=d;b();a()},get:function(){return f}}}(),vehicleConsumpForSpeed=function(){var a=0;return{get:function(b){if(0<a)return a;for(var d=vehicleDataController.get(),g=d.speeds,d=d.efficiencyFigures[0],f=0;f<g.length-1;f++){if(b<g[0])return d[f];if(b>g[g.length-1])return d[g.length-1];if(b>
g[f]&&b<g[f+1]){if(0<=g.indexOf(b)){h=d[g.indexOf(b)];break}var h=d[f]+(b-g[f])/(g[f+1]-g[f])*(d[f+1]-d[f])}if(0<h)break}return h},setOverride:function(b){a=0<b?1E3/b:0}}}();
function processElevationData(a,b){var d=0,g=0,f=0,h=0;if(b===google.maps.ElevationStatus.OK){elevResults=[];a.forEach(function(a){elevResults.push(a)});$(".charts-menu").length||($(".route-options").append($("<div>",{"class":"charts-menu"}).append($("<div>",{"class":"charts-title route-titles"}).text("Charts").append($("<div>",{"class":"expand-h"})).append($("<div>",{"class":"expand-v"})))),$(".charts-menu").append($("<div>",{id:"waypoints-elevation"})),$(".charts-title").click(function(){$("#waypoints-elevation").slideToggle();
$(".route-options .expand-v").eq($(".route-titles").index(this)).fadeToggle()}));elevData=new google.visualization.DataTable;elevData.addColumn("number","Miles");elevData.addColumn("number","Altitude");elevData.addColumn({type:"string",role:"tooltip"});for(var k=0;k<a.length-1;k++)f=a[k+1].elevation-a[k].elevation,0<f?d+=f:g+=Math.abs(f),elevData.addRows([[h,a[k].elevation,Math.ceil(h)+" miles in, "+Math.ceil(a[k].elevation)+" meters"]]),f=calcCordDistance(a[k].location.lat(),a[k].location.lng(),
a[k+1].location.lat(),a[k+1].location.lng()),h+=.621371*f;route.elevation={start:Math.round(a[0].elevation),end:Math.round(a[a.length-1].elevation),ascent:Math.round(d),descent:Math.round(g)};d=route.consumption.total.baseline-g/300*.75+d/300*1.5;g=vehicleDataController.get();g=g.temperature;d=20>=g?d*(1+(20-g)/2*.01):d*(1-(20-g)/4*.01);route.consumption.total.adjusted=d;g={animation:{startup:!0,duration:1E3,easing:"out"},curveType:"function",chartArea:{left:38,top:20,width:$(".charts-menu").width()-
38,height:160},legend:{position:"none"},vAxis:{format:"#m"}};void 0===chart&&(chart=new google.visualization.AreaChart(document.getElementById("waypoints-elevation")),google.visualization.events.addListener(chart,"onmouseover",chartMouseover),google.visualization.events.addListener(chart,"onmouseout",function(){altInfoWindow.close();altInfoWindow=void 0}),google.visualization.events.addListener(chart,"select",chartClick));chart.draw(elevData,g);d="Total ascent: "+route.elevation.ascent+"m,  Total descent: "+
route.elevation.descent+"m<br>est. Power: "+d.toFixed(2)+"kWh.";void 0==document.getElementById("elevation-summary")?(g=document.createElement("p"),g.innerHTML=d,g.style.Text="text-align:center;font-size:12px;padding-bottom:0;",g.id="elevation-summary",document.getElementById("waypoints-elevation"),$("#waypoints-elevation").append(g)):document.getElementById("elevation-summary").innerHTML=d}}
function chartClick(){var a=chart.getSelection();1==a.length&&void 0!==a[0].row&&void 0!==a[0].column&&(a={lat:elevResults[a[0].row].location.lat(),lng:elevResults[a[0].row].location.lng()},map.panTo(a))}
function chartMouseover(a){var b={};b.lat=elevResults[a.row].location.lat();b.lng=elevResults[a.row].location.lng();void 0==altInfoWindow?(altInfoWindow=a=new google.maps.InfoWindow({content:elevData.getValue(a.row,a.column).toFixed(1)+"m",position:b,zIndex:5E3}),google.maps.event.addListener(altInfoWindow,"closeclick",function(){setTimeout(function(){altInfoWindow=void 0},100)}),altInfoWindow.open(map),a=void 0):(altInfoWindow.setPosition(b),altInfoWindow.setContent(elevData.getValue(a.row,a.column).toFixed(1)+
"m"))}
var getGoogleMapsUrl=function(){return function(a){return"https://maps.google.co.uk/maps?saddr=current+location&daddr="+a.replace(" ","+")+"&mode=driving"}}(),locationController=function(){function a(a,b,d){k?(k.setIcon({path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,anchor:new google.maps.Point(0,2.5),scale:5,strokeWeight:1,strokeColor:"#0038ff",fillColor:"#0038ff",fillOpacity:1,rotation:b}),k.setPosition(a)):(k=new google.maps.Marker({position:a,icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,anchor:new google.maps.Point(0,
2.5),scale:5,strokeWeight:1,strokeColor:"#0038ff",fillColor:"#0038ff",fillOpacity:1,rotation:b},map:map}),google.maps.event.addListener(k,"click",function(){var a=k.getPosition();mapWaypointPopup.setWindowPos(a);geocodeReverseRequest(a,function(a,b){mapWaypointPopup.updateResponse(processGeocodeResponse(a,b))})}));h?h.setOptions({center:a,radius:d}):h=new google.maps.Circle({strokeColor:"#4d78ff",strokeOpacity:.6,strokeWeight:3,fillColor:"#4d78ff",fillOpacity:.1,map:map,center:a,radius:d})}function b(b){w=
!0;$("#showlocation").html($("#showlocation").html().replace("Show","Hide"));if(1500<b.timestamp-p||"undefined"===typeof location.lastTimeStamp){p=b.timestamp;var d={lat:b.coords.latitude,lng:b.coords.longitude};2>location.zoomSnapCount&&!x&&(map.setZoom(11),map.panTo(d));location.zoomSnapCount++;var g=isNaN(b.coords.heading)||null===b.coords.heading?0:b.coords.heading;a(d,g,b.coords.accuracy)}}function d(a){var b;switch(a.code){case a.PERMISSION_DENIED:b="It looks like you denied the request. You need to accept this to show your location.";
x=!1;break;case a.POSITION_UNAVAILABLE:x=!1;b="Your location information is currently unavailable.";break;case a.TIMEOUT:if(isCordovaApp){x=!0;locationController.startWatch(!0);return}b="The request to get your location timed out.";break;case a.UNKNOWN_ERROR:b="An unknown error occurred.",x=!1}w=!1;swal({title:"Sorry..",text:b,type:"error"});locationController.clearWatch()}var g,f={enableHighAccuracy:!0,timeout:1E4,maximumAge:0},h,k,w,p,x=!1;return{startWatch:function(a){navigator.geolocation?($(".location-arrow").addClass("oscillate"),
navigator.geolocation.clearWatch(g),location.zoomSnapCount=0,a?f.enableHighAccuracy=!0:(f.enableHighAccuracy=!1,f.timeout=3E4),g=navigator.geolocation.watchPosition(b,d,f)):swal({title:"Sorry..",text:"Geolocation doesn't appear to be available on this browser",type:"error"})},toggleWatch:function(a){w?locationController.clearWatch():locationController.startWatch(a)},requestLocationNow:function(){var a=999999,b,d,g,h,k,E=0;return function(q,l){d=navigator.geolocation.watchPosition(function(f){k&&(.5>
calcCordDistance(k.lat,k.lng,f.coords.latitude,f.coords.longitude)?E++:E=0,3===E&&(q(f),clearTimeout(h),clearTimeout(g),navigator.geolocation.clearWatch(d)));a>f.coords.accuracy&&(a=f.coords.accuracy,b=f);k={lat:f.coords.latitude,lng:f.coords.longitude}},function(){l()},f);h=setTimeout(function(){q(b)},5E3);g=setTimeout(function(){navigator.geolocation.clearWatch(d)},5050)}}(),clearWatch:function(){$(".location-arrow").removeClass("oscillate");w=x=!1;navigator.geolocation.clearWatch(g);$("#showlocation").html($("#showlocation").html().replace("Hide",
"Show"));h&&(h.setMap(null),h=null);k&&(k.setMap(null),k=null)}}}(),myLocationPopup=function(){var a,b;return{getPopup:function(){b=locationIcon.getPosition();void 0!==a?(a.close(),a.setPosition(b)):a=new google.maps.InfoWindow({content:'<div class = "infowindow-small"><span class="add-to-route" onclick="myLocationPopup.addToOrigin()">Set as Origin</span><span class="add-to-route" onclick="myLocationPopup.addToDest()">Set as Destination</span></div>',position:b,zIndex:5E3,disableAutoPan:!0});a.open(map)},
addToOrigin:function(){geocodeReverseRequest(b,function(a,g){g===google.maps.GeocoderStatus.OK?document.getElementById("routestart").value=a[0].formatted_address:document.getElementById("routestart").value=b.lat()+", "+b.lng()})},addToDest:function(){geocodeReverseRequest(b,function(a,g){g===google.maps.GeocoderStatus.OK?document.getElementById("routeend").value=a[0].formatted_address:document.getElementById("routeend").value=b.lat()+", "+b.lng()})},close:function(){void 0!==a&&a.close()}}}(),markerRouteDistanceWindow=
function(){var a=0,b;return{setDistanceIntoRoute:function(b){a=b.toFixed(0)},showDistancePopup:function(d){void 0===b&&(b=new google.maps.InfoWindow({content:a+" mi",zIndex:5E3,pixelOffset:new google.maps.Size(d.offset,0),disableAutoPan:!0}));b.open(map,d)},closeDistancePopup:function(){void 0!==b&&b.close()}}};function addWaypoints(){toggleWaypoints.isActive()?document.getElementById("route-overview").style.display="block":document.getElementById("route-overview").style.display="none"}
function processWaypoints(a,b){for(var d=!0,g=0;g<route.waypoints.length;g++)route.waypoints[g].lat==a.lat&&route.waypoints[g].lng==a.lng&&(route.waypoints.splice(g,1),d=!1);if(d)if(7<route.waypoints.length)swal({title:"Whoops..",text:"Sorry, we can't take more than 8 waypoints..",type:"info"});else{route.waypoints.push(a);addWaypointField(a);return}void 0===b&&$("#routestart").blur()}
function addWaypointField(a){var b="";a&&(b="Set this pin as:"===a.name?a.lat+", "+a.lng:a.name);$inputContainer=$("<div>",{"class":"route-input-cont route-waypoint-cont"});$inputField=$("<input>",{type:"input","class":"routeinput route-waypoint-input"}).val(b).attr("autocorrect","off").prop("autocomplete","off");elementEventBinder.routeInputs($inputField);autoCompleteManager.add($inputField);$removeCont=$("<div>",{"class":"waypoint-remove-container"});$remove=$("<i>",{"class":"material-icons waypoint-remove"}).append("clear").click(function(a){$(".route-waypoint-cont").eq($(".waypoint-remove").index(this)).slideUp(400,
function(){removeWaypoint($(".waypoint-remove").index(this));this.remove();$("#routestart").blur()})});$removeCont.append($remove);$fade=$("<span>",{"class":"route-input-fade"});$inputClear=$("<i>",{"class":"material-icons route-input-clear"}).append("clear");elementEventBinder.routeInputClear($inputClear);$marker=$("<i>",{"class":"material-icons route-input-marker"}).append("place");$breadcrumbs=$("<i>",{"class":"material-icons route-input-breadcrumbs"}).append("more_vert");$(".route-input-cont").last().before($inputContainer.append($marker).append($inputField).append($fade).append($inputClear).append($removeCont).append($breadcrumbs));
$inputContainer.slideDown(400,function(){a&&$("#routestart").blur()})}var autoCompleteManager=function(){var a=[];return{add:function(b){b=new AutoCompleteCustom(b[0]);a.push(b)},remove:function(b){a.splice(b,1)}}}();function removeWaypoint(a){route.waypoints.splice(a,1);autoCompleteManager.remove(a)}function clearTable(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)}
var spinnerLoader=function(){var a,b;return{show:function(d){$spinner=$("<div>",{"class":"sk-circle"}).html('<div class="sk-circle1 sk-child"></div><div class="sk-circle2 sk-child"></div><div class="sk-circle3 sk-child"></div><div class="sk-circle4 sk-child"></div><div class="sk-circle5 sk-child"></div><div class="sk-circle6 sk-child"></div><div class="sk-circle7 sk-child"></div><div class="sk-circle8 sk-child"></div><div class="sk-circle9 sk-child"></div><div class="sk-circle10 sk-child"></div><div class="sk-circle11 sk-child"></div><div class="sk-circle12 sk-child"></div>');$container=
$("<div>",{"class":"spinner-container"});$(d).after($container).after($spinner);a=!0;b=setTimeout(spinnerLoader.hide,1E4)},hide:function(){clearTimeout(b);$(".sk-circle").remove();$(".spinner-container").remove();a=!1},active:function(){return a}}}(),mapMask=function(){function a(b){console.log(b.originalEvent.propertyName+": transition has ended");b.originalEvent.propertyName.indexOf("filter");$("#map-mask").off("transitionend",a);$("#map-mask").hide()}var b,d;return{show:function(a){d||(d=!0,$("#map-mask button").remove(),
$("#mapbase").addClass("map-loading"),$("#map-mask").addClass("opacity-1"),a.showAnimation?$("#map-mask .spinner").show():$("#map-mask .spinner").hide(),a.text||(a.text=""),$("#map-loading").html(a.text),$("#map-mask").show(),b=setTimeout(function(){$("#map-loading").html("Operation timed out..");$("#map-mask .spinner").hide();$("#map-loading").after($("<button>",{"class":"w3-btn w3-margin-top w3-show w3-content w3-center w3-center w3-hover-none w3-green w3-hover-blue"}).append("Retry").click(function(){InitialiseMap();
d=!1;mapMask.show({text:a.text,type:a.type,showAnimation:a.showAnimation})}))},1E4))},hide:function(){d=!1;clearTimeout(b);$("#mapbase").removeClass("map-loading");$("#map-mask").removeClass("opacity-1").on("transitionend",a)}}}();
function calcRoute(a){spinnerLoader.active()||spinnerLoader.show($(".wrap"));$("#return-onoffswitch").prop("checked")&&void 0===a&&returnJourney.getReturnRoute();a=document.getElementById("routestart").value;var b=document.getElementById("routeend").value;route.start=a;route.end=b;var d=[];$(".route-waypoint-input").each(function(a,b){var h=$(b).val().match(/[-]?[0-9]{1,}[.][0-9]{5,}/g);null!==h&&2==h.length?d.push({location:{lat:Number(h[0]),lng:Number(h[1])},stopover:!0}):d.push({location:$(b).val(),
stopover:!0})});directionsService.route({origin:a,destination:b,waypoints:d,travelMode:google.maps.TravelMode.DRIVING,provideRouteAlternatives:!0,unitSystem:google.maps.UnitSystem.IMPERIAL},function(a,b){b===google.maps.DirectionsStatus.OK?(altRoutes=a.routes.length-1,curRoute=0,directionsDisplay.setOptions({preserveViewport:!1}),directionsDisplay.setDirections(a),directionsDisplay.setMap(map)):(b===google.maps.DirectionsStatus.NOT_FOUND?swal({title:"Sorry..",text:"Couldn't find one or more locations. Please check and retry.",
type:"error"}):b===google.maps.DirectionsStatus.ZERO_RESULTS?swal({title:"Sorry..",text:"No route found. Please check and try again.",type:"error"}):swal({title:"Sorry..",text:"Something went wrong. Please check and try again.",type:"error"}),spinnerLoader.hide())})}function toggleAlternateRoutes(a){directionsDisplay.setOptions({preserveViewport:!0});0==a?0<curRoute?curRoute--:curRoute=altRoutes:curRoute<altRoutes?curRoute++:curRoute=0;directionsDisplay.setRouteIndex(curRoute);processRoute()}
var processRoute=function(){return function(){if(""!==$("#routestart").val()&&""!==$("#routeend").val()){spinnerLoader.active()||spinnerLoader.show($(".wrap"));document.getElementById("charger-radius");curRoute=directionsDisplay.getRouteIndex();var a=directionsDisplay.getDirections().routes[curRoute].overview_path;route.path=a;var a=directionsDisplay.getDirections().routes[curRoute].legs,b=storagePossible&&void 0!==localStorage.radius?localStorage.radius:2;$("#charger-radius").length&&(b=$("#charger-radius").val(),
storagePossible&&(localStorage.radius=b));if(!$(".route-options-cont").length){$("#route-cont").append($("<div>",{"class":"route-options"}).append($("<div>",{"class":"route-options-title route-titles"}).text("Options").append($("<div>",{"class":"expand-h"})).append($("<div>",{"class":"expand-v"}))));$(".route-options").append($("<div>",{"class":"route-options-cont"}));$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-0"}));$("#option-0").append($("<div>",{"class":"route-option-description"}).text("Suggest charge stops")).append($("<div>",
{"class":"route-option-input",id:"option-0-input"}));$("#option-0-input").append('<div class="onoffswitch"><input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="charge-suggest-checkbox" checked><label class="onoffswitch-label" for="charge-suggest-checkbox"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch"></span></label></div>');void 0!==localStorage.chargeSuggest&&$("#charge-suggest-checkbox").prop("checked","true"===localStorage.chargeSuggest);$(".route-options-cont").append($("<div>",
{"class":"route-option",id:"option-1"}).append($("<div>",{"class":"route-option-description"}).text("Show chargers within")));$sel=$("<select>",{id:"charger-radius"}).change(function(){updateMarkersOnMapFromRoute.update()});for(var d=[.5,1,2,5,10,20,50],g=0;g<d.length;g++){$opt=$("<option>");b==d[g]&&$opt.prop("selected",!0);var f=" mile";1<d[g]&&(f=" miles");$opt.text(d[g]+f);$opt.val(d[g]);$sel.append($opt)}$("#option-1").append($("<div>",{"class":"route-option-input",id:"option-1-input"}).append($sel).css({"text-align":"center"}));
$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-2"}));$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-21"}));$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-3"}));$("#option-2").append($("<div>",{"class":"route-option-description"}).text("Battery capacity")).append($("<div>",{"class":"route-option-input",id:"option-2-input"}));$("#option-21").append($("<div>",{"class":"route-option-description"}).text("Battery start level")).append($("<div>",
{"class":"route-option-input",id:"option-21-input"}));$("#option-3").append($("<div>",{"class":"route-option-description"}).text("Battery min. level")).append($("<div>",{"class":"route-option-input",id:"option-3-input"}));$("#option-2-input").append($("<div>",{"class":"input-cont"}).append($("<input>",{"class":"route-kwh",id:"route-kwh-capacity",type:"text"})).append($("<span>").text("kWh")));$("#option-21-input").append($("<div>",{"class":"input-cont"}).append($("<input>",{"class":"route-kwh",id:"route-kwh-start-capacity",
type:"text"})).append($("<span>").text("%")));$("#option-3-input").append($("<div>",{"class":"input-cont"}).append($("<input>",{"class":"route-kwh",id:"route-kwh-low-limit",type:"text"})).append($("<span>").text("%")));$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-4"}));$("#option-4").append($("<div>",{"class":"route-option-description"}).text("Custom mi/kWh?")).append($("<div>",{"class":"route-option-input",id:"option-4-input"}));$("#option-4-input").append('<div class="onoffswitch"><input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="mikwh-onoffswitch"><label class="onoffswitch-label" for="mikwh-onoffswitch"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch"></span></label></div>');
$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-5"}));$("#option-5").append($("<div>",{"class":"route-option-description"}).text("Average efficiency")).append($("<div>",{"class":"route-option-input",id:"option-5-input"}));$("#option-5-input").append($("<div>",{"class":"input-cont"}).append($("<input>",{"class":"route-kwh",id:"average-mi-kwh",type:"text"})).append($("<span>").text("mi/kWh")));void 0!==localStorage.customMiKwhOption?($("#mikwh-onoffswitch").prop("checked",
"true"===localStorage.customMiKwhOption),"true"===localStorage.customMiKwhOption?(0<localStorage.customMiKwh?(vehicleConsumpForSpeed.setOverride(Number(localStorage.customMiKwh)),$("#average-mi-kwh").val(localStorage.customMiKwh)):(vehicleConsumpForSpeed.setOverride(4.2),$("#average-mi-kwh").val(4.2)),$("#option-5").show()):(vehicleConsumpForSpeed.setOverride(0),0<localStorage.customMiKwh?$("#average-mi-kwh").val(localStorage.customMiKwh):(vehicleConsumpForSpeed.setOverride(4.2),$("#average-mi-kwh").val(4.2)))):
($("#average-mi-kwh").val(4.2),vehicleConsumpForSpeed.setOverride(0));$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-6"}));$("#option-6").append($("<div>",{"class":"route-option-description"}).text("Include return journey")).append($("<div>",{"class":"route-option-input",id:"option-6-input"}));$("#option-6-input").append('<div class="onoffswitch"><input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="return-onoffswitch"><label class="onoffswitch-label" for="return-onoffswitch"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch"></span></label></div>');
$(".route-options-cont").append($("<div>",{"class":"route-option",id:"option-7"}));$("#option-7").append($("<div>",{"class":"w3-row"}).append($("<div>",{"class":"w3-col s12 w3-left-align"}).append($("<span>",{"class":""}).html("Statuses to use for suggestions:"))).append($("<div>",{"class":"w3-col s12 w3-left-align w3-padding-left w3-padding-right"}).append($("<div>",{"class":"w3-col s6"}).append($("<div>").append($("<input>",{value:"online",type:"checkbox","class":"w3-check route-status-include"})).append($("<label>",
{"class":"w3-padding-left w3-validate"}).html("online"))).append($("<div>").append($("<input>",{value:"planned",type:"checkbox","class":"w3-check route-status-include"})).append($("<label>",{"class":"w3-padding-left w3-validate"}).html("planned"))).append($("<div>").append($("<input>",{value:"unknown",type:"checkbox","class":"w3-check route-status-include"})).append($("<label>",{"class":"w3-padding-left w3-validate"}).html("unknown")))).append($("<div>",{"class":"w3-col s6"}).append($("<div>").append($("<input>",
{value:"occupied",type:"checkbox","class":"w3-check route-status-include"})).append($("<label>",{"class":"w3-padding-left w3-validate"}).html("occupied"))).append($("<div>").append($("<input>",{value:"offline",type:"checkbox","class":"w3-check route-status-include"})).append($("<label>",{"class":"w3-padding-left w3-validate"}).html("offline"))))));$("#charge-suggest-checkbox").change(function(){storagePossible&&(localStorage.chargeSuggest=this.checked);this.checked?setTimeout(function(){$("#charge-suggest-menu").show()},
330):setTimeout(function(){chargeSuggestionController.resetOpacity();chargeSuggestionController.clearResult();$("#charge-suggest-menu").hide()},450);setTimeout(processRoute,350)});$("#mikwh-onoffswitch").change(function(){storagePossible&&(localStorage.customMiKwhOption=this.checked);setTimeout(function(){$("#option-5").slideToggle(function(){$("#mikwh-onoffswitch").prop("checked")?$("#average-mi-kwh").trigger("blur"):(vehicleConsumpForSpeed.setOverride(0),processRoute())})},350)});$(".route-status-include").change(function(){var a;
return function(){clearTimeout(a);var b=[];$(".route-status-include").each(function(a,d){this.checked&&(b.push(this.value),"occupied"==this.value&&b.push("in session"))});chargeSuggestionController.setRouteStatusInclude(b);localStorage.routeStatusInclude=JSON.stringify(b);a=setTimeout(calcRoute,650)}}());$("#charger-radius").change(function(){processRoute()});$(".route-options .route-options-title").click(function(a){a.target===this&&($(".route-options-cont").slideToggle(),$(".route-options .expand-v").eq($(".route-titles").index(this)).fadeToggle())});
$("#route-kwh-capacity").blur(function(){0<Number(this.value)?($(".route-kwh").eq(0).css({"border-color":""}),$("#option-2-input .error").remove(),chargeSuggestionController.setCapacity(1E3*this.value),storagePossible&&(localStorage.kwhCapacity=this.value),$("#route-kwh-low-limit").trigger("blur")):($("#option-2-input .error").remove(),$("#option-2-input").append($("<span>",{"class":"error"}).text("Oops!")),$(".route-kwh").eq(0).css({"border-color":"red"}))});$("#route-kwh-start-capacity").blur(function(){0<
Number(this.value)&&101>Number(this.value)?($(".route-kwh").eq(1).css({"border-color":""}),$("#option-21-input .error").remove(),chargeSuggestionController.setStartTankLevel(Number(this.value)),storagePossible&&(localStorage.kwhStartCapacity=this.value),processRoute()):($("#option-21-input .error").remove(),$("#option-21-input").append($("<span>",{"class":"error"}).text("Oops!")),$(".route-kwh").eq(1).css({"border-color":"red"}))});$("#route-kwh-low-limit").blur(function(){0<Number(this.value)&&100>
Number(this.value)?($(".route-kwh").eq(2).css({"border-color":""}),$("#option-3-input .error").remove(),chargeSuggestionController.setLowLimit(parseFloat(this.value)),storagePossible&&(localStorage.kwhLowLimit=this.value),processRoute()):($("#option-3-input .error").remove(),$("#option-3-input").append($("<span>",{"class":"error"}).text("Oops!")),$(".route-kwh").eq(2).css({"border-color":"red"}))});$("#average-mi-kwh").blur(function(){if(0<Number(this.value)&&10>Number(this.value)&&4>this.value.length)$(".route-kwh").eq(2).css({"border-color":""}),
$("#option-5-input .error").remove(),vehicleConsumpForSpeed.setOverride(parseFloat(this.value)),storagePossible&&(localStorage.customMiKwh=this.value),processRoute();else{$("#option-5-input .error").remove();var a=3<this.value.length?"One decimal please!":"Oops!";$("#option-5-input").append($("<span>",{"class":"error"}).text(a));$(".route-kwh").eq(2).css({"border-color":"red"})}});$("#return-onoffswitch").change(function(){storagePossible&&(localStorage.reverseOption=this.checked);setTimeout(function(){$("#return-onoffswitch").prop("checked")?
returnJourney.getReturnRoute():returnJourney.clearReturnRoute()},350)});storagePossible&&void 0!==localStorage.kwhCapacity?($("#route-kwh-capacity").val(parseFloat(localStorage.kwhCapacity)),chargeSuggestionController.setCapacity(1E3*parseFloat(localStorage.kwhCapacity))):(chargeSuggestionController.setCapacity(21E3),$("#route-kwh-capacity").val(21));storagePossible&&void 0!==localStorage.kwhLowLimit?($("#route-kwh-low-limit").val(parseFloat(localStorage.kwhLowLimit)),chargeSuggestionController.setLowLimit(parseFloat(localStorage.kwhLowLimit))):
(chargeSuggestionController.setLowLimit(20),$("#route-kwh-low-limit").val(20));storagePossible&&void 0!==localStorage.kwhStartCapacity?($("#route-kwh-start-capacity").val(parseFloat(localStorage.kwhStartCapacity)),chargeSuggestionController.setStartTankLevel(parseFloat(localStorage.kwhStartCapacity))):(chargeSuggestionController.setStartTankLevel(80),$("#route-kwh-start-capacity").val(80));if(storagePossible&&localStorage.routeStatusInclude){var h=JSON.parse(localStorage.routeStatusInclude);$(".route-status-include").each(function(a,
b){-1<h.indexOf(this.value)&&$(this).prop("checked",!0)});chargeSuggestionController.setRouteStatusInclude(h)}else $(".route-status-include").each(function(a,b){"online"!=this.value&&"occupied"!=this.value||$(this).prop("checked",!0)}),h=["online","occupied"],chargeSuggestionController.setRouteStatusInclude(h),localStorage.routeStatusInclude=JSON.stringify(h);b=$("<div>",{id:"charge-suggest-menu"});$(".route-options-cont").after(b);$p=$("<div>",{id:"suggest-title","class":"route-titles"}).text("Charge Suggestions").append($("<div>",
{"class":"expand-h"})).append($("<div>",{"class":"expand-v"}));$("#charge-suggest-menu").append($p);$tableCont=$("<div>",{"class":"charge-suggest-cont"});$("#charge-suggest-menu").append($tableCont);$("#suggest-title").click(function(a){a.target===this&&($(".charge-suggest-cont").slideToggle(),$(".route-options .expand-v").eq($(".route-titles").index(this)).fadeToggle())});$("#route-cont .expand-v").eq(2).fadeToggle()}updateMarkersOnMapFromRoute.update();calcEnergyConsumption(a);$("#charge-suggest-checkbox").prop("checked")?
chargeSuggestionController.get():chargeSuggestionController.clearResult();setTimeout(function(){spinnerLoader.hide();$(".clear-route").length||($buttonBar=$("<div>",{"class":"w3-btn-bar w3-col s10 clear-route"}),$buttonBar.append($("<span>",{"class":"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue"}).text("Clear").click(function(){clearRoute()})),$buttonBar.append($("<span>",{"class":"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue"}).text("Reverse").click(function(){switchRoute()})),
$buttonBar.append($("<span>",{"class":"w3-btn w3-round w3-border w3-col s4 w3-border-white w3-green w3-hover-blue"}).text("Add Stop").click(function(){addWaypointField()})),$buttonBarContainer=$("<div>",{"class":"w3-row"}).append($("<div>",{"class":"w3-col s1"}).append("&ensp;")).append($buttonBar).append($("<div>",{"class":"w3-col s1"}).append("&ensp;")),$(".route-inputs-container").after($buttonBarContainer))},500)}}}(),mapIdleEvent=function(){var a;return{add:function(){a=google.maps.event.addListener(map,
"idle",function(){spinnerLoader.hide();toggleWaypoints.isActive()||"computer"!=device||setTimeout(toggleWaypoints.toggle,500);mapIdleEvent.remove()})},remove:function(){google.maps.event.removeListener(a)}}}(),updateMarkersOnMapFromRoute=function(){var a;return{update:function(){a=[];var b=document.getElementById("charger-radius").value;storagePossible&&(localStorage.radius=b);for(var d=route.path,g=0;g<allmarkers.length;g++){var f=0;onroute=!1;for(var h=0;h<d.length&&!onroute;h++)if(calcCordDistance(d[h].lat(),
d[h].lng(),allmarkers[g].position.lat(),allmarkers[g].position.lng())<1.621371*Number(b)){onroute=!0;for(var k=0;k<h;k++)f+=calcCordDistance(d[k].lat(),d[k].lng(),d[k+1].lat(),d[k+1].lng());allmarkers[g].markerRouteDistanceWindow.setDistanceIntoRoute(f/1.60934)}for(f=0;f<allmarkers[g].info.connectors.length;f++)if(0<=connectors.indexOf(allmarkers[g].info.connectors[f].type.id)&&(onroute?(allmarkers[g].setVisible(!0),allmarkers[g].setOpacity(1)):allmarkers[g].setVisible(!1),onroute)){a.push(allmarkers[g]);
break}}},getRouteMarkers:function(){return a}}}(),returnJourney=function(){var a=[],b="";return{getReturnRoute:function(d){if(void 0===d)b=$("#routeend").val(),geocodeRequest(b,function(a,b){returnJourney.getReturnRoute(processGeocodeResponse(a,b))});else{$("#routeend").val($("#routestart").val());a=[];route.waypoints.forEach(function(b,d){b.autoWaypoint||a.push(b)});route.waypoints=[];a.forEach(function(a){route.waypoints.push(a)});processWaypoints({name:d.title,lat:d.location.lat,lng:d.location.lng,
autoWaypoint:!0},!0);for(d=a.length-1;-1<d;d--)route.waypoints.push(a[d]);calcRoute(!0)}},isActive:function(){return!1},clearReturnRoute:function(){$("#routeend").val(b);route.waypoints=[];a.forEach(function(a){route.waypoints.push(a)});calcRoute()}}}(),chargeSuggestionController=function(){function a(){for(var a=0;a<p.length;a++)p[a].setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){for(var a=0;a<p.length;a++)p[a].setAnimation(null);google.maps.event.removeListener(D)},1400)}function b(a){var b=
"charge-suggest-info",d="pseudo"===a.suggestion.charger.info.connectors[0].status?a.suggestion.charger.info.name:a.suggestion.charger.info.name.split(",")[0];a.suggestion.percentageOnArrival.toFixed(0)<Number($("#route-kwh-low-limit").val())&&(b+=" transition-power-exceeded");if(a.suggestion.percentageOnArrival&&a.suggestion.percentageOnDeparture&&a.suggestion.percentageOnArrival!==a.suggestion.percentageOnDeparture)var f=a.suggestion.percentageOnArrival,f=f.toFixed(0)+"%",g=a.suggestion.percentageOnDeparture,
g=g.toFixed(0)+"%",f="Arr. "+f+" - Dep. "+g;else a.suggestion.percentageOnArrival&&void 0===a.suggestion.percentageOnDeparture?(f=a.suggestion.percentageOnArrival,f=f.toFixed(0)+"%",f="Arr. "+f):(g=a.suggestion.percentageOnDeparture,g=g.toFixed(0)+"%",f="Dep. "+g);g=connectors[0];if("pseudo"===a.suggestion.charger.info.connectors[0].status){a="w3-pale-green";var h="w3-border-green"}else{for(var k=0;k<a.suggestion.charger.info.connectors.length;k++)if(a.suggestion.charger.info.connectors[k].type.id==
g){h=k;break}g=a.suggestion.charger.info.connectors[h].status;a="w3-pale-green";h="w3-border-green";"offline"==g&&(a="w3-pale-red",h="w3-border-red");"unknown"==g&&(a="w3-light-grey",h="w3-border-grey")}$row=$("<div>",{"class":"charge-suggest-row w3-container w3-leftbar "+a+" "+h});$row.append($("<div>",{"class":"charge-suggest-title"}).text(d)).append($("<div>",{"class":b}).append($("<img>",{width:"16px",height:"16px",src:"img/plug.svg"})).append(f));$(".charge-suggest-cont").append($row)}function d(a){$img=
$("<i>",{"class":"material-icons"}).append("more_vert");if(arguments.length){var b=a.energy,b=b.toFixed(0)+"%",d=a.distance,d=d.toFixed(1)+"mi",f="transition-power";a.energy>u.getCapacity()-h&&(f+=" transition-power-exceeded");$row=$("<div>",{"class":"charge-suggest-transition"}).append([$("<div>",{"class":f}).text(d).css({width:"42%"}),$("<div>",{"class":"charge-transition-icon"}).append($img),$("<div>",{"class":f}).text(b).css({width:"42%"})])}else $row=$("<div>",{"class":"charge-suggest-transition"}).append([$("<div>").css({width:"42%"}),
$("<div>",{"class":"charge-transition-icon"}).append($img),$("<div>").css({width:"42%"})]);$(".charge-suggest-cont").append($row)}var g,f,h,k,w,p,x,D,m,I=[];(function(){var a,b,d,f;return function(g){b=a=0;for(d=!1;g<m.length&&!d;g++){a+=m[g].energy;b+=.621371*calcCordDistance(m[g].start.lat,m[g].start.lng,m[g].end.lat,m[g].end.lng);for(var h=0;h<k.length&&!d;h++)1>.621371*calcCordDistance(m[g].end.lat,m[g].end.lng,k[h].info.lat,k[h].info.lng)&&(d=!0,f=k[h])}return d?{type:"charger",energy:a,charger:f,
distance:b,location:{lat:f.info.lat,lng:f.info.lng}}:{type:"end",energy:a,location:{lat:m[g].end.lat,lng:m[g].end.lng}}}})();var u=function(){var a,b,d;return{getEnergyLevel:function(){return a},useEnergy:function(d){a-=d;b+=d},addEnergy:function(b){a+=b},setCapacity:function(a){d=a;localStorage.kwhCapacity=a/1E3;$("#route-kwh-capacity").val(Number(a/1E3).toFixed(1))},getCapacity:function(){return d},fillToLevel:function(b){a=b},fillToPercentage:function(b){a=u.getCapacity()*(b/100)},fillUp:function(){a=
d},fillToEightyPercent:function(){a=.8*d},getEnergyTrip:function(){return b},resetEnergyTrip:function(){b=0},isFull:function(){return a>=d}}}();return{get:function(a,b){var d=[];u.fillToPercentage(Number($("#route-kwh-start-capacity").val()));var q=updateMarkersOnMapFromRoute.getRouteMarkers();k=[];w=[];p=[];routeChargersSorted=[];g=directionsDisplay.getDirections();f=g.routes[curRoute];x=f.overview_path;for(var l=0;l<q.length;l++)k.push(q[l]),w.push(q[l]);for(l=0;l<k.length;l++)k[l].setOpacity(.4);
if(void 0!==a){processElevationData(a,b);if(b===google.maps.ElevationStatus.OK){var F=[],J=0;f.legs.forEach(function(a){J+=a.distance.value});f.legs.forEach(function(a){a.steps.forEach(function(a){F.push({step:a,ratio:a.distance.value/J})})});var K=1/a.length;a.forEach(function(b,d){var f,g=0,h=0;0<d?(f=b.elevation-a[d-1].elevation,0<f?g+=f:h+=Math.abs(f),descentCon=h/300*750,b.energy=g/300*1500-descentCon):b.energy=0});F.forEach(function(b){var d=0;for(b.elevData=[];d+K<=b.ratio;)b.elevData.push(a[0]),
a.splice(0,1),d+=K})}m=[];for(var y=[],t=0,A=0,n=0;n<f.legs.length;n++)for(var r=0;r<f.legs[n].steps.length;r++){stepEnergy=calcStepEnergyUsage(f.legs[n].steps[r]);var L=0;b===google.maps.ElevationStatus.OK&&F[A].elevData.forEach(function(a){L+=a.energy});for(q=1;q<f.legs[n].steps[r].path.length;q++){pathEnergy=stepEnergy/f.legs[n].steps[r].path.length;pathElevEnergy=L/f.legs[n].steps[r].path.length;y.push({lat:f.legs[n].steps[r].path[q].lat(),lng:f.legs[n].steps[r].path[q].lng()});var t=vehicleDataController.get().temperature,
D=20>=t?pathEnergy*(1+(20-t)/2*.01):pathEnergy*(1-(20-t)/4*.01),t=.621371*calcCordDistance(f.legs[n].steps[r].path[q-1].lat(),f.legs[n].steps[r].path[q-1].lng(),f.legs[n].steps[r].path[q].lat(),f.legs[n].steps[r].path[q].lng());m.push({energy:D+pathElevEnergy,start:{lat:f.legs[n].steps[r].path[q-1].lat(),lng:f.legs[n].steps[r].path[q-1].lng()},end:{lat:f.legs[n].steps[r].path[q].lat(),lng:f.legs[n].steps[r].path[q].lng()},distance:t,startStep:{lat:f.legs[n].steps[r].start_location.lat(),lng:f.legs[n].steps[r].start_location.lng()},
endStep:{lat:f.legs[n].steps[r].end_location.lat(),lng:f.legs[n].steps[r].end_location.lng()}});0==n&&0==r&&1==q&&k.push({info:{name:"Start",lat:f.legs[n].steps[r].path[q].lat(),lng:f.legs[n].steps[r].path[q].lng(),connectors:[{status:"pseudo"}]}});n==f.legs.length-1&&r==f.legs[n].steps.length-1&&q==f.legs[n].steps[r].path.length-1&&k.push({info:{name:"End",lat:f.legs[n].steps[r].path[q].lat(),lng:f.legs[n].steps[r].path[q].lng(),connectors:[{status:"pseudo"}]}})}A+=1}m[0].start.lat.toFixed(5);m[0].start.lng.toFixed(5);
m[m.length-1].end.lat.toFixed(5);m[m.length-1].end.lng.toFixed(5);var t=q=0,C=[],y=0;k.forEach(function(a,b){a.lastRouteBearing=0});for(l=0;l<m.length;l++){var q=q+m[l].energy,t=t+m[l].distance,y=y+m[l].distance,B=9999,v,z=0;k.forEach(function(a,b){z=calcCordDistance(m[l].start.lat,m[l].start.lng,a.info.lat,a.info.lng);z<B&&(0<routeChargersSorted.length?routeChargersSorted[routeChargersSorted.length-1].charger.info.name!==a.info.name&&(v=a,B=z):(v=a,B=z))});if(!(B>1.621371*$("#charger-radius").val())){if(l<
m.length-1){var M;nextDistanceFromHere=9999;z=0;k.forEach(function(a,b){z=calcCordDistance(m[l+1].start.lat,m[l+1].start.lng,a.info.lat,a.info.lng);z<nextDistanceFromHere&&(nextDistanceFromHere=z,M=a)});if(calcCordDistance(m[l+1].start.lat,m[l+1].start.lng,v.info.lat,v.info.lng)<B&&v.info.name===M.info.name)continue}var N=[];k.forEach(function(a,b){z=calcCordDistance(v.info.lat,v.info.lng,a.info.lat,a.info.lng);3>z&&0<z&&N.push(a)});if(1==N.length&&"End"!==v.info.name&&"Start"!==v.info.name){A=calcBearing(m[l].start.lat,
m[l].start.lng,m[l].end.lat,m[l].end.lng);n=calcBearing(m[l].start.lat,m[l].start.lng,v.info.lat,v.info.lng);bearing.minusDegrees(A,180);if(0!==v.lastRouteBearing&&90>bearing.smallestDelta(A,v.lastRouteBearing))continue;if(180<bearing.antiClockwiseDegrees(A,n)){v.lastRouteBearing=A;continue}}if(0<routeChargersSorted.length){var G=0;routeChargersSorted.forEach(function(a,b){a.charger.info.name===v.info.name&&0===G&&(G=a.distIntoRoute)});if(5>y-G)continue}if(!(0<routeChargersSorted.length&&"Start"===
v.info.name||0===routeChargersSorted.length&&"End"===v.info.name||0<routeChargersSorted.length&&"End"===v.info.name&&l!==m.length-1)){C=[];v.info.connectors.forEach(function(a){"pseudo"!==a.status&&C.push(a.type.id)});var H=-1;connectors.forEach(function(a){-1<C.indexOf(a)&&0>H&&(H=C.indexOf(a))});if("pseudo"===v.info.connectors[0].status||-1<I.indexOf(v.info.connectors[H].status))routeChargersSorted.push({charger:v,energy:q,distance:t,distIntoRoute:y}),"pseudo"!==v.info.connectors[0].status&&d.push({lat:v.info.lat.toFixed(5),
lng:v.info.lng.toFixed(5),startStep:{lat:m[l].startStep.lat.toFixed(5),lng:m[l].startStep.lat.toFixed(5)},endStep:{lat:m[l].endStep.lat.toFixed(5),lng:m[l].endStep.lat.toFixed(5)}}),t=q=0}}}for(l=y=t=q=d=0;l<routeChargersSorted.length;l++){q+=routeChargersSorted[l].energy;t+=routeChargersSorted[l].distance;0<l&&u.useEnergy(routeChargersSorted[l].energy);if(l<routeChargersSorted.length-1&&l==y){u.getEnergyLevel();routeChargersSorted[l].percentageOnArrival=u.getEnergyLevel()/u.getCapacity()*100;d=0;
A=y;for(n=0;n<routeChargersSorted.length;n++)if(n>l)if(0<l&&d+routeChargersSorted[n].energy+h<=.9*u.getCapacity()||0==l&&d+routeChargersSorted[n].energy+h<=u.getEnergyLevel())d+=routeChargersSorted[n].energy,y=n;else{A==y&&(y=l+1,d=.9*u.getCapacity()-h);break}u.getEnergyLevel();0<l&&u.fillToLevel(d+h);routeChargersSorted[l].percentageOnDeparture=u.getEnergyLevel()/u.getCapacity()*100;p.push({energy:q/u.getCapacity()*100,distance:t,suggestion:routeChargersSorted[l]});t=q=0}l==routeChargersSorted.length-
1&&(routeChargersSorted[l].percentageOnArrival=u.getEnergyLevel()/u.getCapacity()*100,p.push({energy:q/u.getCapacity()*100,distance:t,suggestion:routeChargersSorted[l]}))}t=p[0].suggestion.charger.info;directionsDisplay.getDirections();d=$("#routestart").val();t.name=d;t=p[p.length-1].suggestion.charger.info;directionsDisplay.getDirections();d=$("#routeend").val();t.name=d;t=[];for(l=1;l<p.length-1;l++)p[l].suggestion.charger.setOpacity(1),t.push({operator_id:p[l].suggestion.charger.info.provider_openid,
lat:p[l].suggestion.charger.info.lat,lng:p[l].suggestion.charger.info.lng});ajaxHandler({url:"php/OCM_comments.php",data:t,success:chargeSuggestionController.processComments});chargeSuggestionController.renderResult()}else elevation.getElevationAlongPath({path:x,samples:500},chargeSuggestionController.get)},setCapacity:function(a){u.setCapacity(a)},setStartTankLevel:function(a){u.fillToPercentage(a)},setLowLimit:function(a){h=u.getCapacity()/100*a},bounceMarkers:function(){a()},renderResult:function(){this.clearResult();
for(var a=0;a<p.length;a++)b(p[a]),a<p.length-1&&d(p[a+1]);$(".charge-suggest-cont").append($("<div>",{"class":"suggest-caution"}).text("Caution, this is currently in Beta. Check Plugshare before travel."));$(".charge-suggest-title").click(function(){var a=$.inArray(this,$(".charge-suggest-title"));0<a&&a<$(".charge-suggest-title").length-1&&p[a].suggestion.charger.showInfoWindow(!0)})},clearResult:function(){$(".charge-suggest-cont").children().remove()},resetOpacity:function(){if(w.length)for(var a=
0;a<w.length;a++)w[a].setOpacity(1)},processComments:function(a){$(".charge-suggest-title").after(function(b){var d=new Date;if(0<b&&b<$(".charge-suggest-title").length-1){var f=$("<div>",{"class":"charge-suggest-userdata"}),g=$("<div>",{"class":"charge-suggest-comment-container"});if(null===a[b-1].comments)f.append($("<div>",{"class":"comments-title"}).append($("<div>",{"class":"expand-h-small no-comments"})).append($("<div>",{"class":"expand-v-small no-comments"})).append($("<i>",{"class":"material-icons comment-icon"}).append("warning")).append($("<span>").append("No user comments")).append(g));
else{$(g).append($("<span>").append("Comments powered by <a target='_blank' href='http://openchargemap.org/site/poi/details/"+a[b-1].comments[0].ChargePointID+"'>OpenChargeMap</a>"));for(var h,k,m=0;m<a[b-1].comments.length;m++){var p="bubble charge-suggest-comment"+commentType(a[b-1].comments[m].CheckinStatusTypeID),t=new Date(a[b-1].comments[m].DateCreated);m||(h=t,k=commentType(a[b-1].comments[m].CheckinStatusTypeID));var t=t.getDate()+" "+getActualMonth(t.getMonth())+" "+t.getFullYear().toString().substring(2,
4)+":",u="",n=a[b-1].comments[m].Comment,u=null===a[b-1].comments[m].CheckinStatusType?a[b-1].comments[m].CommentType.Title:a[b-1].comments[m].CheckinStatusType.Title;0<u.indexOf("(")&&(u=u.substring(0,u.indexOf("(")-1));if(n){var r=a[b-1].comments[m].UserName,r=r?" - "+r:"";g.append($("<div>",{"class":p}).append($("<div>",{"class":"comment-date"}).append(t)).append($("<div>",{"class":"comment-text"}).append(u)).append($("<div>",{"class":"user-comment collapsed-comment"}).append($("<div>",{"class":"quote-cont"}).append($("<i>",
{"class":"fa fa-quote-left"}))).append($("<span>").append(n)).append($("<div>",{"class":"quote-cont"}).append($("<i>",{"class":"fa fa-quote-right"}))).append($("<span>").append(r))))}else g.append($("<div>",{"class":p}).append($("<div>",{"class":"comment-date"}).append(t)).append($("<div>",{"class":"comment-text"}).append(u)).append($("<div>",{"class":"user-comment collapsed-comment"}).append($("<span>").append("No comment left..")).append($("<span>").append(r))))}b=daysBetweenDates(h,d);7<b?" comment-positive"==
k?(k="error_outline",b="Last successful checkin "+b+" days ago"):" comment-negative"==k?(k="warning",b="Unsuccessful checkin "+b+" days ago"):(k="error_outline",b="Neutral checkin "+b+" days ago"):" comment-positive"==k?(k="check",b="Successful checkin "+b+" days ago"):" comment-negative"==k?(k="warning",b="Unsuccessful checkin "+b+" days ago"):(k="error_outline",b="General checkin "+b+" days ago");f.append($("<div>",{"class":"comments-title"}).append($("<i>",{"class":"material-icons comment-icon"}).append(k)).append($("<span>").append(b)).append($("<div>",
{"class":"expand-h-small"})).append($("<div>",{"class":"expand-v-small"})).click(function(a){$(".charge-suggest-comment-container").eq($(".comments-title").index(a.delegateTarget)).slideToggle();$(".comments-title > .expand-v-small").eq($(".comments-title").index(a.delegateTarget)).fadeToggle()}));f.append(g)}return f}})},getChargingTime:function(){var a=0,b=0,d=0,f=0;return function(g,h,k,m){a=Number(h.toFixed(0))/100;d=Number(k.toFixed(0))/100;b=0;for(f=.01*g;a<d;)a+=.01,b+=3600/(1E3*(.75>=a?1:
.8>=a?.8:.85>=a?.65:.9>=a?.35:.95>=a?.15:1>=a?.05:.01)*m/f);return b/60}}(),setRouteStatusInclude:function(a){I=a}}}();function daysBetweenDates(a,b){return diffDays=Math.round(Math.abs((a.getTime()-b.getTime())/864E5))}function commentType(a){return 10==a||15==a||210==a?" comment-positive":120==a||130==a||160==a||30==a||22==a||20==a||25==a||50==a||40==a||200==a?" comment-negative":" comment-neutral"}
function calcEnergyConsumption(a){for(var b=0,d,g,f,h=0;h<a.length;h++){for(var k=f=0;k<a[h].steps.length;k++)d=a[h].steps[k].distance.value/1E3*.621371,g=d/(a[h].steps[k].duration.value/3600),reqSpeed=1*g,d*=vehicleConsumpForSpeed.get(reqSpeed)/1E3,f+=d;b+=f;route.consumption.waypoints[h]={baseline:f,adjusted:0}}route.consumption.total.baseline=b}
var calcStepEnergyEfficiency=function(a){var b=0,d=0,g=0;return function(a){b=a.distance.value/1E3*.621371;d=b/(a.duration.value/3600);reqSpeed=1*d;return g=vehicleConsumpForSpeed.get(reqSpeed)}}(),calcStepEnergyUsage=function(a){var b=0,d=0,g=0;return function(a){b=a.distance.value/1E3*.621371;d=b/(a.duration.value/3600);reqSpeed=1*d;g=vehicleConsumpForSpeed.get(reqSpeed);return g*b}}();
function getTimeFromSec(a){var b=Math.ceil(a/3600)-1;a=Math.ceil(a/60-60*b);return 0<b?0<a?b+" hours "+a+" mins":b+" hours ":a+" mins"}function getMilesFromKm(a){return Math.ceil(a/1E3*.621371)}function insertAfter(a,b){b.parentNode.insertBefore(a,b.nextSibling)}
function clearRoute(){directionsDisplay.setMap(null);chargeSuggestionController.clearResult();void 0!==chart&&chart.clearChart();route.clear();$(".directions-display").html("");document.getElementById("routestart").value="";document.getElementById("routeend").value="";showMarkers();$(".route-waypoint-cont").remove()}
function addMarker(a,b){var d,g,f,h,k="";"left"==b?(k="l",f={coords:[5,2,9,1,13,4,14,9,13,13,10,14,5,13,2,11,1,6,3,2,5,2],type:"poly"},g=-9,d="offline"==a.connectors[0].status?"img/pl_64x64.png":"planned"==a.connectors[0].status||"unknown"==a.connectors[0].status||"occupied"==a.connectors[0].status||"in session"==a.connectors[0].status?"img/bl_64x64.png":"img/gl_64x64.png"):"mid"==b?(k="m",f={coords:[16,0,21,2,22,8,20,13,14,12,10,8,11,2,16,0],type:"poly"},g=0,d="offline"==a.connectors[0].status?"img/pm_64x64.png":
"planned"==a.connectors[0].status||"unknown"==a.connectors[0].status?"img/bm_64x64.png":"img/gm_64x64.png"):"right"==b&&(k="r",f={coords:[28,1,31,5,31,11,28,15,21,15,18,10,18,5,23,1,28,1],type:"poly"},g=7,d="offline"==a.connectors[0].status?"img/pr_64x64.png":"planned"==a.connectors[0].status||"unknown"==a.connectors[0].status?"img/br_64x64.png":"img/gr_64x64.png");h="offline"==a.connectors[0].status?8E3-100*a.lat:"planned"==a.connectors[0].status||"unknown"==a.connectors[0].status?6E3-100*a.lat:
1E4-100*a.lat;d={url:d,scaledSize:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,32)};g=new google.maps.Marker({info:a,position:{lat:a.lat,lng:a.lng},map:map,icon:d,shape:f,zIndex:h,visible:!1,offset:g,updateMarker:updateMarkerUrl,routeOptions:routeOptions,showInfoWindow:getMarkerInfoWindow,pinDirection:k,getChargerHistory:getChargerHistory,processChargerHistory:processChargerHistory,markerRouteDistanceWindow:markerRouteDistanceWindow()});google.maps.event.addListener(g,
"click",getMarkerInfoWindow);google.maps.event.addListener(g,"click",function(){activeMarker=this});g.markerRouteDistanceWindow.setDistanceIntoRoute(allmarkers.length);allmarkers.push(g)}function getChargerHistory(a){ajaxHandler({url:"php/charger_history.php",data:{provider:a.info.provider,lat:a.info.lat,lng:a.info.lng},success:processChargerHistory})}function processChargerHistory(a){activeMarker.chargerHistory=a}
function updateMarkerUrl(){for(var a=this.getIcon(),b=0;b<this.info.connectors.length;b++)if(this.info.connectors[b].type.id==connectors[0]){a.url="r"==this.pinDirection?"offline"==this.info.connectors[b].status?"img/pr_64x64.png":"planned"==this.info.connectors[b].status||"unknown"==this.info.connectors[b].status||"occupied"==this.info.connectors[b].status||"in session"==this.info.connectors[b].status?"img/br_64x64.png":"img/gr_64x64.png":"m"==this.pinDirection?"offline"==this.info.connectors[b].status?
"img/pm_64x64.png":"planned"==this.info.connectors[b].status||"unknown"==this.info.connectors[b].status||"occupied"==this.info.connectors[b].status||"in session"==this.info.connectors[b].status?"img/bm_64x64.png":"img/gm_64x64.png":"offline"==this.info.connectors[b].status?"img/pl_64x64.png":"planned"==this.info.connectors[b].status||"unknown"==this.info.connectors[b].status||"occupied"==this.info.connectors[b].status||"in session"==this.info.connectors[b].status?"img/bl_64x64.png":"img/gl_64x64.png";
this.setIcon(a);break}}function routeOptions(){mapWaypointPopup.setPseudoGeoResp("Set this pin as:",{lat:this.info.lat,lng:this.info.lng});mapWaypointPopup.setWindowPos({lat:this.info.lat,lng:this.info.lng});mapWaypointPopup.open()}
function getMarkerInfoWindow(a){activeMarker=this;this.getChargerHistory(this);null!=openRssWindow&&openRssWindow.close();null!=openWindow&&openWindow.close();showHistoryInfoWindow.close();a=infoWindowContent(this.info);a=new google.maps.InfoWindow({getRssInfoWindow:showRssInfoWindow,getHistoryInfoWindow:showHistoryInfoWindow,content:a,maxWidth:300,pixelOffset:new google.maps.Size(this.offset,0),zIndex:9,disableAutoPan:!1});google.maps.event.addListener(a,"closeclick",function(){showHistoryInfoWindow.close()});
openWindow=a;openWindow.info=this.info;openWindow.open(map,this);delete a}
function showRssInfoWindow(){null!=openRssWindow&&openRssWindow.close();var a='<div class = "infowindow_rss"><h3>Available Connectors</h3><table style="width:100%">';if("Ecotricity"==this.info.provider||"Polar"==this.info.provider)for(var b=0;b<this.info.connectors.length;b++)var d=rssCheckChargerPresent(this.info,b)?"Remove":"Add",a=a+('<tr><td style="width:60%"><h4>'+this.info.connectors[b].type.title+'</h4> </td> <td style="width:40%;text-align:center" > <a class="rss_cmd" onclick="rssAddRemove('+b+
')">'+d+"</a></td></tr>");else a+='<tr><td style="width:100%;text-align:center;" ><h3> Sorry, not yet supported.</h3> </td> </tr>';openRssWindow=a=new google.maps.InfoWindow({content:a+"</table></div>",minWidth:100,pixelOffset:new google.maps.Size(activeMarker.offset+75,-50),zIndex:10,disableAutoPan:!0});openRssWindow.open(map,activeMarker);delete a}
var showHistoryInfoWindow=function(){var a,b;return{show:function(){b=$(".infowindow-content").css("height");a=$(".infowindow-content").html();for(var d=[],g=0;g<activeMarker.info.connectors.length;g++)activeMarker.info.connectors[g].isDual&&d.push(activeMarker.info.connectors[g].type.title);var f='<h5 style="min-width:300px">Status History</h5><div class="charger-history-content">';if(!1!==activeMarker.chargerHistory){f+='<div class="w3-row">';for(g=0;g<activeMarker.chargerHistory.length;g++)if(0>
d.indexOf(activeMarker.chargerHistory[g].type)){var f=f+'<div class="w3-col s4">',h=activeMarker.chargerHistory[g].date_time,k=h.split(" ")[0],h=h.split(" ")[1],k=k.split("-"),h=h.split(":"),f=f+(k[2]+" "+getActualMonth(Number(k[1])-1)+" "+k[0].substring(2,4)+" "+h[0]+":"+h[1]),f=f+"</div>",f=f+'<div class="w3-col s4">',f=f+activeMarker.chargerHistory[g].type,f=f+"</div>";k=activeMarker.chargerHistory[g].new_status;k="online"===k||"in session"===k?"green":"offline"===k?"red":"black";f+='<div class="w3-col s4 w3-text-'+
k+'">';f+=activeMarker.chargerHistory[g].new_status;f+="</div>"}f+="</div>"}else f+='<div class="w3-col s12">Looks like we don'+String.fromCharCode(39)+"t have any historical data yet..</div>";f+="</div>";b=$(".infowindow-content").css("height");$(".infowindow-content").css("height",b).css("overflow","auto").html(f);$(".history-button").removeClass("w3-green").addClass("w3-blue")},close:function(){$(".infowindow-content").html(a);$(".history-button").removeClass("w3-blue").addClass("w3-green")},toggle:function(){$(".charger-history-content").length?
this.close():this.show()}}}(),connectorsController=function(){var a,b=[{id:2,name:"CCS"},{id:1,name:"CHAdeMO"},{id:3,name:"AC (tethered)"},{id:4,name:"AC (socket)"},{id:7,name:"Tesla"}];return{update:function(b,g){clearTimeout(a);if(void 0===g){"none"==connectors&&(connectors=[]);var f=connectors.indexOf(b);0<=f?connectors.splice(f,1):connectors.push(b);storagePossible&&(localStorage.connectors=JSON.stringify(connectors))}else storagePossible?connectors=void 0!==localStorage.connectors?JSON.parse(localStorage.connectors):
"none":connectorsController.update(1);updateConnectorCheckmarks();a=setTimeout(function(){showMarkers()},500)},getNameArray:function(){var a=[];connectors.forEach(function(g,f){var h="";b.forEach(function(a,b){g==a.id&&(h=a.name)});a.push(h)});return a},clear:function(){connectors=[]}}}(),getActualMonth=function(){var a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return function(b){return a[b]}}();
function updateConnectorCheckmarks(){$(".connectors i").each(function(a,b){switch(a){case 0:0<=connectors.indexOf(2)?$(b).fadeTo(50,1):$(b).fadeTo(50,0);break;case 1:0<=connectors.indexOf(1)?$(b).fadeTo(50,1):$(b).fadeTo(50,0);break;case 2:0<=connectors.indexOf(3)?$(b).fadeTo(50,1):$(b).fadeTo(50,0);break;case 3:0<=connectors.indexOf(4)?$(b).fadeTo(50,1):$(b).fadeTo(50,0);break;case 4:0<=connectors.indexOf(7)?$(b).fadeTo(50,1):$(b).fadeTo(50,0)}})}
function showMarkers(a){for(a=0;a<allmarkers.length;a++){allmarkers[a].setVisible(!1);allmarkers[a].setOpacity(1);for(var b=allmarkers[a].info.connectors.length,d=0;d<b;d++)0<=connectors.indexOf(allmarkers[a].info.connectors[d].type.id)&&(allmarkers[a].setVisible(!0),allmarkers[a].updateMarker())}}
function infoWindowContent(a){var b,d,g="computer"==device?'target="_blank"':'target="_self"';d="http://api.plugshare.com/view/map?latitude=mylat&longitude=mylng&spanLat=0.003&spanLng=0.02".replace("mylat",a.lat);d=d.replace("mylng",a.lng);var f;f='<div class = "infowindow"><div class="w3-content w3-border w3-border-white infowindow-content">'+('<h5 style="min-width:300px;">'+a.name+" ("+a.provider+")</h5>");for(var h=0;h<a.connectors.length;h++)"unknown"==a.connectors[h].status?(b="unknown",styleHTML=
' style="color: black" '):"planned"==a.connectors[h].status?(b="planned",styleHTML=' style="color: #2291ff" '):"offline"==a.connectors[h].status?(b="offline",styleHTML=' style="color: red" '):"occupied"==a.connectors[h].status?(b="occupied",styleHTML=' style="color: #2291ff" '):"in session"==a.connectors[h].status?(b="in session",styleHTML=' style="color: #2291ff" '):(b="online",styleHTML=' style="color: green" '),f+='<div class="w3-row"><div class="w3-col s5 w3-left-align"><i class="fa fa-fw fa-plug"></i><p style="display:inline-block;">'+
(void 0==a.connectors[h].socket?void 0!==a.connectors[h].quantity?a.connectors[h].type.title+": "+a.connectors[h].quantity:a.connectors[h].type.title:a.connectors[h].socket)+'</p></div><div class="w3-col s4 w3-center"><i class="fa fa-fw fa-bolt"></i><p style="display:inline-block;">'+(a.connectors[h].power+" kW")+'</p></div><div class="w3-col s3 w3-center"><p style="display:inline-block;"> <span '+styleHTML+">"+b+"</span></p></div></div>";"Ecotricity"!==a.provider||a.isBeta?"Ecotricity"===a.provider&&
a.isBeta&&(b=moment(a.lastHeartbeat),f+='<div class="w3-col s12 w3-padding-top w3-left-align"><i class="fa fa-fw fa-heartbeat"></i><p>'+b.calendar()+"</p></div>"):f+='<div class="w3-col s12 w3-padding-top w3-left-align w3-text-red"><p>Ecotricity status no longer live. Please check their app.</p></div>';f+='<div class="w3-right-align w3-padding-bottom"><span class="">Data source:</span> <span class=""><a href="'+a.source.url+'" target="_blank">'+a.source.name+"</a></spanLng></div>";return f+"</div>"+
('<div class="w3-btn-bar"><a class="w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white" href="'+d+'" '+g+'>Plugshare</a><span class="w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white" onclick="activeMarker.routeOptions()">Route</span><span class="w3-btn w3-round w3-green w3-hover-blue w3-col s4 w3-border w3-border-white history-button" onclick="openWindow.getHistoryInfoWindow.toggle()">History</span></div>')}
function updateProviderCheckmarks(){$(".networks span").each(function(a,b){0<=providerreq.providers.indexOf($(b).attr("data-value"))?$(b).children("i").fadeTo(50,1):$(b).children("i").fadeTo(50,0)})}
var providersController=function(){function a(){!localStorage.selectedProviders&&localStorage.networks&&(JSON.parse(localStorage.networks).providers.forEach(function(a,b){a&&d.push(a)}),localStorage.selectedProviders=JSON.stringify(d))}var b,d=[];return{update:function(g){a();mapMask.show({type:"markerLoad",showAnimation:!0});clearTimeout(b);void 0===g?(d=[],$(".network-selected").each(function(){d.push($(this).data("value"))}),storagePossible&&(localStorage.selectedProviders=JSON.stringify(d))):
(storagePossible&&void 0!==localStorage.selectedProviders&&(d=JSON.parse(localStorage.selectedProviders)),$(".networks span").each(function(){0<=d.indexOf($(this).data("value"))&&$(this).addClass("network-selected")}));b=setTimeout(function(){ajaxHandler({url:"php/status_data.php",data:{providers:d},success:loadStatusData})},750)},selectAll:function(){$(".networks span").each(function(a,b){$(this).addClass("network-selected");providersController.update()})},refresh:function(){providersController.update()}}}();
function loadStatusData(a){if("object"==typeof map&&("object"!=typeof map||map.zoom)){$("#updated").html("Updated: "+a.last_updated);firstRun=!1;storagePossible&&(localStorage.data=JSON.stringify(a));firstRun=!1;if(0<allmarkers.length){for(var b=0;b<allmarkers.length;b++)allmarkers[b].setMap(null);allmarkers=[]}for(var d=!1,g=!1,f=0,b=0;b<a.locations.length;b++){for(var g=d=!1,f="Ecotricity"==a.locations[b].provider?.2:"Polar"==a.locations[b].provider?.1:.5,h=0;h<a.locations.length;h++)b!=h&&calcCordDistance(a.locations[b].lat,
a.locations[b].lng,a.locations[h].lat,a.locations[h].lng)<f&&(b<h?d=!0:g=!0);d?addMarker(a.locations[b],"left"):g?addMarker(a.locations[b],"right"):addMarker(a.locations[b],"mid")}showMarkers();"evhw"==urlParamsController.getParams().src&&tweetLinkInfoWindow(urlParamsController.getParams().lat,urlParamsController.getParams().lng);setTimeout(function(){$(document).trigger("markersAdded")},750);mapMask.hide()}}
function addCookie(a,b,d){var g=new Date;g.setTime(g.getTime()+864E5*d);d="expires="+g.toUTCString();document.cookie=a+"="+b+"; "+d}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),d=0;d<b.length;d++){for(var g=b[d];" "==g.charAt(0);)g=g.substring(1);if(0==g.indexOf(a))return g.substring(a.length,g.length)}return""}
var urlParamsController=function(){var a={},b={},d;return{fetch:function(){d=window.location.search.substr(1).split("&");for(var g=0;g<d.length;g++){var f=d[g].split("=");a[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}d=window.location.hash.substr(1).split("&");for(g=0;g<d.length;g++)f=d[g].split("="),b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])},getParams:function(){return a},hashParams:function(){return b}}}();
function updateUrl(a){var b=map.getCenter(),d=b.lat().toFixed(5),b=b.lng().toFixed(5),g=map.getZoom();history.replaceState(history.state,window.document.title,"/?lat="+d+"&lng="+b+"&z="+g);void 0!==a&&history.replaceState(history.state,window.document.title,"/?lat="+d+"&lng="+b+"&z="+g+"&login=true")}function gradient(a,b){return b/a}
function rssCheckChargerPresent(a,b){for(var d=0;d<c.targetChargers.length;d++)if(a.provider==c.targetChargers[d].provider&&a.lat==c.targetChargers[d].lat&&a.lng==c.targetChargers[d].lng&&a.connectors[b].type.title==c.targetChargers[d].type)return!0;return!1}
function rssAddRemove(a){document.getElementsByClassName("rssgen")[0].style.display="inline-block";document.getElementById("rssgen-text").setAttribute("onclick","requestUrl()");document.getElementById("rssgen-text").style.cursor="pointer";var b={name:activeMarker.info.name,provider:activeMarker.info.provider,lat:activeMarker.info.lat,lng:activeMarker.info.lng,type:activeMarker.info.connectors[a].type.title,status:"new"};if(0<c.targetChargers.length)for(var d=0;d<c.targetChargers.length;d++)if(b.provider==
c.targetChargers[d].provider&&b.lat==c.targetChargers[d].lat&&b.lng==c.targetChargers[d].lng&&b.type==c.targetChargers[d].type){document.getElementsByClassName("rss_cmd")[a].innerHTML="Add";c.targetChargers.splice(d,1);document.getElementById("rssgen-text").innerHTML="Click to generate RSS feed URL. You've added "+c.targetChargers.length+" station(s) so far.";0==c.targetChargers.length&&rssClear();return}c.targetChargers.push(b);document.getElementsByClassName("rss_cmd")[a].innerHTML="Remove";document.getElementById("rssgen-text").innerHTML=
"Click to generate RSS feed URL. You've added "+c.targetChargers.length+" station(s) so far."}function requestUrl(){submitJSONToServer("php/rss_process.php",JSON.stringify(c),processRssServerResponse)}
function rssClear(){c.targetChargers=[];document.getElementById("rss-response").style.display="none";document.getElementsByClassName("rssgen")[0].style.display="none";document.getElementById("rss-response").value="";document.getElementById("rssgen-text").setAttribute("onclick","requestUrl()");document.getElementById("rssgen-text").style.cursor="pointer";document.getElementsByClassName("rssgen")[0].style.top="85%"}
function initalGetRequest(){var a=new XMLHttpRequest,b;b=isCordovaApp?"https://evhighwaystatus.co.uk/php/heat_me_up.php":"php/heat_me_up.php";a.onreadystatechange=function(){};a.open("GET",b,!0);a.send()}
function submitCarwingsAction(){updateUrl(!0);"undefined"!=typeof ga&&ga("send","event","Carwings",document.getElementById("carwings-options").value,"HeatMyLeaf");$("#loading").show();$("#carwings-submit").prop("disabled",!0);$("#carwings-submit").css({opacity:0});var a="username="+$("#username").val()+"&password="+$("#password").val()+"&action="+$("#carwings-options").val();ajaxHandler({url:"php/heat_me_up.php",data:a,success:processCarwingsResponse,always:function(){$("#loading").hide();$("#carwings-submit").prop("disabled",
!1);$("#carwings-submit").css({opacity:1})}})}
function processCarwingsResponse(a){var b="",d="",g="";switch(a.status){case "login_fail":g="Login Failed";d="error";b="Looks like those Carwings credentials aren't valid..";break;case "action_success":g="Success!";d="success";switch(a.request){case "ac_on":b="Hi "+a.user_id+"!<br><br>Your LEAF's now warming as we speak..";break;case "ac_off":b="Hi "+a.user_id+"!<br><br>Your LEAF's AC has been turned off..";break;case "battery":b="Hi "+a.user_id+"! Here's your current battery info..<br><br>";b+="Range without AC: <b>"+
a.leaf_info.range.ac_off+"</b> miles<br><br>";b+="Range with AC: <b>"+a.leaf_info.range.ac_on+"</b> miles<br><br>";b+="Bars: <b>"+a.leaf_info.bars+"/12</b>";break;case "start_charge":b="Hi "+a.user_id+"!<br><br>Your LEAF's charging has now been started.."}break;case "request_timeout":g="Timeout";d="info";b="Hi "+a.user_id+"!<br><br>The request was issued successfully, but confirmation wasn't received in a timely manor..";break;case "carwings_update_fail":g="Failed",d="error",b="Hi "+a.user_id+"!<br><br>We logged in OK, but the command failed. Maybe wait and try again."}swal({title:g,
html:!0,type:d,text:b})}var networkFailure=function(){return{show:function(){$(".network-failure-alert").length||($alert=$("<div>",{"class":"w3-container w3-card-8 w3-animate-top w3-red w3-top network-failure-alert",style:"z-index:5; position:absolute;"}).append($("<span>",{"class":"w3-closebtn"}).append("&times;").click(function(){this.parentNode.remove()})).append("<p>Network connection unavailable</p>"),$(".wrap").append($alert))},hide:function(){$(".network-failure-alert").remove()}}}();
function ajaxHandler(a){var b;b=isCordovaApp?"https://evhighwaystatus.co.uk/"+a.url:a.url;var d="string"===typeof a.data?a.data:JSON.stringify(a.data);$.ajax({method:"post",url:b,beforeSend:function(b){isCordovaApp&&b.setRequestHeader("xAppAuth","8;iLY3AZ1m7,?[pUKM0!+E7h44;u2W81dWl<(mf85kevN0J-MN^V6P1F47VTE77");"string"===typeof a.data&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded")},data:d}).done(function(b,d,h){a.success(b)}).fail(function(b,d,h){networkFailure.show();a.fail&&
a.fail()}).always(function(b,d,h){a.always&&a.always()})}
function processRssServerResponse(a){a=60>a.length?a:"Sorry, something went wrong.";document.getElementById("rss-response").value=a;document.getElementById("rss-response").style.display="block";document.getElementById("rssgen-text").innerHTML="Here's your unique RSS URL:";document.getElementById("rssgen-text").setAttribute("onclick","");document.getElementById("rssgen-text").style.cursor="default";document.getElementsByClassName("rssgen")[0].style.top="45%"}
function cookieMessage(){$alert=$("<div>",{"class":"w3-container w3-light-grey w3-bottom w3-card-8",style:"z-index:5;"}).append($("<span>",{"class":"w3-closebtn"}).append("&times;").click(function(){this.parentNode.style.display="none";addCookie("cookies",!0,365)})).append("<p>Just so you know, we use cookies to enhance your browsing experience and provide website statistics.</p>");$(".wrap").append($alert)}
var bearing=function(){return{minusDegrees:function(a,b){for(var d=a,g=0;g<b;g++)--d,-1>=d&&(d=359);return d},addDegrees:function(a,b){for(var d=a,g=0;g<b;g++)d+=1,360<=d&&(d=0);return d},antiClockwiseDegrees:function(a,b){for(var d=a,g=0;1<Math.abs(d-b);)d=this.minusDegrees(d,1),g++;return g},smallestDelta:function(a,b){for(var d=a,g=0,f=0;1<Math.abs(b-d);)d=this.addDegrees(d,1),g++;for(d=a;1<Math.abs(b-d);)d=this.minusDegrees(d,1),f++;return g<f?g:f}}}();
